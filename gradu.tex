\nonstopmode
% \batchmode jos et halua n�hd�
\documentclass[12pt,a4paper,finnish,margin=2in]{article}
\usepackage[margin = 1.75in,bottom=1in,top=1.25in]{geometry}
\linespread{1.2}

\usepackage{fixltx2e}
\usepackage{amsmath}
\usepackage{url}
\usepackage{graphicx}
\usepackage{pgfplotstable}
%\usepackage{lineno}
%\linenumbers

%%% T�m� on t�m�n tiedoston versio ajanhetken� 2008-02-13.
%%% S��t�j�-�ss�n on hyv� muistaa p�ivitt�� my�s p�iv�ys.

\usepackage[round,authoryear]{natbib}
%\usepackage[
%backend=biber,
%style=authoryear,
%citestyle=apa,
%sorting=nyt,
%natbib=true
%]{biblatex}
%\addbibresource{gradu.bib}
%\bibpunct{(}{)}{;}{a}{,}{,}

\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[finnish]{babel}

% \usepackage{graphicx}
% tai \usepackage{graphics}
% kuvatiedostojen liitt�miseksi
\begin{document}

\parskip 2mm
\parindent 0mm

\begin{titlepage}
  \setlength{\parindent}{0mm}
  \sloppy
  \large \textsc{Helsingin Yliopisto \\
                 Yleisen kielitieteen laitos \\
                 Kieliteknologia}
  \vspace{5mm}

  \hrule height3pt
  \vspace{20mm}

  \begin{center}
    \large Pro gradu -tutkielma
    \linebreak \vfill   

    \huge \textbf{Tutkielman nimi}
    \vspace{20mm}

    \Large Tekij�n Nimi \linebreak
    \normalsize 0000000  % opiskelijanumero
    \vfill

  \end{center}
  \hrule height2pt
  \vspace{15mm}

  Ohjaaja: Ohjaajan Nimi
  \hfill
  99.99.9999     % p�iv�m��r� (esim. 2.2.2002)
\end{titlepage}

\tableofcontents

\pagebreak

%%% Oma teksti t�m�n j�lkeen.
%%% Tyhj� rivi kappalten v�liin.
%%% LaTeX varaa mm. merkit & $ & % \ { } [ ] omiin tarkoituksiinsa.

\section{Johdanto}

Termosf��ri on planeettamme ilmakeh�n ainoa l�hiavaruuteen saakka ulottuva kerros. Tieteellisen mielenkiinnon lis�ksi termosf��rin k�ytt�ytymisen parempi ymm�rt�minen on t�rke�� suunniteltaessa ja toteutettaessa l�hiavaruuden satelliittitoimintaa, sill� termosf��rist� aiheutuva ilmanvastusvoima on suurin virhel�hde ennustettaessa matalan kiertoradan satelliittien sijaintia \citep{Doornbos_2007}. 

Termosf��rin ymm�rt�miseksi on laadittu useita virtaus- ja elektrodynamiikan yht�l�t ratkaisevia fysikaalisia malleja \citep[esim.][]{richmond_1992, ridley_2006}. Rakenteeltaan mallit muistuttavat alailmakeh�ss� k�ytett�vi� s��- ja ilmastomalleja, mutta vaikka ne ovat merkitt�v�sti lis�nneet tietoa yl�ilmakeh�n prosesseista ja kytkenn�ist�, eiv�t niill� laskettavat ennusteet kovinkaan hyvin vastaa termosf��rist� teht�vi� havaintoja \citep{Shim_2014}. T�m�n vuoksi satelliittien ratelaskelmissa ei fysikaalisia malleja juurikaan k�ytet�, vaan niiden tilalla hy�dynnet��n puoli-empiirisi� menetelmi�, jotka kuvaavat termosf��rin keskim��r�ist� l�mp�tila- ja tiheysjakaumaa geofysikaalisten olosuhteiden funktiona.

Vaikka puoli-empiiriset mallit tuottavat fysikaalisia malleja tarkemman arvion yl�ilmakeh�n satelliitteihin kohdistamasta ilmanvastuksesta, liittyy niidenkin k�ytt��n suuria virheit�, koska termosf��rin todellinen tila ja empiirisen mallin tuottama keskim��r�inen tila poikkevat k�yt�nn�ss� aina toisistaan. Niin fysikaalisten kuin empiiristen mallien virheit� on yritetty pienent�� korjaamalla mallin alkutilaa sellaiseksi, ett� se vastaa paremmin havaintoja \citep[esim.][]{matsuo_2012,doornbos_2008,storz_2005,chartier_2016}. T�m�n niin kutsutun data-assimilaation avulla mallien ja havaintojen v�list� virhett� on etenkin lyhyill� ennustusajoilla saatu merkitt�v�sti pienennetty�, mutta on kuitenkin ep�selv��, kuinka paljon ennusteita voidaan parantaa alkutilan paremmalla m��rityksell�. 

Toisin kuin alailmakeh�ss�, termosf��rist� teht�vien ennusteiden ep�varmuus liittyy hyvin paljon ep�varmuuteen termosf��rin tilaa ajavissa pakotteissa \citep{mannucci_2016}. Yl�ilmakeh�n t�rkein energianl�hde on auringosta tuleva lyhytaaltoinen E- ja FUV-s�teily, jonka s�teilyteho voi vaihdella sadoilla prosenteilla minuuttien ja tuntien aikaskaalassa \citep[esim.][]{Tsurutani_2005}. Lis�ksi t�m� voimakas s�teily ionisoi osan termosf��rin kaasusta muodostaen alueelle niin kutsutun ionosf��rin, jonka liike yl�ilmakeh�n s�hk�- ja magneettikenttien mukaan vaikuttaa my�s neutraalin kaasun virtaukseen. T�st� aiheutuvan ionosf��ri-termosf��ri -kytkenn�n ja auringon lyhytaaltoisen s�teilyn muutokset ovat vaikeasti ennustettavissa, mutta voivat vaikuttaa termosf��rin massatiheyteen kymmenill� tai jopa sadoilla prosenteilla \citep[esim.][]{emmert_2015}. N�in ollen tilanteissa, joissa pakotteen aikakehitykseen liittyy hyvin suuri ep�varmuus, ei alkutilan tarkkakaan m��ritys auta tuottamaan laadukkaita ennusteita yl�ilmakeh�n tilasta \citep{chen_2016}.

T�st� syyst� t�ss� tutkielmassa keskityt��n tarkastelemaan data-assimilaation suorituskyky� aikana, jolloin termosf��riin kohdistuu voimakkaita ajan suhteen muuttuvia pakotteita (geomagneettinen ja auringon aktiivisuus ovat suuria). Data-assimilaation ennustusmallina k�ytet��n Ilmatieteen laitoksella kehitetty� uutta puoli-empiirist� Iipponen-Laitinen -mallia (IL). Malliin assimiloitavana havaintoaineistona hy�dynnet��n Pohjois-Amerikan ilmapuolustuskomentokeskuksen (NORAD) niin sanottuja kaksirivisi� elementtej�, jotka kuvaavat ilmanvastuksen vaikutuksia maata kiert�vien kappaleiden kiertoratoihin \citep[esim.][]{picone_2005}. 

Vaikka kaksirivisi� elementtej� on aiemminkin k�ytetty puoli-empiiristen yl�ilmakeh�mallien korjaukseen\citep[esim.][]{Doornbos_2007, doornbos_2008}, aiemmista tutkimuksista poiketen t�ss� ty�ss� data-assimilaatio suoritetaan ensemble Kalman -suotimen (englanniksi \textit{Ensemble Kalman Filter}, EnKF) \citep{evensen_1994, evensen_2003} avulla. Menettely poikkeaa aiemmista tutkimuksista siin�, miten se k�sittelee mallin ennustetta muodostaessaan analyysi� yl�ilmakeh�n todenn�k�isimm�st� tilasta. Aiemmin todenn�k�isimm�n tilan arvio on m��ritetty ainoastaan interpoloimalla havaintoaineistoa, mutta yhdist�m�ll� mallin ennusteen ja havainnot, EnKF kykenee tuottamaan arvion yl�ilmakeh�n tilasta, joka todenn�k�isimmin vastaa j�rjestelm�n todellista tilaa. Lis�ksi ensemble Kalman -suotimella on kyky tuottaa arvio termosf��rin tilan todenn�k�isyysjakaumasta.

Data-assimilaatio-j�rjestelm�n avulla tutkitaan kahta keskeist� tutkimuskysymyst�:
\begin{enumerate}
\item Tarkentaako EnKF:n avulla tuotettu ilmakeh�n analyysi IL-mallin kuvausta keski- ja yl�termosf��rin massatiheydest�?
\item Tarkentaako analyysi kolmen p�iv�n ennusteita yl�ilmakeh�n tilasta, mik�li pakotetekij�iden aikakehitys tunnetaan tarkkaan?
\end{enumerate}

Keskeisin yksitt�inen parametri arvioitaessa yl�ilmakeh�mallien suorituskyky� on tiheysennusteiden ja -havaintojen v�linen neli�llinen keskivirhe \citep[k.s. esim.][s. 359]{wilks_2011}, sill� se kuvaa hyvin satelliitin kiertoradan ennustuksessa teht�v�� et�isyysvirhett� \citep{bruinsma_2012}. T�ss� ty�ss� sit� k�ytet��n arvioimaan, tarkentaako data-assimilaatio yl�ilmakeh�n tiheydest� teht�vi� arvioita verrattuna IL-malliin, johon dataa ei ole koskaan assimiloitu. Tutkimusajankohtana k�ytet��n vuotta 2003, sill� t�ll�in yl�ilmakeh��n vaikuttavat pakotetekij�t olivat suuria ja nopeasti vaihtelevia. J�rjestelm�n suorituskyvyn arvioinnissa hy�dynnet��n aina havaintoja, joita analyysin tuottamiseen ei ole k�ytetty.

Ty�n kolmessa ensimm�isess� luvussa annetaan tulosten ja johtop��t�sten ymm�rt�miseksi tarvittavat tiedot IL-mallista, NORAD:n kaksirivielementeist�, sek� ensemble Kalman -suotimesta. Luku 5 esitt�� data-assimilaation tulokset. Luku 6 esitt�� tulosten perusteella johtop��t�ksi� ja k�sittelee ty�n rajoitteita. Lopuksi Luku 7 tiivist�� keskeiset tulokset ja johtop��t�kset.

\section{Iipponen-Laitinen -malli}

Jo satelliittiajan alussa, 1960- ja 1970-luvuilla oli tarve kyet� m��ritt�m��n ja ennustamaan satelliittien ratoja merkitt�v�ll� tarkkuudella. Matalla maan kiertoradalla kiert�v�t kappaleet, joiden perigeum (kiertoradan maata l�hin piste) on alle 500 - 700 km:n korkeudella kokevat termosf��rin kokonaismassatiheydest� aiheutuvan merkitt�v�n ilmanvastusvoiman \citep{king_hele_1987}. T�m�n voiman mallintamiseksi alettiin 1960-luvulla kehitt�m��n empiirisi� malleja, jotka havaintojen pohjalta kuvasivat termosf��rin keskim��r�ist� kolmiulotteista l�mp�tila- ja massatiheysjakaumaa \citep{jacchia_1965,hedin_1974}. N�iden mallien kehitt�minen oli laskennallisesti yksinkertaisempaa ja nopeampaa kuin s�hk�- ja virtausdynamiikan yht�l�t ratkaisevien mallien kehitys, joten niist� tuli nopeasti kiertoratamallinnuksen standardity�kaluja.

P��asiallinen fysikaalisten mallien hy�dyllisyytt� rajoittava tekij� on tarve l�yt�� malleille kolmiulotteinen alkutila, jota ilman mallit eiv�t voi antaa luotettavia ennusteita (heikosti pakotettuina aikoina). T�llaisen alkutilan l�yt�mist� rajoittaa merkitt�v�sti se, ett� neutraalista yl�ilmakeh�st� on saatavilla hyvin v�h�n reaaliaikaista (korkearesoluutioista) dataa \citep{emmert_2015}. Empiirisiss� malleissa t�m� ongelma kierret��n etsim�ll� analyyttinen, ep�lineaarinen funktiosovitus, joka parhaiten kuvaa kymmenien vuosien historiallista havaintoaineistoa. 

Ilmatieteen laitoksella on aiemman tutkimuksen \citep{iipponen_2015} pohjalta kehitetty uudistettua empiirist� yl�ilmakeh�mallia, jonka tarkoituksena on keskitty� geomagneettisten myrskyjen ilmakeh�vaikutusten parempaan arviointiin. Kuten aiemmat yl�ilmakeh�mallit, MSIS \citep{picone_2002} ja DTM \citep{bruinsma_2015}, IL-malli kuvaa hydrostaattisessa tasapainossa olevaa ilmakeh��:
\begin{equation} \label{hydrostatic_eq}
dp = -\rho g_0 dZ,
\end{equation}
miss� \textit{p} on ilmanpaine, $\rho$ on tiheys, \textit{Z} on geopotentiaalikorkeus ja \textit{g}\textsubscript{0} on putoamiskiihtyvyys mallin alarajalla 130 km:n korkeudella. Alailmakeh�st� poiketen turbulenttinen sekoittuminen on pienen tiheyden takia termosf��riss� hyvin pient� suhteessa molekulaariseen diffuusioon \citep{emmert_2015}. T�ll�in raskaat kaasulajit (N\textsubscript{2} ja O\textsubscript{2}) ker��ntyv�t alatermosf��riin (alle 200 km korkeudelle) ja kevyemm�t (He ja O) termosf��rin ylempiin osiin (ks. Kuva \ref{fig:emmert_tiheys}). 
\begin{figure}[t]
\centering
\includegraphics[scale = 0.4]{emmert_tiheys}
\caption{Termosf��rin t�rkeimpien kaasulajien lukum��r�tiheyksien globaalit keskiarvot korkeuden funktiona auringon maksimin aikaan. \citet{emmert_2015} Kuva 2(a).}
\label{fig:emmert_tiheys}
\end{figure}
N�in ollen keskim��r�isen molekyylimassan muutokset on yht�l�� (\ref{hydrostatic_eq}) integroitaessa otettava huomioon. Kun siihen sijoitetaan ideaalikaasun tilanyht�l�
\begin{equation} \label{ideal_eq}
p = \rho \frac{R}{m} T,
\end{equation}
(miss� $m$ on kaasun keskim��r�inen molaarimassa, $T$ on absoluuttinen l�mp�tila ja $R$ = 8.314 J / K / mol on kaasuvakio), saadaan hydrostaattinen yht�l� muotoon:
\begin{align} \label{hydrostatic_log_eq}
\frac{-R}{\rho}~d \left ( \rho \frac{T}{m} \right ) = -R~\frac{T}{m} d(\ln \rho) - R~d \left ( \frac{T}{m} \right ) = g_0 dZ \nonumber \\
\Rightarrow  d(\ln \rho) = - d \left ( \ln \frac{T}{m} \right ) - \frac{g_0 m}{R T} dZ
\end{align}

Yht�l�n \ref{ideal_log_eq} integroiminen vaatii oletuksen yl�ilmakeh�n l�mp�tilaprofiilista. IL-mallissa hy�dynnet��n \citet{walker_1965}:n esitt�m�� empiirist� funktiota:
\begin{equation} \label{bates_eq}
T(Z) = T_{ex} - (T_{ex} - T_0) e^{- \frac{T'}{T_{ex} - T_0} (Z-Z_0)},
\end{equation}
miss� $T_ex$ kuvaa eksosf��rin (maan ilmakeh�n ylimm�n osan) l�mp�tilaa; $T_0$ on l�mp�tila ja $T' = dT/dZ$ on l�mp�tilan pystysuuntainen gradientti mallin alarajalla 130 km:n korkeudella. Lis�ksi hydrostaattisen yht�l�n integroinnissa oletetaan, ett� yl�ilmakeh� on diffusiivisessa tasapainossa; termosf��rin voidaan ajatella koostuvan useasta yksikaasuisesta osailmakeh�st�, joiden massatiheyksien summa antaa ilmakeh�n kokonaismassatiheyden miss� tahansa termosf��rin pisteess�. T�ll�in yht�l� \ref{hydrostatic_log_eq} voidaan integroida jokaiselle kaasulajille erikseen, jolloin lajille $i$ saadaan massatiheytt� kuvaava yht�l�:
\begin{equation} \label{species_dens_eq}
\rho_i (Z) = \rho_i (Z_0)~(T_0 / T(Z))^{1+\gamma_i+\alpha}~e^{-\sigma \gamma_i (Z-Z_0)},
\end{equation}
miss�:

$Z$: geopotentiaalikorkeus $Z = (R_E + z_0)(z-z_0)/(R_E + z)$,

$z$: geometrinen (todellinen) korkeus,

$z_0$: alareunan korkeus $z_0 = 130$ km,

$R_E$: maan napas�de $R_E = 6356.77$ km,

$\gamma_i = m_i g_0/(\sigma~R~T_{ex})$,

$\sigma = T' / (T_{ex} - T_0)$

$\alpha$: l�mp�tiladiffuusiokorjauskerroin (Heliumille -0.38, muille mallin kaasuille 0). Heliumin tiheys pienenee korkeuden funktiona hieman hitaammin kuin hydrostaattinen tasapaino edellytt��.

Yht�l�n (\ref{species_dens_eq}) mukaan mallin alarajalla on siis l�mp�tilojen lis�ksi m��ritett�v� kunkin kaasulajin massatiheys. Puoli-empiirisiss� termosf��rimalleissa t�m� tehd��n geofysikaalisen funktion $G_i(L)$ avulla, joka esitt�� muutoksen alarajan massatiheydess� geofysikaalisen tilan $L$ funktiona:
\begin{equation} \label{lb_eq}
\rho_i(Z_0) = \overline{\rho_i(Z_0)}~\exp(G_i(L)).
\end{equation}

Geofysikaalinen tila $L$ kuvaa IL-mallissa havaintopisteen sijaintia (leveys- ja pituuspiiri, aurinkoaika), havaintoaikaa (vuodenp�iv�), sek� auringon- ja geomagneettista aktiivisuutta. Auringon aktiivisuus on parametrisoitu auringon 30 cm radiovuon (F30) edellisen p�iv�n ja 81:n p�iv�n keskiarvojen avulla, sill� yksitt�isist� auringon aktiivisuusindekseist� t�m� parhaiten kuvaa auringon UV-s�teily� niill� aallonpituusalueilla, jotka termosf��ri� l�mmitt�v�t \citep{bruinsma_2017}. Geomageettisesti aktiivisina aikoina yl�ilmakeh�n varattujen ja neutraalien hiukkasten t�rm�ykset l�mmitt�v�t ja sekoittavat termosf��ri�, mik� muuttaa ilmakeh�n tiheysrakennetta \citep[esim.][]{prolss_2011}. IL-mallissa vaikutuksen parametrisoinnissa k�ytet��n pohjoisen revontuliovaalin alueen magnetometrimittauksista johdettavaa AE-indeksi�, jonka oletetaan olevan verrannollinen termosf��ri� l�mmitt�v�n s�hk�virran ja hiukkaspresipitaation suuruuteen \citep{iipponen_2015}.

Lopulta skalaariarvoinen funktio $G$ kuvaa parametrivektorin $L$ suhteellisiksi tiheysmuutoksiksi logaritmisessa avaruudessa. $G$ on m��ritelty pallon pinnalla, joten sen lausekkeessa on k�ytetty apuna palloharmonisia funktiota astelukuun ($\sim$meridionaalinen aaltoluku) 6 ja kertalukuun (zonaalinen aaltoluku) 4 saakka. $G_i$ on ominainen kullekin kaasulajille, mutta funktionaalinen muoto on t�ysin sama; $G$ sis�lt�� 142 vapaata parametri�, jotka saavat eri arvoja riippuen siit�, mik� kaasu on kyseess�. Vastaavalla tavalla m��ritell��n my�s l�mp�tilojen muutos geofysikaalisen tilan L funktiona:
\begin{equation} \label{lb_eq}
T_j = \overline{T_j} (1 + G_j(L)).
\end{equation}

Yhteens� noin kuudensadan malliparametrin sovittamiseksi tarvitaan historiallisia havaintoja termosf��rin tiheyksist� ja l�mp�tiloista. IL-mallin t�rkein tietol�hde ovat 2000-luvulla tehdyt kokonaismassatiheysmittaukset, jotka on laskettu GRACE-, CHAMP- \citep[esim.][]{bruinsma_2006} ja GOCE- \citep{bruinsma_2014} painovoimasatelliittien tarkkojen kiihtyvyysanturien avulla. Kaasulajien lukum��r�tiheydet perustuvat my�s 1970- ja 1980- lukujen satelliittipohjaisiin massaspektrometrimittauksiin \citep[esim.][]{hedin_1974}, mutta suoria satelliittimittauksia on k�ytetty my�s eksosf��rin l�mp�tilan laskennassa. Alareunan l�mp�tila on laskettu kolmen ep�koherentin sirontatutkan (Arecibo, Millstone Hill, EISCAT) l�mp�tilamittauksista. Lis�ksi IL-malli on ensimm�inen puoli-empiirinen yl�ilmakeh�malli, joka hy�dynt�� NASA:n Thermosphere Ionosphere Mesosphere Energetics and Dynamics (TIMED) -satelliitin havaintoja alareunan l�mp�tilagradientista \citep{zhang_2006} ja UV-kanavalla tehtyj� luotauksia hapen ja typen korkeusprofiileista \citep{meier_2015}. 

Paramterien optimaaliset arvot m��ritet��n ep�lineaariseen optimointiin suunnatulla Levenberg-Marquardt -algoritmilla \citep[esim.][]{more_1978}, joka etsii parametreille pienimm�n neli�summan mieless� parhaat arvot. Algoritmin tuottaman virhekovarianssimatriisin avulla hyl�t��n sellaiset parametrit, joiden absoluuttinen virhe on yli kolmasosa parametrin suuruudesta. T�m�n j�lkeen sovitus lasketaan uudelleen ainoastaan tilastollisesti merkitseville parametreille. 

\begin{figure}[t]
\includegraphics[scale = 0.65]{gradu_tiheys}
\caption{IL-mallin ennuste yl�ilmakeh�n kokonaismassatiheydest� (yksik�ss� $kg/m^3$) leveyspiirin ja aurinkoajan funktiona kes�kuussa 400 km:n korkeudella. Keskiarvo pituuspiirien yli.}
\label{fig:tiheys}
\end{figure}

Kuva \ref{fig:tiheys} esitt�� IL-mallin kuvausta termosf��rin massatiheydest� kes�kuussa 400 km:n korkeudella. Suurimmat massatiheydet l�ytyv�t pohjoiselta pallonpuoliskolta (koska s�teilyl�mmitys ja keskim��r�inen molekyylimassa ovat siell� suuria) ja hieman keskip�iv�n j�lkeen auringon l�mmitetty� ilmakeh��. Pienin massatiheys saavutetaan aamu�ll� noin kello nelj�. Yksinkertaisuudestaan huolimatta IL-mallin tiheysennusteet vastaavat GOCE, CHAMP ja GRACE -satelliittien kiertoratakeskiarvoistettuja massatiheyshavaintoja noin 24\%:n neli�llisen keskiarvon virheell� (ei n�ytet�). 

\section{Kaksiriviset elementit -- termosf��rin massatiheyshavainnot}
\subsection{Tiheyden m��ritt�minen}

Pohjois-Amerikan ilmapuolustuskeskuksen (NORAD) teht�v�n� on ker�t� tietoa maata kiert�vist� keinotekoisista satelliiteista. Merkitt�v� osa NORAD:n havaintoaineistosta on julkisesti saatavilla ja nyky��n (toukokuu 2017) aineisto kattaa tiedot yli 40000:n satelliitin kiertoratojen muutoksista \citep{spacetrack}. Poikkeamia maata kiert�vien satelliittien ratoihin aiheuttavat; (1) maan painovoimakentt� ja sen ep�homogeenisuus, (2) ilmakeh�n ilmanvastusvoima, (3) kolmannen kappaleen, kuten Kuun tai Auringon painovoima, sek� (4) s�teilypaine s�hk�magneettisesta s�teilyst� \citep[ks. esim.][s. 326]{roy_2004}. Kappaleen kiertoradan aikakehitys kuvaa kaikkien n�iden poikkeuttavien voimien satelliittiin kohdistamaa yhteisvaikutusta, mutta tietyiss� erikoistilanteissa n�iden voimien vaikutukset on mahdollista erotella toisistaan. 

T�ss� ty�ss� keskityt��n tarkastelemaan kappaleita, joiden kiertoradan maata l�hin piste (perigeum) on alle 550 km:n korkeudella ja joiden kiertoaika on alle 225 minuuttia. Tarkasteluvuosina 2002 - 2004 auringon korkea aktiivisuus (voimakas UV-s�teily) oli kasvattanut ilmakeh�n skaalauskorkeutta siten, ett� t�llaisilla kiertoradoilla olevien kappaleiden ilmanvastusvoima on todenn�k�isesti suurempi kuin s�teilypaineen vaikutus \citep{picone_2005}. Lis�ksi n�in lyhyen jakson kiertorataan Kuun ja Auringon painovoimakenttien aiheuttamat poikkemat ovat pieni� ja voidaan j�tt�� huomiotta \citep{hoots_1980}. 

N�in ollen riitt�� tarkastella ainoastaan maapallon ep�homogeenisen painovoimakent�n ja ilmanvastuksen aiheuttamia muutoksia. Termosf��rin massatiheydest�, satelliitin muodosta ja nopeudesta riippuva ilmanvastusvoima voidaan lausua \citep[esim.][luku 8.6.2]{vallado_2001}:
\begin{equation} \label{airdrag_eq}
\mathbf{\dot{v}_D} = - \frac{1}{2} \rho B \left | \mathbf{v} - \mathbf{V} \right |^2 \mathbf{e_{v-V}},
\end{equation}
jossa $\mathbf{\dot{v}_D}$ on ilmanvastuksen aiheuttama kiihtyvyys, \textbf{v} on kappaleen ja \textbf{V} tuulen nopeus maakeskisess� inertiaalikoordinaatistossa, $\mathbf{e_{v-V}}$ on ilmakeh�n suhteen olevan nopeuden suuntainen yksikk�vektori, $\rho$ on ilmakeh�n massatiheys ja ballistinen kerroin:
\begin{equation} \label{ballistic_eq}
B = \frac{C_D A}{m},
\end{equation}
miss� $C_D$ on kappaleen ilmanvastuskerroin, $A$ on nopeutta vastaan kohtisuora pinta-ala ja $m$ on massa. Edell� esitellyist� ilmanvastukseen vaikuttavista tekij�ist� ainoastaan massa s�ilyy vakiona yhden (tai useamman) kiertoratakierroksen ajan, mik�li satelliitti ei menet� polttoainetta tai rakenneosasiaan (esimerkiksi kiertoratakorjauksen tai t�rm�yksen seurauksena). Nopeus ja ilmakeh�n tiheys vaihtelevat eniten, mutta my�s kerroin $C_D$ riippuu heikosti ilmakeh�n kaasukoostumuksesta \citep{moe_2006}. Nopeutta vastaan kohtisuora ala A taas tuulennopeudesta ja satelliitin mahdollisesta py�rimisest�. 

\begin{figure}[t]
\ttfamily
\scriptsize
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17124.83855883 +.00002555 +00000-0 +46104-4 0  9999

2 25544 051.6415 254.3711 0005715 124.5522 336.3551 \underline{15.53964796055018}
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17125.21849080 +.00002605 +00000-0 +46858-4 0  9996

2 25544 051.6415 252.4770 0005705 125.9198 301.8433 \underline{15.53967431055076}
\noindent\rule[0.5ex]{\linewidth}{1pt}

1 25544U 98067A   17125.47998944 +.00002778 +00000-0 +49476-4 0  9998

2 25544 051.6417 251.1751 0005804 127.0105 324.6272 \underline{15.53970335055110}
\noindent\rule[0.5ex]{\linewidth}{1pt}
\rmfamily
\caption{Kolme esimerkki� kansainv�lisen avaruusaseman (ISS) kaksirivisest� elementtidatasta vuonna  2017. Vanhin havainto ylimp�n�. Keskiliike (kierrosta p�iv�ss�) on alleviivattu.}
\label{fig:tle}
\end{figure}

Kuva \ref{fig:tle} esitt�� kolme esimerkki� NORAD:n tutkadatasta vouden 2017 toukokuulta, joiden avulla kiertoradan aikakehitys voidaan m��ritt��. Kaksirivisen jakeluformaattinsa vuoksi havaintoaineistoa kutsutaan kaksiriviseksi elementtidataksi. Ensimm�inen rivi antaa kappaleen tunnisteen (NORAD ID, esimerkiksi 25544 kansainv�liselle avaruusasemalle), havaintoajan (esimerkiksi 17124 vuoden 2017 p�iv�lle 124), sek� tietoja kiertoradan muutoksista \citep{spacetrack}. Toinen rivi antaa kuusi rataparametri�, jotka m��r��v�t tarkalleen kappaleen keskim��r�isen kiertoradan tietyn ajanjakson yli; j�rjestyksess� vasemmalta oikealle: (1) inklinaatio (esimerkiksi 051.6415) ja (2) nousevan noodin rektaskensio (254.3711) asteina, (3) Eksentrisyyden desimaaliosa (0005715), (4) perigeumin argumentti (124.5522) ja (5) keskianomalia (336.3551) asteina, sek� (6) keskiliike kierroksina p�iv�ss� (15.53964). Kyseess� ei kuitenkaan ole yksitt�inen havainto kappaleen kiertoradasta, vaan kaikki toisen rivin rataparametrit ovat keskiarvoja useiden havaintojen ja p�ivien yli. Keskiarvostuksen tarkka aikaikkuna ei ole julkista tietoa, mutta \citep{picone_2005} esitt�� sen olevan nyky��n noin kolme p�iv�� matalan maan kiertoradan satelliiteille. 

NORAD:n k�ytt�m�ss� sovitus- ja keskiarvoistusmenetelm�ss� kappaleen paikasta (ja joskus my�s nopeudesta) teht�viin tutkahavaintoihin sovitetaan tietty analyyttinen kiertoratamalli vaihtelemalla kaksirivisten elementtien arvoja siten, ett� mallin tulos vastaa mahdollisimman hyvin kappaleen havaittua kiertorataa \citep{hoots_1980}. T�m� analyyttinen malli, Simplified General Perturbation-4 (SGP4) \citep{lane_1979} sis�lt�� yksinkertaisen kuvauksen mapallon painovoimakent�st� ja sen ep�homogeenisuudesta, mink� ansiosta keskiarvoistus poistaa ep�homogeenisuuden aiheuttamat lyhytjaksoiset vaihtelut satelliitin kiertoradassa \citep{picone_2005}. 

Termosf��rin aiheuttaman ilmanvastusvoiman johdosta satelliitti menett�� kiertoratakorkeuttaan, sen radan eksentrisyys pienentyy ja  kiertonopeus kasvaa \citep{king_hele_1987}. Ilmanvastuksen m��ritt�miseksi on siis k�yt�nn�llist� hy�dynt�� kaksirivisen elementtidatan ilmoittamaa kiertoradan kulmanopeutta (keskiliike), josta maan painovoiman vaikutus on jo valmiiksi poistettu. T�ll�in siin� tapahtuvat muutokset aiheutuvat p��asiassa ilmakeh�n vaikutuksesta. Kuva \ref{fig:tle} antaa t�st� esimerkin; kansainv�lisen avaruusaseman kiertonopeus (alleviivattu) n�ytt�� selv�sti kasvavan ajan funktiona. T�ss� tutkielmassa hy�dynnet��n \citet{picone_2005} menetelm��, joka kytkee kvantitatiivisesti yhteen muutokset kiertonopeudessa ja ilmakeh�n tiheydess�. \citet{picone_2005} mukaan yht�l� \ref{airdrag_eq} voidaan esitt�� hetkellisen keskiliikkeen $n_M$ avulla muodossa:
\begin{equation} \label{meanmotion_eq}
\frac{d}{dt} n_M \cong \frac{3}{2} n_M^{1/3} \mu^{-2/3} \rho B v^3 F,
\end{equation}
miss� $\mu$ on maapallon gravitaatioparametri (gravitaatiovakion ja Maan massan tulo) 3,986 $\cdot 10^{14}~ \mathrm{m^3 s^{-2}}$ ja $\rho$, $B$, sek� $v$ ovat hetkellisi� arvoja tietyss� kiertoradan pisteess�. Tuulenvoimakkuusparametri F on dimensioton parametri, joka kuvaa tuulennopeuden vaikutusta kappaleen kokemaan ilmanvastusvoimaan:
\begin{equation} \label{F_eq}
F = \frac{\left | \mathbf{v} - \mathbf{V} \right |^2}{v^2} \mathbf{e_{v-V}} \cdot \mathbf{e_{v}}.
\end{equation}
Mik�li oletetaan maapallon mukana py�riv� virtaukseton ilmakeh�, hyv� approksimaatio on \citep{king_hele_1987}:
\begin{equation} \label{F_approx_eq}
F \cong \left ( 1 - \frac{r~\Omega_E}{v} \cos(i) \right )^2,
\end{equation}
miss� $\Omega_E$ on maapallon py�rimisen kulmanopeus $7.292 \cdot 10^{-5} ~\mathrm{s^{-1}}$, $i$ on satelliitin inklinaatio ja $r$ on et�isyys maapallon keskustasta. Approksimaation virhe on termosf��rin empiirisill� tuulimalleilla laskettuun yht�l��n (\ref{F_eq}) n�hden alle 3\%:a ja virhe on viel� pienempi kun yht�l�� (\ref{meanmotion_eq}) integroidaan useiden p�ivien yli. 

Yht�l�n (\ref{meanmotion_eq}) integrointi on mahdollista kahden eri kaksirivisen elementin v�lill� \citep{picone_2005}:
\begin{equation} \label{int_meanmotion_eq}
\Delta_{ik}n_M \cong \frac{3}{2} \mu^{-2/3} \oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt,
\end{equation}
miss� $\Delta_{ik} n_M$ kuvaa keskiliikkeen diskreetti� muutosta kahden elementin v�lill� ja viivaintegraali tarkoittaa integrointia useiden ratakierrosten yli ajanhetkien $t_i$ ja $t_k$ v�lill�. Keskiliikkeen muutos selvi�� suoraan kaksirivisten elementtien keskiarvoistetussa keskiliikkeess� havaitusta muutoksesta. Sen sijaan integrointiin tarvitaan v�ltt�m�tt� samaa SGP4-mallia, jota kaksirivisen elementtidatan keskiarvoistuksessa on k�ytetty, koska vain sen avulla keskiarvoistettu kiertorata on mahdollista muuttaa tutkien havaitsemaksi, ajassa muuttuvaksi kiertoradaksi \citep{hoots_1980}. Jos integroinnissa k�ytett�isiin jotain muuta mallia, eiv�t kaksisiriviset elementtidatat en�� antaisi l�hell� tutkahavaintoja olevaa kuvausta kappaleen kiertoradasta. Valitettavasti SGP4-mallin nykyinen l�hdekoodi ei kuitenkaan ole julkinen. Viimeisin virallinen julkaisu on 1980-luvulta \citep{hoots_1980}, mutta v�h�isi� my�hemmin julkaistuja korjauksia ja takaisinmallinnusta k�ytt�en siviilitutkijat \citet{vallado_2006} ovat laatineet mallista version, joka heid�n mukaansa vastaa tarkasti nykyist� kaksirivisten elementtien m��rityksess� k�ytetty� mallia. T�st� eteenp�in SGP4-mallilla tarkoitetaan aina t�t� julkista versiota.

Koska SGP4 antaa ainoastaan satelliitin inertiaalikoordinaatiston nopeuden ja paikan, ei yht�l�n (\ref{int_meanmotion_eq}) integrointia voi sellaisenaan suorittaa. Kuitenkin yht�l�st� (\ref{int_meanmotion_eq}) n�hd��n, ett� on olemassa jokin koko integroinnin yli vakiona pysyv� tiheys, joka toteuttaa yht�l�n tarkasti:
\begin{equation} \label{density_raw_eq}
\rho^H(t_{ik}) \equiv \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3}}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt} = \frac{\oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt},
\end{equation}
miss� yl�indeksi H tarkoittaa havaittua ja $t_{ik} \equiv (t_i + t_k) / 2$ on ajanhetki, jota tiheyden katsotaan data-assimilaatiossa kuvaavan. Kyseess� on kuitenkin satelliittin kokema "keskim��r�inen" tiheys, joka ei kuvaa mit��n tietty� pistett� tai ajanhetke�, vaan tiheyden vaikutusta useiden ratakierrosten yli. Integrointiin vaikuttaa lis�ksi jonkin verran SGP4-mallin sis�lt�m� analyyttinen ilmakeh�. T�m�n vaikutus on kuitenkin \citet{picone_2005} mukaan muutaman p�iv�n integroinnin aikana hyvin pieni, koska havaittu tiheys riippuu voimakkaasti kappaleen perigeumin korkeudesta, jonka muutokset ovat ilmakeh�n skaalauskorkeuteen n�hden merkityksett�mi�. K�yt�nn�ss� voidaan siis sanoa, ett� yht�l�n (\ref{density_raw_eq}) arvio on t�ysin riippumaton mist��n yl�ilmakeh�mallista, mik� mahdollistaa kaksirivisten elementtien k�yt�n mallista riippumattomana, todellista ilmakeh�n tilaa kuvaavana havaintoaineistona.

Olettamalla ballistinen kerroin vakioksi ja arvioimalla keskiliikkeen suuruutta kahden kaksirivisen elementin keskiliikkeiden keskiarvolla $n_M(t_{ik})$ p��dyt��n yht�l��n, jonka integraalitermi voidaan SGP4:n avulla laskea:
\begin{equation} \label{density_12_eq}
\rho^H(t_{ik}) \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{B^T \oint_{(t_i,t_k)}  v^3 F dt}  \cong \frac{\oint_{(t_i,t_k)} \rho^T v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt} \equiv \rho^T(t_{ik}),
\end{equation}
miss� yl�indeksi T viittaa "todelliseen" (ballistisen kertoimen m��ritys k�sitell��n seuraavassa osiossa). Vastaavasti l�ydet��n ekvivalentti mallitiheys, johon kaksirivisen elementtidatan avulla laskettua tiheytt� voidaan verrata:
\begin{equation} \label{density_13_eq}
\rho^M(t_{ik}) \equiv \frac{\oint_{(t_i,t_k)} \rho^M v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt},
\end{equation}
miss� yl�indeksi M viittaa yl�ilmakeh�n tiheysmalliin (t�ss� ty�ss� IL).

K�yt�nn�ss� yl�ilmakeh�n tiheyden m��ritys kaksirivisen elementtidatan avulla pit�� sis�ll��n seuraavat vaiheet:
\begin{enumerate}
\item Valitaan kappale, jonka kiertoradalla ilmanvastusvoima on suuri s�teilypaineeseen ja kolmannen kappaleen voimiin verrattuna.
\item Ladataan internetist� \citep{spacetrack} kappaleen kaksiriviset elementit riitt�v�n pitk�lt� ajanjaksolta.
\item Arvioidaan kappaleen todellinen ballistinen kerroin $B^T$ (katso seuraava osio), mik�li sit� ei ole aiemmin tehty.
\item Valitaan kaksi kaksirivist� elementti�, joiden epookkien $t_i$ ja $t_k$ v�lill� massatiheys m��ritet��n. 
\item Lasketaan satelliitin paikka ja nopeus SGP4-mallin avulla hyvin tihe�sti (t�ss� ty�ss� kerran puolessa minuutissa) kahden epookin v�lill�.
\item Lasketaan tuuliparametri F yht�l�st� (\ref{F_eq}) tai (\ref{F_approx_eq}) ja integroidaan yht�l�n (\ref{density_12_eq}) viivaintegraali numeerisesti (t�ss� ty�ss� puolisuunnikass��nn�ll� (l�hde)).
\item M��ritet��n keskiliikkeen muutokset kahden kaksirivisen elementin avulla ja arvioidaan ilmakeh�n keskim��r�inen tiheys yht�l�st� (\ref{density_12_eq}).
\end{enumerate}

\subsection{Kappaleiden valinta ja ballistisen kertoimen m��ritys}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.25]{Explorer_8}
\caption{Explorer 8 -satelliitti (NORAD ID 60), jota k�ytet��n yl�ilmakeh�n tiheyden m��rityksess�. Muodoltaan satelliitti muistuttaa kaksoiskartiota; kappaleen nopeusvektori avaruudessa osoittaisi kuvan tapauksessa l�hes suoraan yl�sp�in. (l�hde Wikimedia)}
\label{fig:explorer8}
\end{figure}

Kuten aiemmassa osiossa todetiin, termosf��rin massatiheys voi aiheuttaa aiheuttaa havaittavia poikkeamia matalalla kiertoradalla olevien kappaleiden ratoihin. Koska ty�n tavoitteena on tuottaa kolmiulotteinen korjaus IL-mallin termosf��rin tiheysennusteeseen, tarvitaan t�ss� tutkielmassa kymmeni� eri kappaleita, jotka kiert�v�tt eri korkeuksilla, aurinkoajoilla ja leveyspiireill�. K�yt�nn�ss� on kuitenkin hyvin vaikeaa valita useiden tuhansien satelliittien joukosta ne, joita termosf��ritutkimuksissa voidaan k�ytt��; satelliitti ei saisi olla toimintakuntoinen, sen olisi oltava s��nn�llisen muotoinen (katso esimerkiksi Kuva \ref{fig:explorer8}) eik� se saisi py�ri�, jotta sen ballistista kerrointa voidaan arvioida vakiona. T�m�n ty�n data-assimilaatioj�rjestelm�ss� k�ytetyt 44 satelliittia ja nelj� riippumatonta arviointisatelliittia on valittu aiempien tutkimusten \citep[esim.][]{emmert_2004,saunders_2011} perusteella. Erityisen t�rke� tietol�hde on ollut luettelo Yhdysvaltain ilmavoimien Avaruustaistelulaboratorion (\textit{US Air Force Space Battlelab}) High Accuracy Satellite Drag Model (HASDM)-mallissa k�ytetyist� 80:sta kappaleesta \citep{doornbos_2004}. 

Vaikka aiemmissa tutkimuksissa tiheysanalyysiin sopivia kappaleita on l�ydetty kymmenitt�in, on niiden todellisen ballistisen kertoimen m��ritt�minen hankalaa \citep{bowman_2002}. T�m� aiheutuu p��asiassa siit�, ett� ballistinen kerroin riippuu ilmanvastuksesta ja ilmakeh�n tiheydest� itsest��n yht�l�n (\ref{density_12_eq}) mukaan:
\begin{equation} \label{Bi_eq}
B_i \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)} \rho^T v^3 F dt},
\end{equation}
miss� $B_i$ on keskim��r�inen ballistinen kerroin epookkien v�lill�. K�yt�nn�ss� t�m� tarkoittaa sit�, ett� kappaleen kiertoratahavainnoista johdettu ballistinen kerroin vaihtelee kaiken aikaa. Kertoimen todellisen arvon m��rityst� vaikeuttaa viel� se, ettei yht�l�ss� (\ref{Bi_eq}) tarvittavaa ilmakeh�n todellista tiheytt� $\rho^T$ tunneta. T�st� syyst� usein k�ytet��n todellisen tiheyden tilalla empiirisen termosf��rimallin tiheytt� $\rho^M$(l�hde esim. Doornbos) ja todellisen ballistisen kertoimen arvossa k�ytet��n epookkien $B_i$-arvojen keskiarvoa useiden vuosien yli. 

\begin{figure}[t]
\includegraphics[scale = 0.5]{gradu_Bi}
\caption{Ballistisen kertoimen ja tiheyskorkeuden aikasarja Explorer 8 -satelliitille. Kuvassa punaisten viivojen sis�puolelle j��v�� vuotta 2003 ei ole huomioitu ballistisen kertoimen laskennassa, koska sit� k�ytet��n data-assimilaatio-j�rjestelm�n suorituskyvyn arviointiin.}
\label{fig:Btrue}
\end{figure}

T�t� menetelm�� k�ytet��n my�s t�ss� tutkielmassa. Kuva \ref{fig:Btrue} esitt�� Explorer 8 -satelliitin $B_i$-kertoimien aikasarjaa ja sit� korkeutta, jota satelliitin radasta m��ritetyn massatiheyden voidaan parhaiten katsoa kuvaavan (niin sanottu tiheyskorkeus eli tekij�ll� $\rho^M v^3 F$ painotettu keskiarvo geometrisest� kiertoratakorkeudesta). Data-assimilaatio-j�rjestelm�n toimivuutta testataan vuoden 2003 datalla, joten todellinen ballistinen kerroin m��ritell��n vuosien 2002 ja 2004 kertoimien $B_i$ keskiarvona. Jotta epookkien v�linen ballistisen kertoimen satunnaisvaihtelu olisi mahdollisimman pient�, k�ytet��n yht�l�n (\ref{Bi_eq}) integroinnissa v�hint��n kymmenen p�iv�n integrointipituutta, mink� johdosta havaitut keskiliikkeen muutokset ovat suurempia ja merkitsev�mpi�. K�yt�nn�ss� ballististen kertoimien keskiarvoistus tekee kappaleiden avulla teht�v�n tiheysm��rityksen IL-mallin suhteen harhattomaksi (pitkien ajanjaksojen yli).

Explorer 8 -satelliitin ballistisen kertoimen aikasarjalla on selv�sti vahva puolivuosittainen komponentti, jossa $B_i$:n paikalliset maksimit osuvat mielenkiintoisesti samoihin aikoihin kuin termosf��rin globaalin massatiheyden maksimit \citep{emmert_2015}. T�m� todenn�k�isesti kertoo mallin ajallisesti vaihtelevasta virheest� kappaleen kiertoradalla, sill� yht�l�iden (\ref{density_12_eq}) ja (\ref{density_13_eq}) perusteella:
\begin{equation} \label{obsToModel_eq}
\frac{\rho^H}{\rho^M} \cong \frac{B_i}{B^T}.
\end{equation}
N�in ollen IL-malli aliarvioisi yl�ilmakeh�n puolivuosittaista massatiheysvaihtelua t�ss� yksitt�istapauksessa. Muiden satelliittien ballistinen kerroin k�ytt�ytyy hyvin usein samanlaisella tavalla, mutta v�r�htelyn taajuus vaihtelee nelj�nnesvuosittaisesta vuosittaiseen (ei n�ytet�). 

T�m� per�kk�isten $B_i$ -havaintojen suuri kovarianssi vaikeuttaa $B^T$:n virhearvion tekemist�. T�ss� tutkielmassa todellisen ballistisen kertoimen virhearviona k�ytet��n satunnaisjakautuneen muuttujan keskiarvon keskivirhett� (esim. l�hde):
\begin{equation} \label{Bi_err_eq}
\sigma_{B^T} = \frac{s_{B_i}}{\sqrt{N_{B_i}}},
\end{equation}
jossa $\sigma_{B^T}$ on kertoimen virhe, $s_{B_i}$ on vuosien 2002 ja 2004 $B_i$ -havaintojen keskihajonta ja $N_{B_i}$ havaintojen lukum��r�. Vaikka kyseess� on havaintojen suuresta autokorrelaatiosta johtuen selke� aliarvio, vaihtelee virhearvio 3\%:n ja 10\%:n v�lill�. T�m� kvalitatiivisesti vastaa aiempia arvioita kaksirivisill� elementeill� saavutettavasta tarkkuudesta \citep[esim.][]{Doornbos_2007}. Lis�ksi havainnot ballistisesta kertoimesta eiv�t ole aivan normaalijakautuneita, jolloin $\sigma_{B^T}$ ei v�ltt�m�tt� kunnolla kuvasta ballistisen kertoimen vaihtelua. 

Aiemmissa tutkimuksissa k�ytetyist� kappaleista valittiin ne 48 kappaletta, joiden (1) kaksirivisi� elementtej� oli saatavilla vuosina 2002 -- 2004 v�hint��n kuuden p�iv�n v�lein, (2) keskim��r�inen tiheyskorkeus oli alle 550 km, (3) keskiliikkeen trendi selv�sti kasvava ja (3) yksitt�iset $B_i$ -arvot poikkesivat keskiarvostaan enint��n tekij�ll� 5. Kaksirivisten elementtien perusteella laskettujen $B_i$ -arvojen hajonta kasvoi ja keskiliikken kasvuvauhti hidastui merkitt�v�sti yli 550 km:n tiheyskorkeudella, joten t�ss� ty�ss� oletetaan, ett� hy�dyllisi� tiheyshavaintoja on saatavilla vain t�m�n korkeuden alapuolelta. Kappaleista (!!!!!!!) kolme, keirtoradalle j��neet raketin osat 1616 (tiheyskorkeus 437 km), 2017 (538 km), ja 23198 (397 km) toimivat riippumattomina kappaleina, joiden avulla data-assimilaation laatua voidaan arvioida. Kyseiset kolme ki

%\pgfplotstabletypeset[]{Bfactors.csv}

\section{Ensemble Kalman -suodin}

\subsection{Taustaa}

Data-assimilaation tavoitteena on korjata mallin ennustetta havaintojen avulla siten, ett� mallin tila vastaa mahdollisimman tarkasti tutkittavan j�rjestelm�n todellista tilaa. Data-assimilaatio on t�rke� osa operatiivisia s��nennustusj�rjestelmi�, sill� sen avulla voidaan mallille asettaa mahdollisimman todenmukainen alkutila, jota mallin yht�l�t kehitt�v�t ajassa eteenp�in. 

Koska sek� havainnot ett� malli sis�lt�v�t virhett�, saadaan paras kuva j�rjestelm�n todenn�k�isimm�st� tilasta yhdist�m�ll� mallin ja havaintojen tiedot kesken��n. Olettamalla virheiden olevan normaalijakautuneiden, voidaan mallin tilan $\mathbf{x}$ todenn�k�isyysjakauma lausua ainoastaan mallin taustan (eli korjaamattoman ennusteen) $\mathbf{x_b}$ avulla \citep{nichols_2010}:
\begin{equation} \label{model_prob_eq}
P(\mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b})\right ],
\end{equation}
miss� $\mathbf{B}$ on mallin taustan kovarianssimatriisi. Koska malli ja havainnot kuvaavat samaa j�rjestelm��, on mielek�st� m��ritell� havaintojen $\mathbf{y}$ ehdollinen todenn�k�isyys, kun mallin tila $\mathbf{x}$ on tunnettu:
\begin{equation} \label{data_prob_eq}
P(\mathbf{y} | \mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ],
\end{equation}
jossa $\mathbf{R}$ ilmaisee havaintojen kovarianssin ja $H$ on niin sanottu havainto-operaattori, joka on kuvaus malliavaruudesta havaintoavaruuteen. Havainto-operaattori ilmaisee, mit� arvoja tulisi havaita, mik�li mallitila on annetun ja havainnot virheett�mi�.

N�iden kahden todenn�k�isyyden ja Bayesin lauseen avulla saadaan m��ritetty� todenn�k�isyys mallin tilalle, kun havainnot ovat annetujen \citep{nichols_2010}:
\begin{align} \label{final_prob_eq}
P(\mathbf{x} | \mathbf{y}) \propto P(\mathbf{y} | \mathbf{x}) P(\mathbf{x}) \propto 
\exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ].
\end{align}
Eksponenttifunktion monotonisuuden johdosta suurin todenn�k�isyys l�ydet��n minimoimalla lauseketta (niin sanottua sakkofunktiota):
\begin{align} \label{J_eq}
 J~=~\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) + \frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x})).
\end{align}
T�m�n funktion minimikohta antaa j�rjestelm�n todenn�k�isimm�n tilan eli niin sanotun analyysin $\mathbf{x}=\mathbf{x_a}$.

Data-assimilaatio-j�rjestelm�t jaetaan kahteen p��luokkaan sen mukaan, minimoivatko ne funktiota (\ref{J_eq}) suoraan jollakin iteratiivisella minimointialgoritmilla (variaatiomenetelm�t) \citep[esim.][]{talagrand_2010}, vai ratkaisevatko ne joukon lineaarisia yht�l�it� j�rjestelm�n todenn�k�isimm�n tilan l�yt�miseksi (per�kk�iset menetelm�t) \citep[esim.][]{bertino_2003}. Er�s k�ytetyimmist� per�kk�isist� data-assimilaatio-menetelmist� on Kalman-suodin \citep{kalman_1960}, joka tuottaa lineaariselle j�rjestelm�lle harhattoman analyysin ja eksaktit virhekovarianssit. Kalman-suotimen toiminta perustuu sakkofunktion minimointiin analyyttisen ratkaisun avulla, joka l�ytyy sakkofunktion derivaatan ($\partial J / \partial \mathbf{x}$) nollakohdasta. T�m�n nollakohdan laskennassa oletetetaan, ett� havainto-operaattori $H$ on linearisoitavissa siten, ett�:
\begin{align} \label{tanglin_eq}
H(\mathbf{x})-H(\mathbf{x_b}) \cong \mathbf{H}(\mathbf{x-x_b}),
\end{align}
miss� $\mathbf{H}$ on tangentti-lineaarinen havainto-operaattori eli havaintojen Jacobin matriisi mallitilan suhteen $\mathbf{H_{ij}} = \partial y_i / \partial x_j$. T�m�n (approksimaation) avulla analyysiksi l�ydet��n:
\begin{align} \label{xa_eq}
\mathbf{x_a} = \mathbf{x_b} + \mathbf{K}(\mathbf{y} - H(\mathbf{x_b})),
\end{align}
jossa 
\begin{align} \label{K_eq}
\mathbf{K} = \mathbf{B H^T}(\mathbf{HBH^T} + \mathbf{R})^{-1}
\end{align}
on Kalmanin optimaalinen painomatriisi, $\mathbf{HBH^T}$ ilmaisee mallin ennustaman havaintojen virhekovarianssin, ja $\mathbf{BH^T}$ kovarianssin havaintojen ja mallitilan v�lill�. Mit� tarkempia havainnot ovat suhteessa taustaan, sit� enemm�n painoa niille annetaan ja sit� l�hemm�s havaintoja mallitila pyrkii; p�invastaisessa tilanteessa analyysi ei juurikaan poikkea taustasta.

Kalman-suotimessa mallitilan aikakehityksess� tarvittavan ennustusmallin lis�ksi on kuitenkin oltava malli, joka kehitt�� analyysin kovarianssia 
\begin{equation} \label{analysis_cov_eq}
\mathbf{A}^n\mathbf{ = (I-KH)B}^{n}
\end{equation}
ajassa eteenp�in \citep[esim.][]{kalnay_2010}:
\begin{align} \label{time_evol_eq}
\mathbf{B}^{n+1} = \mathbf{MA}^n\mathbf{M^T},
\end{align}
miss� yl�indeksi n viittaa aikaan ja $\mathbf{M} = \partial M / \partial \mathbf{x_a}$ on (ep�lineaarisen) mallin $M$ linearisoitu eli tangentti-lineaarinen malli. 

Kalman-suodin ei kuitenkaan sovellu sellaisenaan k�ytett�v�ksi nykyaikaisissa s��malleissa, sill� taustan ja analyysin kovarianssimatriisit muodostuisivat niin suuriksi, ettei niit� nykyisill� tietokoneilla voisi k�sitell� \citep[esim.][]{mackenzie_2003}. Lis�ksi tangentti-lineaaristen havainto-operaattorien ja mallin kehitysty� vaatii paljon aikaa, ennen kuin data-assimilaatioj�rjestelm�� voidaan hy�dynt��. Yksinkertaisemmalle ja tehokkaammalle j�rjestelm�lle on siis tarvetta; \citet{evensen_1994} esitteli suotimesta Monte Carlo -version, niin sanotun ensemble Kalman-suotimen (EnKF, englanniksi \textit{Ensemble Kalman Filter}). EnKF k�ytt�� taustan kovarianssin arviointiin malliryp�st�, joka on ��rellinen otos mallitilojen todenn�k�isyysjakaumasta. T�m�n otoskovarianssin avulla Kalmanin optimaalinen painomatriisi voidaan m��ritt�� ja n�in p�ivitt�� mallirypp��n tilat.

Ryp�s on kokoelma malleja, joiden tilat poikkeavat hieman toisistaan. Se voidaan esitt�� matriisina, jonka jokainen sarake (pituus m) edustaa yht� mallitilaa ja jokainen rivi (pituus N) yhden mallin muuttujan tilan todenn�k�isyysjakaumaa \citep[esim.][]{evensen_1994}:
\begin{equation} \label{ens_eq}
\mathbf{X} = \mathbf{[x_1,x_2,...,x_N] = [x_i]}.
\end{equation}
Rypp��n mallitilojen oletetaan olevan todenn�k�isyysjakauman satunnaisotos, mutta tarkalleen ottaen per�kk�inen data-assimilaatio EnKF:lla tekee niiden tilat riippuviksi toisistaan. Mallitaustan kovarianssi voidaan arvioida suoraan rypp��n avulla:
\begin{equation} \label{enscov_eq}
\mathbf{C} = \frac{\mathbf{AA^T}}{N-1},
\end{equation}
miss� $m \times N$ -matriisi 
\begin{equation} \label{A_eq}
[\mathbf{A}]_i = \mathbf{x}_i - E(\mathbf{X})
\end{equation}
ja ryp�skeskiarvo
\begin{equation} \label{E_eq}
E(\mathbf{X}) = \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k}.
\end{equation}

Koska mallitilan lis�ksi havainnot sis�lt�v�t ep�varmuutta, kuvataan havaintovektoria $\mathbf{y}$ samalla tavoin joukkona satunnaisotoksia:
\begin{equation} \label{data_eq}
\mathbf{Y} = \mathbf{[y_1,y_2,...,y_N] = [y_i]},~\mathbf{y_i = y + \epsilon_i},
\end{equation}
jossa Y on $o \times N$ -matriisi, jonka sarakeisiin on lis�tty $N(0,\mathbf{R})$ -jakautuneita o-pituisia satunnaislukuvaktoreita $\mathbf{\epsilon_i}$. 

N�iden avulla Kalman-suotimen analyysiyht�l� saa muodon:
\begin{equation} \label{enkf_anal_eq}
\mathbf{X_a = X_b + CH^T (HCH^T+R)^{-1} (Y-HX)}.
\end{equation}
Koska taustan kovarianssi arvioidaan jokaisella assimilaatiokierroksella yht�l�st� (\ref{enscov_eq}), ei yht�l�n (\ref{time_evol_eq}) kaltaista kovarianssimatriisin kehitysyht�l�� en�� tarvita. Kehitt�m�ll� jokaista rypp��n mallia seuraavalle assimilaatiohetkelle, mahdollisesti hyvin ep�lineaarinen ennustusmalli kehitt�� samalla my�s kovarianssia itse��n ajassa eteenp�in. N�in ollen EnKF ei tarvitse tangentti-lineaarista mallia toimiakseen, mik� helpottaa algoritmin implementointia. 

Yht�l�ss� (\ref{enkf_anal_eq}) on kuitenkin j�ljell� tangentti-lineaarinen havainto-operaattori $\mathbf{H}$. Sijoittamalla analyysiyht�l��n kovarianssin lauseke (\ref{enscov_eq}) ja olettamalla taustan ja havaintojen virheet korreloimattomiksi, saadaan yht�l� muotoon \citep{mandel_2006}:
\begin{align} \label{ha_analysis_eq}
\mathbf{X_a = X_b} + \frac{1}{N-1} \mathbf{A A^T H^T} (\frac{1}{N-1} \mathbf{H A A^T H^T+R)^{-1} (Y-HX)}\nonumber \\
= \mathbf{X_b} + \frac{1}{N-1} \mathbf{A (HA)^T} (\frac{1}{N-1} \mathbf{HA(HA)^T  + R)^{-1} (Y-HX)}
\end{align}
T�ss� matriisi $\mathbf{HA}$ voidaan lausua ep�lineaarisen havainto-operaattorin $H$ avulla:
\begin{align} \label{HA_eq}
[\mathbf{HA}]_i = \mathbf{H x_i} - \mathbf{H} \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k} \nonumber\\
\cong H(\mathbf{x_i}) - \frac{1}{N} \sum_{k=1}^{N} H(\mathbf{x_k}).
\end{align}
Selv�sti my�s $\mathbf{[HX]}_i \cong H(\mathbf{x_i})$, joten yht�l� (\ref{HA_eq}) voidaan esitt�� ainoastaan ep�lineaarisen operaattorin $H$ avulla. N�in ollen tarvetta tangentti-lineaarisille operaattoreille ei EnKF:ssa lainkaan ole. 

Ensemble Kalman-suotimeen liittyy monien etujensa lis�ksi joitain vaikeuksia. Suurimmat ongelmat liittyv�t suotimen Monte Carlo -luonteeseen; kuinka voidaan varmistaa, ett� malliryv�s on edustava otos j�rjestelm�n tilan todenn�k�isyysjakaumasta? Ongelmat ovat suurimmillaan, kun rypp��n koko $N$ on pieni \citep{houtekamer_1998}. Jos malleja on liian v�h�n esitt�m��n todenn�k�isyysjakauman vaihtelua, on j�rjestelm� alin�ytteistetty. Alin�ytteistys on voi johtaa tilanteeseen, jossa analyysin kovarianssia j�rjestelm�llisesti aliarvioidaan \citep{lorenc_2003}. Virhe analyysin kovarianssissa ilmenee virheen� seuraavan assimilaatiosyklin taustan kovarianssissa, jolloin havaintojen ja taustan kovarianssien suhde ei ole oikein ja siten n�iden avulla tuotettu analyysi on virheellinen. 

Yht�l�n (\ref{analysis_cov_eq}) mukaisesti analyysin kovarianssi on taustan kovarianssia pienempi. Yhdess� alin�ytteistyksen aiheuttaman j�rjestelm�llisen aliarvion kanssa t�m� voi aiheuttaa suotimen konvergenssia, jossa mallirypp��n j�senet l�hestyv�t ajan kuluessa toisiaan \citep[esim.][]{hamill_2001}. T�ll�in havaintojen kovariannsi suhteessa taustan kovarianssiin kasvaa ja havaintojen merkitys mallirypp��n p�ivityksess� k�y lopulta hyvin pieneksi. Suodinkonvergenssia vastaan on EnKF:aa hy�dynt�viss� data-assimilaatioj�rjestelmiss� usein menettely, joka keinotekoisesti kasvattaa analyysin tai taustan kovarianssia \citep{whitaker_2002}. T�ss� ty�ss� k�ytetty� kovarianssin kasvatusmenetelm�� k�sitell��n tarkemmin seuraavassa osiossa.

Kovarianssin pienenemisen lis�ksi alin�ytteistys aiheuttaa mallitilan kovarianssiin ep�fysikaalista kohinaa eli niin sanottuja harhaanjohtavia korrelaatioita \citep{evensen_2003}. Fysikaalisessa hilapisteavaruudessa toimivien mallien hilapisteiden arvot voivat n�enn�isesti korreloida kesken��n, vaikka niiden v�linen et�isyys olisi suuri. Koska kausaalinen yhteys hilapisteiden arvojen v�lill� pienenee pisteiden v�lisen et�isyyden funktiona, voi luonteeltaan globaalissa (kaikki havainnot vaikuttavat kaikkiin mallin muuttujiin) EnKF:ssa kehitty� tilanne, jossa kaukana hilapisteest� oleva havainto vaikuttaa ep�fysikaalisen paljon hilapisteen analyysiin. Diskreeteiss� hilamalleissa, jotka laskevat mallirypp��n avulla eksplisiittisen taustan kovarianssin, voidaan harhaanjohtavia korrelaatioita torjua pienent�m�ll� hilapisteiden v�list� kovarianssia jonkin funktion mukaisesti \citep{houtekamer_2001}. Samanlainen menettely on mahdollista my�s palloharmonisissa malleissa tekem�ll� oletuksia virheen isotrooppisuudesta tai k�ytt�en pseudo-spektraalimenetelm�� \citep{buehner_2012}. T�ss� ty�ss� taustakovarianssin harhaanjohtavia korrelaatioita ei kuitenkaan yritet� korjata.

\subsection{Ensemble Kalman -suodin Iipponen-Laitinen -mallissa}

Ensemble Kalman -suodinta on aiemmin hy�dynnetty yl�ilmakeh�mallien data-assimilaatiossa \citep[esim.][]{chen_2016,chartier_2016}. T�ll�in kyseess� ovat kuitenkin olleet fysikaaliset mallit, jotka integroivat yl�ilmakeh�� kuvaavia primitiiviyht�l�it� ajassa eteenp�in. Puoli-empiirisi� malleja on sen sijaan korjattu sovittamalla havaintoihin funktiosovitus \citep{doornbos_2005,Doornbos_2007}, joka on kokonaan j�tt�nyt huomiotta mallin taustan. Lis�ksi aiemmat empiiristen mallien data-assimilaatiot ovat olleet t�ysin deterministisi�, kun taas EnKF voi antaa kuvauksen ilmakeh�n tilan todenn�k�isyysjakaumasta.

T�ss� ty�ss� ilmakeh�mallin massatiheytt� korjataan \citet{Doornbos_2007} esitt�m�ll� tavalla, jossa korjataan ainoastaan mallin ala- (130 km:ssa) ja yl�rajan (eksosf��ri) l�mp�tiloja. T�m� l�mp�tilaprofiilin muutos vaikuttaa kaikkien ilmakeh�n kaasulajien skaalauskorkeuksiin ja siten massatiheyteen vakiokorkeuspinnoilla. Mallin alarajalla absoluuttista l�mp�tilaa $\mathrm{T_0}$ ja sen pystysuuntaista gradienttia $T'$ korjataan skalaarien $\mathrm{\Delta T_0}$ ja $\mathrm{\Delta T'}$ avulla:
\begin{align} \label{lb_ass_eq}
\mathrm{T_{0,a}} = \mathrm{T_{0,IL}} + \mathrm{\Delta T_0} \\
\mathrm{T'}_= \mathrm{T'}_{IL} + \mathrm{\Delta T'}
\end{align}
Korjaukset ovat siis aina lis�yksi� korjaamattoman IL-mallin l�mp�tilakenttiin. 

Koska l�hes isotermisen keski- ja yl�termosf��rin l�mp�tilavaihtelut ovat suurempia kuin alatermosf��rin \citep{emmert_2015}, on eksosf��rin l�mp�tilalla alareunan arvoja suurempi vaikutus termosf��rin tiheyteen. N�in ollen eksosf��rin l�mp�tilakuvauksen on syyt� olla alareunan korjauksia realistisempi. Eksosf��rin l�mp�tilaa korjataan k�ytt�en palloharmonista sarjaa:
\begin{equation} \label{deltaTex_eq}
\mathrm{\Delta T_{ex}} = a_0 + \sum_{n=1}^{N}\left [ \sum_{m=0}^{n} a_{nm} P_{nm}(sin(\phi)) cos(m \lambda ) + \sum_{m=0}^{n} b_{nm} P_{nm}(sin(\phi)) sin(m \lambda ) \right ],
\end{equation}
jossa $a_{nm}, b_{nm}$ ovat reaaliarvoisten palloharmonisten funktioiden kertoimia, $n$ on asteluku, $m$ on kertaluku (zonaalinen aaltoluku), $N$ on suurin aste- ja kertaluku (kolmiomainen katkaisu TN \citep{ifs_numerics}), $\phi$ on leveyspiiri, $\lambda$ on aurinkoaika ja 
\begin{equation} \label{legendre_eq}
P_{nm}(x) = \frac{(-1)^m}{2^n n!} (1-x^2)^{m/2} \frac{d^{n+m}}{d x^{n+m}} (x^2 - 1)^n
\end{equation}
ovat normalisoimattomat Legendren liittofunktiot. T�ss� ty�ss� rajoitutaan palloharmoniseen korjaukseen T2, jonka avulla suuriamplitudinen p�iv�- ja puolip�iv�vaihtelu voidaan hyvin karakterisoida. N�in ollen mallitila koostuu yhteens� 11:a korjausparametrist� (kaksi alarajalla ja yhdeks�n yl�rajalla).

Jotta mallitilan ja havaintojen kovarianssien suhde voitaisiin m��ritt��, on havaintoaineistolle oltava selke� virhearvio. T�m�n ty�n data-assimilaatioj�rjestelm�ss� havaintoina k�ytet��n ainoastaan kaksirivisi� elementtej�. Ongelma kuitenkin on, ettei kaksirivinen elementtiaineisto pid� sis�ll��n mit��n tietoa havaintoep�varmuudesta, eik� k�ytt�j�n ole mitenk��n mahdollista selvitt�� alkuper�isten tutkahavaintojen tai ratasovituksen tarkkuutta \citep{picone_2005}. Siksi t�ss� ty�ss� oletetankin kaksirivisten elementtien itsess��n olevan hyvin tarkkoja, suurimman ep�varmuuden muodostuessa satelliitin todellisen ballistisen kertoimen $B^T$ m��rityksest�. N�in ollen virheen kasautumislaista ja yht�l�st� (\ref{density_12_eq}):
\begin{equation} \label{densErr_eq}
\sigma_{\rho^H} \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)}  v^3 F dt} \frac{\sigma_{B^T}}{(B^T)^2}.
\end{equation}
Kirjoittajan tietojen mukaan t�m� on ensimm�inen kerta, kun kaksirivisten elementtien assimilaatiossa otetaan huomioon tiheyden ep�varmuus. 

Koska yht�l�iden (\ref{density_12_eq}) antama tiheys vaihtelee useita kertaluokkia l�pi termosf��rin ja koska tiheys on pieni suhteessa mallitilan parametreihin, assimiloidaan t�ss� ty�ss� data malliin logaritmisessa koordinaatistossa. T�ll�in tiheyden ep�varmuus (yht�l� (\ref{densErr_eq})) saa virheen kasautumislaista muodon:
\begin{equation} \label{densErrLog_eq}
\sigma_{\ln(\rho^H)} = \sigma_{\rho^H} \frac{\partial}{\partial \rho^H} \ln(\rho^H) = \sigma_{\rho^H} / \rho^H.
\end{equation}
Logaritmisen koordinaatiston oletetaan parantavan numeerista vakautta ja siten suotimen tarkkuutta. 

Jokaisella assimilaatiosyklill� havainnoiksi valitaan ne kappaleet, joiden kaksirivisten elementtien epookkien keskiarvo $t_{ik}$ osuu assimilaatioikkunaan (aikav�li, jolta havaintoja assimilaatiota varten ker�t��n). Koska kaksirivisen elementtidatan aikaresoluutio on noin kolme p�iv��, vaaditaan tiheyden m��rityksess� k�ytettyjen elementtien epookkien eroksi my�s v�hint��n kolme p�iv��. Jotta yhteen assimilaatioon olisi k�ytett�viss� mahdollisimman paljon dataa, ja jotta aikaresoluutio olisi hyv�, kolme p�iv�� valittiin my�s assimilaatioikkunan pituudeksi. Aina ennen seuraavaa assimilaatiosykli� asetetaan $t_i = t_k$ eli saman kappaleen tiheyden integrointia jatketaan siit�, mihin edellisen syklin aikana on j��ty. Kappaleista kuitenkin hyl�t��n ne, joiden keskiliike on pienentynyt. L�hemmiss� tarkasteluissa todettiin, ett� muihin muuttujiin, kuten $B_i$:hin liittyv�� eliminointia ei tarvinnut tehd�, koska kaikki 44 kappaletta oli valittu siten, ett� ne antavat realistiselta vaikuttavaa tiheysinformaatiota (kun keskiliike kasvaa). 

Assimiloitavien havaintojen vastineet lasketaan mallitiloista ep�lineaarisen havainto-operaattorin avulla. Havainto-operaattori lis�� IL-mallin ala- ja yl�rajan l�mp�tiloihin korjaukset (\ref{lb_ass_eq}) ja (\ref{deltaTex_eq}), laskee SGP4-kiertoratamallilla satelliitin paikan puolen minuutin v�lein, muuttaa sen inertiaalikoordinaatistosta maantieteellisiin koordinaatteihin, m��ritt�� ilmakeh�n tiheyden korjatulla IL-mallilla kiertoradalle lasketuissa pisteiss� ja palauttaa yht�l�n (\ref{density_13_eq}) mukaisesti painotetun tiheyden logaritmin. $H$ ottaa my�s huomioon aikadimension -- IL-mallin laskennassa k�ytet��n assimilaatioikkunaa lyhyemmill� aikav�leill� vaihtelevia F30- ja AE-indeksej�, jotka vaikuttavat IL-mallin globaaliin l�mp�tila- ja tiheysjakaumaan.

Mallirypp��n kooksi valittiin N = 100 mallia, koska merkitt�v�� parannusta assimilaatioj�rjestelm�n suorituskyvyss� ei suuremmilla rypp�ill� havaittu (ei n�ytet�). Malliryv�s alustetaan arpomalla jokaiselle korjausparametrille N-kappaletta keskihajonnalla 100 K ($\mathrm{\Delta T'}$:lle 5 K/km) jakautuneita normaalijakauman satunnaislukuja. Rypp��n kovarianssin kuitenkin todettiin pienenev�n ja pienenev�n kun havaintojen assimilaatiota malliin suoritettiin useita kertoja. T�m� on merkki suotimen konvergenssista (katso edellinen osio) ja j�rjestelm�ss�mme sit� korjataan pit�m�ll� taustan eksosf��rin l�mp�tilakorjauksen varianssi vakiona \citep{morozov_2013}:
\begin{equation} \label{inflation_eq}
\mathbf{\Delta T_{ex}}_{, korj.} = \sqrt{\frac{s}{\sigma^2_{\mathbf{\Delta T_{ex}}}}} (\mathbf{\Delta T_{ex}} - E(\mathbf{\Delta T_{ex}})) + E(\mathbf{\Delta T_{ex}}),
\end{equation}
miss� $\mathbf{\Delta T_{ex}}$ on vektori kaikkien rypp��n mallien arvoista, $E(\mathbf{\Delta T_{ex}})$ on vektorin keskim��r�inen arvo ja s on haluttu (vakiona pysyv�) varianssi (niin sanottu inflaatioparametri). 

\begin{figure}[t]
\centering
\includegraphics[scale = 0.6]{gradu_jarjestys}
\caption{Mallin taustasta laskettujen havaintojen j�rjestyslukujen jakauma vuosina 2002 ja 2004 yht�l�n (\ref{inflation_eq}) inflaatioparametrin arvolla $s = 25~\mathrm{K}^2$.}
\label{fig:rank}
\end{figure}

Paras arvo varianssille l�ydet��n tarkastelemalla havaittujen arvojen sijaintia suhteessa mallirypp��n vertailuarvoihin \citep{hamill_2001b, jarvinen_2015}. Mik�li kunkin havainnon kohdalla havainto ja mallirypp��n N vastinetta asetetaan kasvavaan j�rjestykseen, havainnon sijaintia suhteessa rypp��seen kuvaa havaintoarvon j�rjestysluku $k$. Jos $k = 1$, havainto on pienempi kuin yksik��n rypp��n arvioista ja jos $k = N + 1$, kaikki rypp��n vastineet ovat havaintoa pienempi�. Sit�vastoin v�lill� $1 < k < N+1$ havainto osuu rypp��n sis��n. Laadukkaassa (ja harhattomassa) ennustusj�rjestelm�ss� j�rjestysluku $k$ onkin tasaisesti jakautunut satunnaismuuttuja, sill� ��rellisen otoksen luonteen johdosta havainto voi sijaita my�s rypp��n ulkopuolella. Assimiloimalla malliin vuosien 2002 ja 2004 havaintoja ja piirt�m�ll� mallin taustarypp��n avulla laskettujen j�rjestyslukujen histogrammeja, valittiin inflaatioparametrin sopivaksi arvoksi $s= 25~\mathrm{K}^2$. Lopullinen j�rjestyslukujen histogrammin on esitetty Kuvassa \ref{fig:rank}; ryp�s on hieman yli-dispersiivinen (havainto osuu useammin l�helle rypp��n keskusta kuin sen ulkopuolelle), mutta t�m�n tutkielman tarkoituksiin riitt�v�n hyvin kalibroitu. 

\section{Tulokset}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.7]{gradu_sumdiagb}
\caption{Taustan kovarianssimatriisin pdiagonaalielementtien (eli mallitilan muuttujien varianssien) summa. Huomaa logaritminen asteikko.}
\label{fig:sumdiagb}
\end{figure}

Kuva \ref{fig:sumdiagb} esitt mallitaustan kovarianssimatriisin diagonaalielementtien summaa. Taustan varianssi pienenee ajan funktiona kun malliin assimiloidaan havaintoja, mik on vlttmtn (muttei riittv) ehto sille, ett data-assimilaatiojrjestelm toimii. Alussa pieneneminen on hyvin nopeaa mallitilan ollessa epvarma, mutta pienentymisen nopeus hidastuu varianssin lhestyess asymptoottisesti jotain arvoa. Tss tyss ehdoton alaraja mallimuuttujien varianssin summalle on edellisess luvussa esitelty keinotekoinen varianssi-inflaatio. Vuoden 2003 assimilaatioajanjakson lopussa diagonaalielementtien summa on laskenut noin 40:een yksikkn. [\textit{Tss lasketaan yhteen "omenia ja banaaneja" -- mallimuuttujilla kun ei kaikilla ole samaa yksikk.}] Huomaa, ett suodinyhtlss (\ref{ha_analysis_eq}) taustan kovarianssimatriisia ei eksplisiittisesti mritet; se on laskettu ryppst jlkikteen laadunvalvontaa varten.

\begin{figure}[h]
\centering
\includegraphics[scale = 0.7]{gradu_kovarianssi}
\caption{Taustan kovarianssimatriisin alkioiden itseisarvon kymmenkantainen logaritmi assimilaatiohetkell 30. joulukuuta 2003. [\textit{Tarkkaavainen lukija huomaa, ett tss nkyy vain kymmenen muuttujaa. En ksit, miksei Matlab piirr sit yhdetttoista.}]}
\label{fig:kovarianssi}
\end{figure}

Yksi esimerkki mallin kovarianssimatriisista on annettu Kuvassa \ref{fig:kovarianssi}. Kuvan vriskaala kuvaa kovarianssin itseisarvon kymmenkantaista logaritmia ja akselit ilmaisevat muuttujan indeksin. Jrjestyksess malliparametrit ovat: 1. $\Delta T_{ex}$:n keskiarvo, 2. $\Delta T_0$, 3.$\Delta T'$ ja 4.-11. eksosfrin lmptilakorjauksen palloharmoniset kertoimet. Pienen kokokoluokkansa takia alareunan lmptilagradientin korjauksen suhteen lasketut kovarianssit ovat mys melko pieni (matriisin rivi ja sarake 3). Tst huolimatta parametrin kovarianssit vaikuttavat jopa eprealistisen pienilt (varianssin suuruus on alle 0.1 K/km). Voi olla, etteivt kokonaismassatiheyshavainnot ole riittv tietolhde lmptilagradientin rajoittamiseksi. 

EnKF:n Tiheyksiss havaittu vaihtelu nyttisi sen sijaan aiheutuvan ala- ja ylreunan lmptilakorjausten (ko)varianssista. Keskimristen korjausten (parametrit 1 ja 2) lisksi mys palloharmonisten termien kovarianssit ovat suurehkoja. Erityisen suuria arvoja havaitaan palloharmonian $Y_{20}$ kertoimessa (7); aurinkoajasta riippumaton zonaalisymmetrisen paraabelin muotoinen harmonia kuvaa kytnnss pivntasaajan massatiheysmaksimin (tai vastaavasti yn minimin) suuruutta ja ilmakehn suuripiirteist meridionaalista rakenneta (ks. Kuva \ref{fig:tiheys}). Sitvastoin parametrien $Y_{10}$ (4) ja $Y_{21}$ (8) havaittiin korreloivan keskenn vain hyvin vhn. Mikli kovarianssimatriisi ei sisll harhaisia korrelaatioita, havaittu palloharmonisten kertoimien suuri kovarianssi kertoo, ett ylilmakehss taustan virheet eivt ole isotrooppisia (kuten useissa alailmakehsovelluksissa oletetaan) \citep{buehner_2012}. 

\begin{figure}[h]
%\centering
\includegraphics[scale = 0.77]{gradu_analysisSurf}
\caption{Korjaamattoman IL-mallin (ylhll) ja analyysin (alhaalla) kuvaus massatiheydest 400 km:n korkeudella leveyspiirin ja aurinkoajan funktiona 31. tammikuuta 2003 (yksikss kg / $\mathrm{m^3}$). Paneelien vriskaala on sama.}
\label{fig:analysisSurf}
\end{figure}

Kuva \ref{fig:analysisSurf} antaa esimerkin korjaamattoman IL-mallin ja analyysin tuottamasta termosfrin massatiheydest 400 km:n korkeudella maantieteellisen leveyspiirin ja aurinkoajan funktiona. Tss yksittistapauksessa analyysin tuottama massatiheys vaikuttaa olevan globaalisti pienempi kuin korjaamattoman IL-mallin ennuste. Ilta- ja keskiyn tiheys pienenee ja massatiheyden maksimi on heikompi. Aiempien tutkimusten nojalla puoliempiirisiss ilmakehmalleissa esiintyy pivn aikaskaalalla jopa kymmenien prosenttien harhoja \citep[esim.][]{picone_2005}, joten tulos on uskottava. Harhan suuruus tosin riippuu merkittvsti maantieteellisest sijainnista ja korkeudesta. Kuvassa ei ole esitetty mallin taustaa, koska se on melko lhell analyysi. 

\begin{figure}[h]
%\centering
\includegraphics[scale = 0.65]{gradu_1616}
\caption{Havaitun ja mallinetun tiheyden suhde testikappaleelle 1616 vuonna 2003. Esitettyn korjaamaton IL-malli (vihre), EnKF:lla tuotettu analyysi (musta) ja sen 90\%:n luottamusvli (punaiset viivat).}
\label{fig:omTimeseries}
\end{figure}

Kuva \ref{fig:omTimeseries} havainnollistaa korjaamattoman IL-mallin ja EnKF:lla tuotetun analyysin harhaa tarkasteluvuonna 2003. Aikasarja kuvaa kappaleen 1616 kiertorataa, jonka havaintoja ei assimiloitu malliin. Kuvassa nkyy selke, noin kolmasosavuoden jaksolla havaittava harha IL-mallissa, jota EnKF ei tysin pysty korjaamaan. Analyysin parannus on kuvan perusteella merkittv ensimmisen puolen vuoden aikana. Joulukuussa havaitaan kuitenkin ajanjakso, jolloin korjaamattoman IL-mallin ennuste on harhattomampi kuin analyysin. Lisksi nhdn, ett 90\%:n luottamusvli on hyvin symmetrinen keskiarvon suhteen, mik johtunee tiheyteen vaikuttavien parametrien gaussisesta jakaumasta ja IL-mallin suhteellisesta yksinkertaisuudesta. Kuten Kuvassa \ref{fig:analysisSurf}, poikkeamat analyysin ja taustan vlill ovat melko pieni, joten mallitaustaa ei esitet.

Mallin suorituskyky kuvataan tss tyss nelillisen keskivirheen (englanniksi \textit{Root Mean Square Error}, RMSE) \citep[k.s. esim.][s. 359]{wilks_2011} avulla. Virhe mritelln tyssmme suhteellisena:
\begin{equation} \label{rmse_eq}
RMSE = \sqrt{\frac{1}{K} \sum_{i=1}^K \left ( \frac{\rho_i^H}{\rho_i^M} - 1 \right )^2},
\end{equation}
miss $\rho_i^H$ on (kaksirivisten elementtien avulla) havaittu ja $\rho_i^M$  mallinnettu tiheys tietyll ajanhetkell, ja $K$ on havaintojen lukumr aikasarjassa (vuoden 2003 aikana). Parametri sopii hyvin termosfrimallien suorituskyvyn arviointiin, koska se kuvaa samanaikaisesti sek mallin harhaa (keskiarvopoikkemaa) ett sen kyky ennustaa massatiheydess havaittuja geofysikaalisia vaihteluja \citep{bruinsma_2012}. Tmn vuoksi se vastaa hyvin mys matalan kiertoradan satelliittien kiertoratamallinnuksessa tehtv paikkavirhett. Mit pienempi RMSE on, sit paremman mallin suorituskyvyn katsotaan olevan. 

RMSE:n muutoksen tilastollinen merkitsevyys arvioidaan paritetun t-testin (lhde, Press) perusteella. Laskemalla IL-mallin ja taustan tai analyysin  tuottamien $(\rho_i^H / \rho_i^M - 1)^2$ -arvojen erotukset, saadaan aikasarja, jonka keskiarvon poikeamaa nollasta voidaan tilastollisesti arvioida. Tss tyss p-arvo ilmaisee todennkisyyden, jolla havaittu RMSE:n \textit{pienentyminen} data-assimilaation seurauksena aiheutuu sattumasta.




\section{Pohdinta}

Kuvan (MIK�) ja Taulukon (MIK�) perusteella Ensemble Kalman -suotimen analyysi kykenee tarkentamaan puoli-empiirisen yl�ilmakeh�mallin kuvausta termosf��rin massatiheydest�. Koska IL-malli esitt�� termosf��rin keskim��r�ist� tilaa, poikkeeaa sen ennuste v�ist�m�tt� yl�ilmakeh�n todellisesta tilasta. EnKF kykenee kuitenkin korjaamaan t�t� keskim��r�ist� tilaa ajan funktiona k�ytt�m�ll� hyv�kseen termosf��rist� teht�vi� havaintoja, ja n�in mallin kuvaus saadaan paremmin vastaamaan dynaamisesti muuttuvaa ilmakeh��. Analyysin tarkkuudesta huolimatta mallin taustalla ei ole ennustusarvoa seuraavan assimilointi-ikkunan aikana.

Tarkasteluvuotena 2003 sek� auringon ett� geomagneettinen aktiivisuus oli suurta, jolloin termosf��rin tila vaihteli nopeasti tuntien ja p�ivien aikaskaalalla \citep{emmert_2015}. Suurin virhel�hde empiirisiss� yl�ilmakeh�malleissa aiheutuu auringon ja geomagneettisen aktiivisuuden ilmakeh�vaikutustan arviointiin k�ytetyist� parametrisoinneista (ja etenkin niiss� k�ytetyist� yksinkertaisista indekseist�) \citep{berger_1998}. Mallien suorituskyky on heikoimmillaan n�iden kahden aktiivisuuden ollessa korkeita, joten on perusteltua olettaa, ett� data-assimilaatiolla olisi vuonna 2003 huomattava vaikutus mallin suorituskykyyn. Toisaalta pakotteiden nopeat vaihtelut my�s muuttavat mallin virhett� hyvin nopeasti. T�st� johtuen, vaikka pakotteen aikakehitys tunnettaisiin tarkkaan, analyysin korjauskentt� ei paranna mallin ennustetta seuraavan kolmen p�iv�n assimilointi-ikkunan aikana. Koska auringon minimiss� termosf��rin pakotteet muuttuvat hitaammin \citep{berger_1998}, voi olla, ett� taustan ennustuskyky on minimiaikana parempi. T�ll�in tosin mallin suorituskyky on my�s parhaimmillaan, joten data-assimilaatio ei v�ltt�m�tt� tarkenna analyysi� absoluuttisesti niin paljon kun auringon maksimin aikoihin vuonna 2003.

Kuitenkaan oletus siit�, ett� pakotteiden aikakehitys tunnettaisiin ei aina ole realistinen. Yhdysvaltain armeijan avaruustaistelulaboratorion HASDM-yl�ilmakeh�malli \citep{storz_2005} kykenee tekem��n massatiheysennusteita kolmen vuorokauden p��h�n k�ytt�m�ll� hyv�kseen ennusteita auringon UV-s�teilyst� ja (globaalia geomagneettista aktiivisuutta kuvaavasta) $\mathrm{k_p}$-indeksist�. \citet{storz_2005} osoittavat, ett�  korkean auringon aktiivisuuden aikaan satelliittien kiertoradadan ennusteessa teht�v� paikkavirhe (joka on suoraan verrannollinen tiheysmallin neli�llisen keskiarvon virheeseen) ei merkitt�v�sti kasva ensimm�isen 18:a tunnin aikana ja ennusteen laatu alkaa merkitt�v�sti heiket� vasta 36:n tunnin j�lkeen. Kuitenkin viel� kolmen vuorokauden j�lkeenkin paikkavirhe on 12\%:a parempi korjaamattomaan tiheysmalliin n�hden. HASDM-malli k�ytt�� auringon UV-s�teilyvuon ennustamiseen neuroverkkoja, jotka kykenev�t tuottamaan luotettavan kolmen vuorokauden ennusteen \citep{tobiska_2000}. T�m�n ty�n tulosten perusteella taustalla ei ole kolmen p�iv�n ennustuskyky� tilanteessa, jossa pakotteiden tuleva aikakehitys on tarkkaan tiedossa. On kuitenkin mahdollista, ett� EnKF:lla luodulla taustalla on ennustusarvoa lyhyemm�ll� kuin kolmen p�iv�n aikaj�nteell�. EnKF:n stokastinen luonne mahdollistaisi my�s pakotetekij�iden suoran arvioimisen tiheyshavaintojen perusteella, joten saattaisi olla mahdollista luoda ennusteita, joissa pakotteen aikakehityksen ep�varmuus on esitetty l�mp�tilakorjauksen tavoin mallitilan muuttujana. On kuitenkin huomioitava, ett� HASDM:n julkaistut tulokset k�sittelev�t vain geomagneettisesti hiljaisia ajanhetki�, joten ei tiedet�, kuinka mallin ennustusj�rjestelm� toimii geomagneettisten myrskyjen aikaan. Lis�ksi on huomattava, ett� HASDM k�ytt�� suurempaa m��r�� kappaleita ja hy�dynt�� suoraan NORAD:n salaisia tutkahavaintoja, mitk� yhdess� mahdollistavat tarkemman analyysin tekemisen. 

N�m� tarkemmat havainnot antavat HASDM:lle hyvin tarkan kolmen tunnin aikaresoluution \citep{storz_2005}. T�m�nkin ty�n data-assimilaatio-j�rjestelm�� voisi ajaa pienemm�ll� aikav�lill�, esimerkiksi kahden p�iv�n v�lein. Kaksirivisen elementtiaineiston pienint� integrointiaikaa (kolme p�iv��) ei kuitenkaan voida en�� lyhent��, mik� joka tapauksessa tasoittaisi mallitilojen muutoksia lyhyemp�� assimilointi-ikkunaa k�ytett�ess�. Koska termosf��rin massatiheys voi muuttua merkitt�v�sti tuntien aikaskaalassa (esimerkiksi geomagneettisten myrskyjen seurauksena), eiv�t kaksiriviset elementit l�hesk��n voi kuvata kaikkia yl�ilmakeh�ss� tapahtuvia muutoksia. Assimilaatioikkunan lyhent�minen aikaresoluution ei t�h�n ongelmaan v�ltt�m�tt� auta, sill� se voi v�hent�� kerralla assimiloitavien havaintojen m��r�� ja aiheuttaa j�rjestelm��n ylim��r�ist� kohinaa.

Kaikkia HASDM-mallin satelliitteja ei voinut t�ss� ty�ss� k�ytt��, sill� yksinkertaisella analyyttisell� SGP4-mallilla ei niiden rataa kyennyt riitt�v�n tarkkaan m��ritt�m��n. L�hes kaikki HASDM:n satelliitit, joiden kiertoaika oli yli 225 minuuttia ilmensiv�t hyvin suurta ja satunnaista vaihtelua (jopa tekij�ll� 10) yksitt�isiss� ballistisissa kertoimissa $B_i$. SGP4-malli olettaa, ett� kolmannen kappaleen voimat ovat merkitt�vi� kun kappaleen kiertojakso ylitt�� 225 minuuttia \citep{hoots_1980}, mutta on mahdollista, ett� t�ss� ty�ss� k�ytetty mallin julkinen versio ei laske n�it� voimia aivan samalla tavalla kuin NORAD:n kiertoratasovituksissaan k�ytt�m� malli. N�in ollen t�m�n ty�n SGP4:n antama kappaleen kiertorata poikkeaisi havaitusta ja aiheuttaisi ep�johtonmukaisuuden yht�l�n (\ref{Bi_eq}) keskiliikkeen ja viivaintegraalin v�lille. On my�s mahdollista, ett� tutkahavaintojen avulla m��ritetyt kaksirivisten elementtien keskiliikkeet itsess��n ovat virheelliset. Koska elementit eiv�t sis�ll� mit��n virheinformaatiota, on lopullista syyt� kuitenkin vaikea selvitt��. 

SGP4-malliin ja kaksirivisiin elementteihin liittyvist� ongelmista voi osittain p��st� eroon vaihtamalla satelliittin paikanm��rityksess� k�ytetty malli monimutkaiseen numeeriseen (niin sanottuun erityisperturbaatio-) malliin \citep{picone_2005}. T�ysin numeeriset mallit usein sis�lt�v�t tarkemman kuvauksen s�teilypaineesta, maan painovoimakent�st� ja kolmannen kappaleen voimista. Teht�ess� n�ill� malleilla termosf��rin tiheysanalyysi�, ainoastaan alkuehto, satelliitin sijainti ja nopeus saadaan kaksirivisest� elementtidatasta ja SGP4-mallista. T�st� alkuehdosta malli voi tarkkaan simuloida satelliitin rataa ja kappaleen paikan m��rityksess� teht�v� virhe usein huomattavasti pienenee SGP4:aan verrattuna \citep{saunders_2011}. Numeeristen mallien avulla termosf��rin massatiheys voidaan m��ritt�� suoraan satelliitin kiertoratakorkeuden (isoakselin puolikkaan) muutoksista, jonka virhe on todenn�k�isesti pienempi kuin yht�l�st� (\ref{density_12_eq}) johdetun tiheyden virhe \citep{saunders_2011}. 

Tarkan kiertoratamalliin voi empiirisen yl�ilmakeh�mallin (kuten IL) kytke� suoraan siten, ett� mallin simuloima ilmakeh�n massatiheys vaikuttaa kappaleen kiertorataan. N�in ollen kiertoratamalli voisi olla osa havainto-operaattoria ja EnKF:lla voisi assimiloida suoraan muutoksia kappaleen ratakorkeudessa (verraten niit� kaksirivisten elementtien havaintoihin). Kytketyn mallin avulla on my�s mahdollista luoda tarkka iteratiivinen algoritmi, joka korjaa satelliitin ballistista kerrointa siten, ett� termosf��rimallin kuvaama massatiheys aiheuttaa satelliitin kiertoradassa havaitun muutoksen \citep{saunders_2011}. Kappaleiden todellinen ballistinen kerroin onkin suurin virhel�hde kaksirivisten elementtien avulla teht�viss� yl�ilmakeh�tutkimuksissa \citep{bowman_2002}. T�ss� tutkimuksessa oletettiin, ett� IL-malli antaa harhattoman kuvauksen termosf��rin massatiheydest�, jolloin ballistinen kerroin voitiin m��ritt�� yksitt�isten $B_i$-arvojen pitk�n ajan keskiarvona. Koska IL-malli tuskin on harhaton, t�ss� tutkimuksessa k�ytetyt todelliset ballistisen kertoimen arvot ovat v�ltt�m�tt� harhaisia. Kaksirivisten elementtien avulla on siis hyvin vaikeaa saada selville termosf��rin massatiheyden absoluuttisia arvoja. K�yt�nn�ss� harhattomin arvio saadaan m��ritt�m�ll� jonkin pallomaisen satelliitin (alaindeksi $P$) ballistinen kerroin teoreettisesti (yl�indeksi $Te$) ja m��r��m�ll� kaikkien ep�s��nn�llisten (alaindeksi $E$) kappaleiden kertoimet t�m�n suhteen \citep{picone_2005}: 
\begin{equation} \label{Bspherical_eq}
B^T_E = \left \langle B_E^M \right \rangle \frac{B_P^{Te}}{\left \langle B_P^M \right \rangle},
\end{equation}
miss� kulmasulkeet ilmaisevat pitk�n ajan $B_i$ keskiarvoa (kuitenkin saman ajan yli sek� s��nn�lliselle ett� pallomaiselle kappaleelle). Pallomaisia satelliitteja, joiden teoreettinen $B^T$ vastannee hyvin totuutta on tunnistettu useita \citep{bowman_2002,doornbos_2004}. Huolellisesta tarkastelusta huolimatta j�rjestelm�llisi� eroja t�ss� ja aiemmissa t�iss� vaihtelevin tavoin m��ritettyjen $B^T$-arvojen v�lill� ei kuitenkaan l�ydetty. 

Todellisen ballistisen kertoimen arvon lis�ksi on t�ss� ty�ss� k�ytetty� kertoimen virhearviota my�s mahdollista parantaa. Nyt virheen� k�ytet��n keskiarvon keskivirhett�, mutta tarkalleen ottaen kaava (\ref{Bi_err_eq}) p�tee vain sellaiselle satunnaismuuttujalle, joka ei korreloi edellisten arvojensa kanssa. Per�kk�isten $B_i$-arvojen selv�n korrelaation (katso esim. Kuva \ref{fig:Btrue}) johdosta kyseess� on aliarvio ballistisen kertoimen todellisesta virheest�. K�yt�nn�ss� t�m�n virheen suuruus vaikuttaa mallin taustan kovarisnssin inflaatioparametrin arvoon, koska EnKF:ssa rypp��n p�ivitys riippu mallin ja havaintojen kovarianssin suhtesta. 

Ballistisen kertoimen ja siten tiheyden virheen absoluuttisesta suuruudesta huolimatta havaintojen m��r�n lis��minen saattaa tarkentaa data-assimilaatio-j�rjestelm�n analyysi�. T�ss� ty�ss� k�ytetyt 48 maan matalan kiertoradan kappaletta ovat osajoukko HASDM-mallissa k�ytetyist� kalibrointikappaleista \citep{doornbos_2004} ja niiden ballististen kertoimien on todettu pysyv�n k�yt�nn�ss� vakiona. \citet{emmert_2008} on kuitenkin analysoinut l�hes kaikki NORAD:n katalogissa olevat kappaleet, joiden ratoihin termosf��rill� ajatellaan olevan vaikutusta. Tutkimuksessaan h�n esitti johtop��t�ksen, jonka mukaan mallien tiheyskalibrointiin olisi k�ytett�viss� jopa 5000 kappaletta. N�iden kaksirivisten elementtien lis�ksi tiheysassimilaatioon voisi k�ytt�� my�s GOCE, CHAMP, GRACE ja SWARM -painovoimasatelliittien kiihtyvyysmittarien avulla johdettuja kokonaismassatiheyksi�. Painovoimasatelliittien ja elementtihavaintojen assimilaatiossa joudutaan kuitenkin tekem��n p��t�ksi� siit�, mit� mallin kentti� havaintojen avulla korjataan; t�ss� ty�ss� korjattiin l�mp�tilaprofiilia, sill� se vaikuttaa kaikkien kaasulajien massatiheyksiin. Kokonaismassatiheys on nimitt�in vain mallin "diagnostinen" suure, joka lasketaan yksitt�isten kaasulajien massatiheyksien summana -- havaittua kokonaistiheysjakaumaa vastaa ��ret�n m��r� erilaisia l�mp�tila- ja tiheysjakaumia, eik� massatiheysmittausten avulla voida t�ysin rajoittaa assimilaatioj�rjestelm��, jossa n�it� molempia varioidaan yht� aikaa. Termosf��rist� tehd��n kuitenkin suoria tiheys- ja l�mp�tilamittauksia esimerkiksi satelliitin mittaaman ilmahehkun \citep[esim.][]{slanger_2017} ja ep�koherenttien sirontatutkien avulla. N�it� havaintoja olisi mahdollista assimiloida malliin yhdess� kokonaismassatiheysmittausten kanssa, jolloin l�mp�tila- ja tiheyskentti� voitaisiin korjata samanaikaisesti, mahdollisesti parantaen analyysin tarkkuutta. 

Assimilaatiomenetelm�n� olisi ollut mahdollista k�ytt�� tavallista Kalman-suodinta, sill� mallitilassa oli ainoastaan 11 muuttujaa ja kerralla assimiloitavien havaintojen lukum�r�kin oli pieni (40:sta 45:een). Vaihtoehtona olisi ollut my�s \citet{doornbos_2008} k�ytt�m� ep�lineaariseen optimointiin usein sovellettu Levenberg-Marquardt -algoritmi. Ty�ss� p��dyttiin kuitenkin k�ytt�m��n ensemble Kalman -suodinta, koska (1) siin� ei ole tarvetta tangentti-lineaarisille operaattoreille, (2) se kehitt�� mallitilaa ja sen kovarianssia samanaikaisesti, (3) se kykenee antamaan todenn�k�isyysennusteita, (4) se toimii hyvin my�s alim��ritellyiss� ongelmissa, (5) se ottaa huomioon mallin ennusteen informaatiosis�ll�n m��ritt�ess��n analyysi� ja (6) se on laskennallisesti hyvin tehokas. Laskennallisen nopeuden saavuttaminen vaatii kuitenkin p��akselihajotelmalla toteutettua versiota \citep{mandel_2006}. Siten voidaan teoreettisesti saavuttaa asymptoottinen kompleksisuus:
\begin{equation} \label{svdCompl_eq}
O(oN^2 + mN^2 + N^3).
\end{equation}
T�m�n ty�n yksinkertainen implementaatio k�ytt�� analyysiyht�l�n (\ref{enkf_anal_eq}) matriisi-inversion laskemiseen Choleskyn algoritmia, jonka takia suotimen kokonaiskomplekisuus on \citep{mandel_2006}:
\begin{equation} \label{naiveCompl_eq}
O(o^3 + o^2N + oN^2 + mN^2).
\end{equation}
Suotimen tehokkaampi muoto on huomattavasti nopeampi kuin Levenberg-Marquardt -algoritmi \citep{more_1978}
\begin{equation} \label{lm_eq}
O(om^2 + m^3).
\end{equation}
EnKF:n kompleksisuus voi siis parhaimmillaan olla lineaarinen sek� havaintojen ett� mallitilan koon suhteen. Sen sijaan Levenberg-Marquardt'n laskenta-aika kasvaa hyvin nopeasti mallitilan muuttujien lukum��r�n lis��ntyess�, mik� tarkoittaa, ettei se sovellu suurten mallien assimilaatio-ongelmiin. Se ei my�sk��n ota huomioon mallin taustaa muodostaessaan analyysi�, vaan korjaus perustuu aina pelk�st��n havaintoihin [\textit{Periaatteessa olisi varmaan mahdollista k�ytt�� L-M:aa sakkofunktion (\ref{J_eq}) minimointiin yhdess� adjoint-mallin gradientti-informaation kanssa. Tied� sitten, miten nopeaa se olisi}]. 

T�ss� ty�ss� mallitila ($m$) on pienempi kuin yhdess� assimilaatiossa k�ytettyjen havaintojen m��r� keskim��rin (eli ongelma on ylim��ritelty), mik� selv�sti poikkeaa EnKF:n tyypillisest� sovelluksesta isoissa numeerisissa malleissa. Matemaattisesti t�m� ei kuitenkaan ole ongelma ja suotimen osoitettiin toimivan varsin hyvin my�s t�ss� sovelluksessa. Ylim��ritelty assimilaatio-ongelma voi my�s v�hent�� pienest� rypp��n koosta aiheutuvia ongelmia, vaikka toisaalta rypp��n mallien havaittiin, alin�ytteistetyn mallin tapaan pyrkiv�n konvergoitumaan ilman kovarianssin inflaatiota. Osittain ongelman luonteen johdosta mallitaustan kovarianssista ei yritetty poistaa siell� mahdollisesti esiintyneit� harhaanjohtavia korrelaatioita. Tyypillisesti lokalisaatio implementoidaan operoimalla kovarianssimatriisia korrelaatiofunktion $\rho$ ja Schur- (eli alkio)tulon ($\circ$) avulla \citep{houtekamer_2001}:
\begin{equation} \label{lm_eq}
\mathbf{K} = (\rho \circ \mathbf{C)H^T}(\mathbf{H}(\rho \circ \mathbf{C)H^T + R})^{-1}.
\end{equation}
K�yt�nn�ss� kovarianssia keinotekoisesti pienennet��n jonkin (usein polynomimuotoisen \citep{gaspari_1999}) funktion $\rho$ avulla hilapisteiden v�lisen et�isyyden funktiona. Ongelmana kuitenkin on, ettei kovarianssia lasketa t�ss� ty�ss� suoraan. Lis�ksi ei ole selv��, millainen eri mallitilan parametrien (kuten alareunan l�mp�tilagradientin ja eksosf��rin keskim��r�isen l�mp�tilakorjauksen) kovarianssin kuuluu fysikaalisten argumenttien nojalla olla. Ilman t�llaista informaatiota ei voida tiet��, mik� korrelaatio on kausaalista (fysikaalista) ja mik� pelkk�� satunnaisuudesta aiheutuvaa kohinaa. Palloharmonisille malleille on mahdollista tehd� vastaavanlainen korjaus pallofunktioiden kertoimien kovarianssille, mutta k�yt�nn�ss� t�m� vaatii aina pseudo-spektraali-menetelm�n k�ytt��, jossa mallitilaa muunnetaan vuoroin fysikaalisen- ja spektraaliavaruuden v�lill� \citep{buehner_2012}. Koska IL-mallissa ei hilapisteikk�� lainkaan ole, ei my�sk��n n�it� menetelmi� voi k�ytt��. Niinp� ainoa vaihtoehto on olettaa, ett� mallitilaan n�hden suuri ryp�s ja havaintojen m��r� riitt�� esitt�m��n malliparametrien kovarianssin luotettavasti. 

Rypp��n rajallisen koon lis�ksi my�s EnKF:ssa k�ytetty havaintojen satunnaistus (yht�l�n (\ref{data_eq}) mukaisesti) aiheuttaa kohinaa \citep{whitaker_2002}. ��rellinen m��r� satunnaislukuja ei aina t�ysin edusta alkuper�isen satunnaisjakauman vaihtelua. Siksi onkin kehitetty deterministisi� suotimia, kuten ensemble-muunnos Kalman -suodin (englanniksi \textit{Ensemble Transform Kalman Filter}, ETKF) \citep{bishop_2001}, jotka tuottavat samalla havaintoaineistolla ja rypp��ll� j�rjestelm�llisesti saman ennusteen. Kaikki Kalman-suotimet kuitenkin olettavat, ett� todenn�k�isyysjakaumat ovat normaalijakaumien. Esimerkiksi ballistisen kertoimen jakauma ei kuitenkaan aivan tarkalleen ole gaussinen (ks. Kuva XX), mik� antaa syyn olettaa, ett� sen avulla johdetut havainnotkaan eiv�t ole. Tulosten perusteella normaalijakauman oletus kuitenkin n�ytt�� toimivan; mik�li n�in ei olisi, voitaisiin siirty� yleisiin hiukkassuotimiin, jotka tukevat mit� tahansa todenn�k�isyysjakaumaa \citep{moradkhani_2005}.

\section{Johtop��t�kset}

%%% Oma teksti ennen t�t�.

\bibliography{gradu}
\bibliographystyle{unsrtnat}
%\nocite{*}
%\printbibliography


%\bibliography{gradu}  % viittaa tiedostoon gradu.bib

\end{document}

