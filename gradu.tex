\nonstopmode
% \batchmode jos et halua nähdä
\documentclass[12pt,a4paper,finnish,margin=2in]{article}
\usepackage[margin = 1.75in,bottom=1in,top=1.25in]{geometry}
\linespread{1.2}

\usepackage{fixltx2e}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{pgfplotstable}
%\usepackage{lineno}
%\linenumbers

%%% Tämä on tämän tiedoston versio ajanhetkenä 2008-02-13.
%%% Säätäjä-ässän on hyvä muistaa päivittää myös päiväys.

%\usepackage[authoryear]{natbib}
\usepackage[
backend=biber,
style=authoryear,
citestyle=authoryear-comp,
sorting=nyt,
natbib=true
]{biblatex}
\addbibresource{gradu.bib}
%\bibpunct{(}{)}{;}{a}{,}{,}

\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[finnish]{babel}

% \usepackage{graphicx}
% tai \usepackage{graphics}
% kuvatiedostojen liittämiseksi
\begin{document}

\parskip 2mm
\parindent 0mm

\begin{titlepage}
  \setlength{\parindent}{0mm}
  \sloppy
  \large \textsc{Helsingin Yliopisto \\
                 Yleisen kielitieteen laitos \\
                 Kieliteknologia}
  \vspace{5mm}

  \hrule height3pt
  \vspace{20mm}

  \begin{center}
    \large Pro gradu -tutkielma
    \linebreak \vfill   

    \huge \textbf{Tutkielman nimi}
    \vspace{20mm}

    \Large Tekijän Nimi \linebreak
    \normalsize 0000000  % opiskelijanumero
    \vfill

  \end{center}
  \hrule height2pt
  \vspace{15mm}

  Ohjaaja: Ohjaajan Nimi
  \hfill
  99.99.9999     % päivämäärä (esim. 2.2.2002)
\end{titlepage}

\tableofcontents

\pagebreak

%%% Oma teksti tämän jälkeen.
%%% Tyhjä rivi kappalten väliin.
%%% LaTeX varaa mm. merkit & $ & % \ { } [ ] omiin tarkoituksiinsa.

\section{Johdanto}

Termosfääri on planeettamme ilmakehän ainoa lähiavaruuteen saakka ulottuva kerros. Tieteellisen mielenkiinnon lisäksi termosfäärin käyttäytymisen parempi ymmärtäminen on tärkeää suunniteltaessa ja toteutettaessa lähiavaruuden satelliittitoimintaa, sillä termosfääristä aiheutuva ilmanvastusvoima on suurin virhelähde ennustettaessa matalan kiertoradan satelliittien sijaintia \citep{Doornbos_2007}. 

Termosfäärin ymmärtämiseksi on laadittu useita virtaus- ja elektrodynamiikan yhtälöt ratkaisevia fysikaalisia malleja (lähde). Rakenteeltaan mallit muistuttavat alailmakehässä käytettäviä sää- ja ilmastomalleja, mutta vaikka ne ovat merkittävästi lisänneet tietoa yläilmakehän prosesseista ja kytkennöistä, eivät niillä laskettavat ennusteet kovinkaan hyvin vastaa termosfääristä tehtäviä havaintoja \citep{Shim_2014}. Tämän vuoksi satelliittien ratelaskelmissa ei fysikaalisia malleja käytetä, vaan sen sijaan hyödynnetään puoli-empiirisiä malleja, jotka kuvaavat termosfäärin keskimääräistä kolmiulotteista lämpötila- ja tiheysjakaumaa geofysikaalisten parametrien funktiona. 

Vaikka puoli-empiiriset mallit tuottavat fysikaalisia malleja tarkemman arvion yläilmakehän satelliitteihin kohdistamasta ilmanvastuksesta, liittyy niidenkin käyttöön suuria virheitä, koska termosfäärin todellinen tila ja empiirisen mallin ennustama keskimääräinen tila poikkevat usein toisistaan. Niin fysikaalisten kuin empiiristen mallien ennustusvirhettä on yritetty pienentää korjaamalla mallin alkutilaa sellaiseksi, että se vastaa paremmin havaintoja (pari tiegcm EnKF + Doornbos). Tämän niin kutsutun data-assimilaation avulla mallien ja havaintojen välistä virhettä on etenkin lyhyillä ennustusajoilla saatu merkittävästi pienennettyä, mutta on kuitenkin epäselvää, kuinka paljon ennusteita voidaan parantaa alkutilan paremmalla määrityksellä. 

Toisin kuin alailmakehässä, termosfääristä tehtävien ennusteiden epävarmuus liittyy hyvin paljon epävarmuuteen termosfäärin tilaa ajavissa pakotteissa \citep{mannucci_2016}. Yläilmakehän tärkein energianlähde on auringosta tuleva lyhytaaltoinen E- ja FUV-säteily, jonka säteilyteho voi vaihdella sadoilla prosenteilla minuuttien ja tuntien aikaskaalassa \citep[esim.][]{Tsurutani_2005}. Lisäksi tämä voimakas säteily ionisoi osan termosfäärin kaasusta muodostaen alueelle niin kutsutun ionosfäärin, jonka liike yläilmakehän sähkö- ja magneettikenttien mukaan vaikuttaa myös neutraalin kaasun virtaukseen. Tämän ionosfääri-termosfääri -kytkennän ja auringon lyhytaaltoisen säteilyn muutokset ovat vaikeasti ennustettavissa, mutta voivat vaikuttaa termosfäärin massatiheyteen kymmenillä tai jopa sadoilla prosenteilla \citep[esim.][]{emmert_2015}. Näin ollen tilanteissa, joissa pakotteen aikakehitykseen liittyy hyvin suuri epävarmuus, ei alkutilan tarkkakaan määritys auta tuottamaan laadukkaita ennusteita yläilmakehän tilasta \citep{chen_2016}.

Tästä syystä tässä tutkielmassa keskitytään tarkastelemaan data-assimilaation suorituskykyä aikana, jolloin termosfääriin kohdistuu voimakkaita ajan suhteen muuttuvia pakotteita (geomagneettinen ja auringon aktiivisuus ovat suuria). Data-assimilaation ennustusmallina käytetään Ilmatieteen laitoksella kehitettyä uutta puoli-empiiristä Iipponen-Laitinen -mallia (IL). Assimiloitavana datana toimii Pohjois-Amerikan ilmapuolustuskomentokeskuksen (NORAD) niin sanottu kaksirivinen elementtidata maata kirtävistä kappaleista (lähde), jota on useasti hyödynnetty yläilmakehän data-assimilaatiota käsittelevissä tutkimuksissa (HASDM + Doornbos). 

Tässä tutkielmassa data-assimilaatio suoritetaan Kalmanin kokonaisuussuotimen (englanniksi \textit{Ensemble Kalman Filter}, EnKF) avulla (lähde). Menettely poikkeaa aiemmista tutkimuksista (esim. Doornbos) siinä, miten se käsittelee mallin ennustetta muodostaessaan arviota yläilmakehän todennäköisimmästä tilasta. Aiemmin todennäköisimmän tilan arvio on määritetty ainoastaan interpoloimalla havaintoaineistoa, mutta yhdistämällä mallin ennusteen ja havainnot, EnKF kykenee tuottamaan arvion yläilmakehän tilasta, joka todennäköisimmin vastaa järjestelmän todellista tilaa. 

Työn keskeiset tutkimuskysymykset ovat:
\begin{enumerate}
\item Tarkentaako EnKF:n avulla tuotettu ilmakehän analyysi IL-mallin kuvausta keski- ja ylätermosfäärin massatiheydestä?
\item Tarkentaako analyysi kolmen päivän ennusteita yläilmakehän tilasta, mikäli pakotetekijöiden aikakehitys tunnetaan tarkkaan?
\end{enumerate}

Keskeisin yksittäinen parametri arvioitaessa yläilmakehämallien suorituskykyä on tiheysennusteiden ja -havaintojen välinen neliöllinen keskivirhe, sillä se kuvaa hyvin satelliitin kiertoradan ennustuksessa tehtävää etäisyysvirhettä (lähde). Tässä työssä sitä käytetään arvioimaan, tarkentaako data-assimilaatio yläilmakehän tiheydestä tehtäviä arvioita verrattuna IL-malliin, johon dataa ei ole koskaan assimiloitu. Vertailun havaintoaineistona käytetään aina dataa, jota data-assimilaatio-järjestelmässä ei ole käytetty.

Työn kolmessa ensimmäisessä luvussa annetaan tulosten ja johtopäätösten ymmärtämiseksi tarvittavat tiedot IL-mallista, NORAD:n kaksirivielementeistä, sekä Kalmanin kokonaisuussuotimesta. Luku 5 esittää data-assimilaation tulokset. Luku 6 esittää tulosten perusteella johtopäätöksiä ja käsittelee työn rajoitteita. Lopuksi Luku 7 tiivistää työn keskeiset tulokset.

\section{Iipponen-Laitinen -malli}

Jo satelliittiajan alussa, 1960- ja 1970-luvuilla oli tarve kyetä määrittämään ja ennustamaan satelliittien ratoja merkittävällä tarkkuudella. Matalla maan kiertoradalla (kappaleen kiertoaika alle 225 min (lähde)) kiertävät kappaleet, joiden perigeum (kiertoradan maata lähin piste) on alle 500 - 700 km:n korkeudella kokevat termosfäärin kokonaismassatiheydestä aiheutuvan merkittävän ilmanvastusvoiman (lähde). Tämän voiman mallintamiseksi alettiin 1960-luvulla kehittämään empiirisiä malleja, jotka havaintojen pohjalta kuvasivat termosfäärin keskimääräistä kolmiulotteista lämpötila- ja massatiheysjakaumaa (msis ja jacchia lähteet). Näiden mallien kehittäminen oli laskennallisesti yksinkertaisempaa ja nopeampaa kuin sähkö- ja virtausdynamiikan yhtälöt ratkaisevien kehitys, joten niistä nopeasti tuli kiertoratamallinnuksen standardityökaluja.

Toinen fysikaalisten mallien käytettävyyttä rajoittava tekijä on tarve löytää malleille kolmiulotteinen alkutila, jota ilman mallit eivät voi antaa luotettavia ennusteita (heikosti pakotettuina aikoina). Tällaisen alkutilan löytämistä rajoittaa merkittävästi se, että neutraalista yläilmakehästä on saatavilla hyvin vähän reaaliaikaista (korkearesoluutioista) dataa. Empiirisissä malleissa tämä ongelma kierretään etsimällä analyyttinen, epälineaarinen funktiosovitus, joka parhaiten kuvaa kymmenien vuosien historiallista havaintoaineistoa. 

Ilmatieteen laitoksella on aiemman tutkimuksen (lähde) pohjalta kehitetty uudistettua empiiristä yläilmakehämallia, jonka tarkoituksena on keskittyä geomagneettisten myrskyjen ilmakehävaikutusten parempaan arviointiin. Kuten aiemmat yläilmakehämallit, MSIS (lähde) ja DTM (lähde), IL-malli kuvaa hydrostaattisessa tasapainossa olevaa ilmakehää:
\begin{equation} \label{hydrostatic_eq}
dp = -\rho g_0 dZ,
\end{equation}
missä \textit{p} on ilmanpaine, $\rho$ on tiheys, \textit{Z} on geopotentiaalikorkeus ja \textit{g}\textsubscript{0} on putoamiskiihtyvyys mallin alarajalla 130 km korkeudella (lähde Emmert). Alailmakehästä poiketen turbulenttinen sekoittuminen on pienen tiheyden takia termosfäärissä hyvin pientä suhteessa diffuusioon. Tällöin raskaat kaasulajit (N\textsubscript{2} ja O\textsubscript{2}) kerääntyvät alatermosfääriin (alle 200 km korkeudelle) ja kevyemmät (He ja O) termosfäärin ylempiin osiin (ks. Kuva \ref{fig:emmert_tiheys}). 
\begin{figure}[t]
\centering
%\includegraphics[scale = 0.4]{emmert_tiheys}
\caption{Termosfäärin tärkeimpien kaasulajien lukumäärätiheyksien globaalit keskiarvot korkeuden funktiona auringon maksimin aikaan. \citet{emmert_2015} Kuva 2(a).}
\label{fig:emmert_tiheys}
\end{figure}
Näin ollen keskimääräisen molekyylimassan muutokset on yhtälöä \ref{hydrostatic_eq} integroitaessa otettava huomioon. Kun yhtälöön sijoitetaan ideaalikaasun tilanyhtälö
\begin{equation} \label{ideal_eq}
p = \rho \frac{R}{m} T,
\end{equation}
(missä m on keskimääräinen molaarimassa, T on absoluuttinen lämpötila ja R = 8.314 J / K / mol on kaasuvakio), saadaan hydrostaattinen yhtälö muotoon:
\begin{align} \label{hydrostatic_log_eq}
\frac{-R}{\rho}~d \left ( \rho \frac{T}{m} \right ) = -R~\frac{T}{m} d(\ln \rho) - R~d \left ( \frac{T}{m} \right ) = g_0 dZ \nonumber \\
\Rightarrow  d(\ln \rho) = - d \left ( \ln \frac{T}{m} \right ) - \frac{g_0 m}{R T} dZ
\end{align}

Yhtälön \ref{ideal_log_eq} integroiminen vaatii oletuksen yläilmakehän lämpötilaprofiilista. IL-mallissa hyödynnetään (lähde Bates-Walker):n esittämää empiiristä funktiota:
\begin{equation} \label{bates_eq}
T(Z) = T_{ex} - (T_{ex} - T_0) e^{- \frac{T'}{T_{ex} - T_0} (Z-Z_0)},
\end{equation}
missä $T_ex$ kuvaa eksosfäärin (maan ilmakehän ylimmän osan) lämpötilaa; $T_0$ on lämpötila ja $T' = dT/dZ$ on lämpötilan pystysuuntainen gradientti mallin alarajalla 130 km korkeudella. Lisäksi hydrostaattisen yhtälön integroinnissa oletetaan, että yläilmakehä on diffusiivisessa tasapainossa; termosfäärin voidaan ajatella koostuvan useasta yksikaasuisesta osailmakehästä, joiden massatiheyksien summa antaa ilmakehän kokonaismassatiheyden missä tahansa termosfäärin pisteessä. Tällöin yhtälö \ref{hydrostatic_log_eq} voidaan integroida jokaiselle kaasulajille erikseen, jolloin lajille $i$ saadaan massatiheyttä kuvaava yhtälö:
\begin{equation} \label{species_dens_eq}
\rho_i (Z) = \rho_i (Z_0)~(T_0 / T(Z))^{1+\gamma_i+\alpha}~e^{-\sigma \gamma_i (Z-Z_0)},
\end{equation}
missä:

$Z$: geopotentiaalikorkeus $Z = (R_E + z_0)(z-z_0)/(R_E + z)$,

$z$: geometrinen (todellinen) korkeus,

$z_0$: alareunan korkeus $z_0 = 130$ km,

$R_E$: maan napasäde $R_E = 6356.77$ km,

$\gamma_i = m_i g_0/(\sigma~R~T_{ex})$,

$\sigma = T' / (T_{ex} - T_0)$

$\alpha$: lämpötiladiffuusiokorjauskerroin (Heliumille -0.38, muille mallin kaasuille 0). Heliumin tiheys pienenee korkeuden funktiona hieman hitaammin kuin hydrostaattinen tasapaino edellyttää.

Yhtälön \ref{species_dens_eq} mukaan mallin alarajalla on siis lämpötilojen lisäksi määritettävä kunkin kaasulajin massatiheys. Puoli-emiipiirisissä termosfäärimalleissa tämä tehdään geofysikaalisen funktion $G_i(L)$ avulla, joka esittää muutoksen alarajan massatiheydessä geofysikaalisen tilan $L$ funktiona:
\begin{equation} \label{lb_eq}
\rho_i(Z_0) = \overline{\rho_i(Z_0)}~\exp(G_i(L)).
\end{equation}

Geofysikaalinen tila $L$ kuvaa IL-mallissa havaintopisteen sijaintia (leveys- ja pituuspiiri, aurinkoaika), havaintoaikaa (vuodenpäivä), sekä auringon- ja geomagneettista aktiivisuutta. Auringon aktiivisuus on parametrisoitu auringon 30 cm radiovuon (F30) edellisen päivän ja 81:n päivän keskiarvojen avulla, sillä yksittäisistä auringon aktiivisuusindekseistä tämä parhaiten kuvaa auringon UV-säteilyä niillä aallonpituusalueilla, jotka termosfääriä lämmittävät (lähde). Geomageettisesti aktiivisina aikoina puolestaan yläilmakehän varattujen ja neutraalien hiukkasten törmäykset lämmittävät termosfääriä, mikä muuttaa tiheysrakennetta. IL-mallissa vaikutuksen parametrisoinnissa käytetään pohjoisen revontuliovaalin alueen magnetometrimittauksista johdettavaa AE-indeksiä, jonka oletetaan olevan verrannollinen termosfääriä lämmittävän sähkövirran ja hiukkaspresipitaation suuruuteen (lähde).

Lopulta skalaariarvoinen funktio $G$ kuvaa parametrivektorin $L$ suhteellisiksi tiheysmuutoksiksi logaritmisessa avaruudessa. $G$ on määritelty pallon pinnalla, joten sen lausekkeessa on käytetty apuna palloharmonisia funktiota astelukuun ($\sim$meridionaalinen aaltoluku) 6 ja kertalukuun (zonaalinen aaltoluku) 4 saakka. $G_i$ on ominainen kullekin kaasulajille, mutta funktionaalinen muoto on täysin sama; $G$ pitää sisällään 142 vapaata parametriä, jotka saavat eri arvoja riippuen siitä, mikä kaasu on kyseessä. Vastaavalla tavalla määritetään myös lämpötilojen muutos geofysikaalisen tilan L funktiona:
\begin{equation} \label{lb_eq}
T_j = \overline{T_j} (1 + G_j(L)).
\end{equation}

Näiden noin kuudensadan parametrin sovittamiseksi tarvitaan historiallisia havaintoja termosfäärin tiheyksistä ja lämpötiloista. IL-mallin tärkein tietolähde ovat 2000-luvulla tehdyt kokonaismassatiheysmittaukset, jotka on laskettu gravitaatiosatelliittien GRACE (lähde), CHAMP (lähde) ja GOCE (lähde) tarkkojen kiihtyvyysmittarien avulla. Kaasulajien lukumäärätiheydet perustuvat myös 1970- ja 1980- lukujen satelliittipohjaisiin massaspektrometrimittauksiin (esim. lähde), mutta suoria satelliittimittauksia on käytetty myös Eksosfäärin lämpötilan laskennassa. Alareunan lämpötila on laskettu kolmen epäkoherentin sirontatutkan (Arecibo, Millstone Hill, EISCAT) lämpötilamittauksista. Lisäksi IL-malli on ensimmäinen puoli-empiirinen yläilmakehämalli, joka hyödyntää NASA:n Thermosphere Ionosphere Mesosphere Energetics and Dynamics (TIMED) -satelliitin havaintoja alareunan lämpötilagradientista (lähde) ja UV-kanavalla tehtyjä luotauksia hapen ja typen korkeusprofiileista (lähde). 

Paramterien optimaaliset arvot määritetään epälineaariseen optimointiin suunnatulla Levenberg-Marquardt -algoritmilla (lähde), joka etsii parametreille pienimmän neliösumman mielessä parhaat arvot. Algoritmin tuottaman virhekovarianssimatriisin avulla hylätään sellaiset parametrit, joiden absoluuttinen virhe on yli kolmasosa parametrin suuruudesta. Tämän jälkeen sovitus lasketaan uudelleen ainoastaan tilastollisesti merkitseville parametreille. 

\begin{figure}[t]
\includegraphics[scale = 0.65]{gradu_tiheys}
\caption{IL-mallin ennuste yläilmakehän kokonaismassatiheydestä (yksikössä $kg/m^3$) leveyspiirin ja aurinkoajan funktiona kesäkuussa 400 km:n korkeudella.}
\label{fig:tiheys}
\end{figure}

Kuva \ref{fig:tiheys} esittää IL-mallin kuvausta termosfäärin massatiheydestä kesäkuussa 400 km:n korkeudella. Suurimmat massatiheydet löytyvät pohjoiselta pallonpuoliskolta (koska säteilylämmitys ja keskimääräinen molekyylimassa ovat siellä suuria) ja hieman keskipäivän jälkeen auringon lämmitettyä ilmakehää aamupäivällä. Pienin massatiheys saavutetaan aamuöllä noin kello neljä. Yksinkertaisuudestaan huolimatta IL-mallin tiheysennusteet vastaavat GOCE, CHAMP ja GRACE -satelliittien kiertoratakeskiarvoistettuja massatiheyshavaintoja noin 24\%:n neliöllisen keskiarvon virheellä. 

\section{Kaksiriviset elementit -- termosfäärin massatiheyshavainnot}
\subsection{Tiheyden määrittäminen}

Pohjois-Amerikan ilmapuolustuskeskuksen (NORAD) tehtävänä on kerätä tietoa maata kiertävistä keinotekoisista satelliiteista. Merkittävä osa NORAD:n havaintoaineistosta on julkisesti saatavilla ja nykyään (toukokuu 2017) aineisto kattaa tiedot yli 40000:n satelliitin kiertoratojen muutoksista (lähde). Poikkeamia maata kiertävien satelliittien ratoihin aiheuttavat; (1) maan painovoimakenttä ja sen epähomogeenisuus, (2) ilmakehän ilmanvastusvoima, (3) kolmannen kappaleen, kuten Kuun tai Auringon painovoima, sekä (4) säteilypaine suorasta ja heijastuneesta auringonsäteilystä (lähde). Kappaleen kiertoradan aikakehitys kuvaa kaikkien näiden poikkeuttavien voimien satelliittiin kohdistamaa yhteisvaikutusta, mutta tietyissä erikoistilanteissa on mahdollista erotella näiden voimien vaikutukset toisistaan. 

Tässä työssä keskitytään tarkastelemaan kappaleita, joiden kiertoradan maata lähin piste (perigeum) on alle 550 km:n korkeudella ja joiden kiertoaika on alle 225 minuuttia. Tarkasteluvuosina 2002 - 2004 auringon korkea aktiivisuus (voimakas UV-säteily) oli kasvattanut ilmakehän skaalauskorkeutta siten, että tällaisilla kiertoradoilla olevien kappaleiden ilmanvastusvoima on todennäköisesti suurempi kuin säteilypaineen vaikutus (lähde). Lisäksi Kuun ja Auringon painovoimakentistä aiheutuvat poikkemat tällaisen kappaleen rataan ovat pieniä (joku viittaus SGP-prop.) ja voidaan jättää huomiotta. 

Näin ollen riittää tarkastella ainoastaan maapallon epähomogeenisen painovoimakentän ja ilmanvastuksen aiheuttamia poikkemia. Termosfäärin massatiheydestä, satelliitin muodosta ja nopeudesta riippuva ilmanvastusvoima voidaan lausua (lähde):
\begin{equation} \label{airdrag_eq}
\mathbf{\dot{v}_D} = - \frac{1}{2} \rho B \left | \mathbf{v} - \mathbf{V} \right |^2 \mathbf{e_{v-V}},
\end{equation}
jossa $\mathbf{\dot{v}_D}$ on ilmanvastuksen aiheuttama kiihtyvyys, \textbf{v} on kappaleen ja \textbf{V} tuulen nopeus maakeskisessä inertiaalikoordinaatistossa (lähde Bate 1971), $\mathbf{e_{v-V}}$ on ilmakehän suhteen olevan nopeuden suuntainen yksikkövektori, $\rho$ on ilmakehän massatiheys ja ballistinen kerroin:
\begin{equation} \label{ballistic_eq}
B = \frac{C_D A}{m},
\end{equation}
missä $C_D$ on kappaleen ilmanvastuskerroin, $A$ on nopeutta vastaan kohtisuora pinta-ala ja $m$ on massa. Mikäli satelliitti ei menetä polttoainetta tai rakenneosasiaan (esimerkiksi kiertoratakorjauksen tai törmäyksen seurauksena), edellä esitellyistä ilmanvastukseen vaikuttavista tekijöistä ainoastaan massa säilyy vakiona yhden (tai useamman) kiertoratakierroksen ajan. Nopeus ja ilmakehän tiheys vaihtelevat eniten, mutta kerroin $C_D$ riippuu heikosti ilmakehän kaasukoostumuksesta (lähde) ja nopeutta vastaan kohtisuora ala A taas tuulennopeudesta ja satelliitin mahdollisesta pyörimisestä. 

\begin{figure}[t]
\ttfamily
\scriptsize
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17124.83855883 +.00002555 +00000-0 +46104-4 0  9999

2 25544 051.6415 254.3711 0005715 124.5522 336.3551 \underline{15.53964796055018}
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17125.21849080 +.00002605 +00000-0 +46858-4 0  9996

2 25544 051.6415 252.4770 0005705 125.9198 301.8433 \underline{15.53967431055076}
\noindent\rule[0.5ex]{\linewidth}{1pt}

1 25544U 98067A   17125.47998944 +.00002778 +00000-0 +49476-4 0  9998

2 25544 051.6417 251.1751 0005804 127.0105 324.6272 \underline{15.53970335055110}
\noindent\rule[0.5ex]{\linewidth}{1pt}
\rmfamily
\caption{Kolme esimerkkiä kansainvälisen avaruusaseman (ISS) kaksirivisestä elementtidatasta vuonna  2017. Vanhin havainto ylimpänä. Keskiliike (kierrosta päivässä) on alleviivattu.}
\label{fig:tle}
\end{figure}

Kuva \ref{fig:tle} esittää kolme esimerkkiä NORAD:n tutkadatasta vouden 2017 toukokuulta, joiden avulla kiertoradan aikakehitys voidaan määrittää. Kaksirivisen jakeluformaattinsa vuoksi havaintoaineistoa kutsutaan kaksiriviseksi elementtidataksi. Ensimmäinen rivi antaa kappaleen tunnisteen (NORAD ID, esimerkiksi 25544 kansainväliselle avaruusasemalle), havaintoajan (esimerkiksi 17124 vuoden 2017 päivälle 124), sekä tietoja kiertoradan muutoksista (lähde). Toinen rivi antaa kuusi rataparametriä, jotka määräävät tarkalleen kappaleen keskimääräisen kiertoradan tietyn ajanjakson yli; järjestyksessä vasemmalta oikealle: (1) inklinaatio (esimerkiksi 051.6415) ja (2) nousevan noodin rektaskensio (254.3711) asteina, (3) Eksentrisyyden desimaaliosa (0005715), (4) perigeumin argumentti (124.5522) ja (5) keskianomalia (336.3551) asteina, sekä (6) keskiliike kierroksina päivässä (15.53964). Kaikki toisen rivin rataparametrit ovat keskiarvoja useiden havaintojen ja päivien yli. Keskiarvostuksen tarkka aikaikkuna ei ole julkista tietoa, mutta (lähde Picone 2005) esittää sen olevan nykyään noin kolme päivää matalan maan kiertoradan kappaleille. 

NORAD:n käyttämässä sovitus- ja keskiarvoistusmenetelmässä kappaleen paikasta (ja joskus myös nopeudesta) tehtäviin tutkahavaintoihin sovitetaan tietty analyyttinen kiertoratamalli vaihtelemalla kaksirivisten elementtien arvoja siten, että mallin tulos vastaa mahdollisimman hyvin kappaleen havaittua kiertorataa (lähde). Tämä analyyttinen malli, Simplified General Perturbation-4 (SGP4) (lähde) sisältää yksinkertaisen kuvauksen mapallon painovoimakentästä ja sen epähomogeenisuudesta, minkä ansiosta keskiarvoistus poistaa epähomogeenisuuden aiheuttamat lyhytjaksoiset vaihtelut satelliitin kiertoradassa (lähde). 

Termosfäärin aiheuttaman ilmanvastusvoiman johdosta satelliitti menettää kiertoratakorkeuttaan, sen radan eksentrisyys pienentyy ja  kiertonopeus kasvaa (lähde King-Hele). Ilmanvastuksen määrittämiseksi on siis käytännöllistä hyödyntää kaksirivisen elementtidatan ilmoittamaa kiertoradan kulmataajuutta, josta maan painovoiman vaikutus on poistettu. Tällöin siinä tapahtuvat muutokset aiheutuvat pääasiassa ilmakehän vaikutuksesta. Kuva \ref{fig:tle} antaa tästä esimerkin; kansainvälisen avaruusaseman kiertonopeus (alleviivattu) näyttää selvästi kasvavan ajan funktiona. Tässä tutkielmassa hyödynnetään (lähde Picone) menetelmää, joka kytkee kvantitatiivisesti yhteen muutokset kiertonopeudessa ja ilmakehän tiheydessä. (lähde Picone) mukaan yhtälö \ref{airdrag_eq} voidaan esittää hetkellisen keskiliikkeen $n_M$ avulla muodossa:
\begin{equation} \label{meanmotion_eq}
\frac{d}{dt} n_M \cong \frac{3}{2} n_M^{1/3} \mu^{-2/3} \rho B v^3 F,
\end{equation}
missä $\mu$ on maapallon gravitaatioparametri (gravitaatiovakion ja maan massan tulo) 3.986 $\cdot 10^{14}~ \mathrm{m^3 s^{-2}}$ ja $\rho$, $B$, sekä $v$ ovat hetkellisiä arvoja tietyssä kiertoradan pisteessä. Tuulenvoimakkuusparametri F on dimensioton parametri, joka kuvaa tuulennopeuden vaikutusta kappaleen kokemaan ilmanvastusvoimaan:
\begin{equation} \label{F_eq}
F = \frac{\left | \mathbf{v} - \mathbf{V} \right |^2}{v^2} \mathbf{e_{v-V}} \cdot \mathbf{e_{v}}.
\end{equation}
Mikäli oletetaan maapallon mukana pyörivä virtaukseton ilmakehä, hyvä approksimaatio on (lähde King-Hele):
\begin{equation} \label{F_approx_eq}
F \cong \left ( 1 - \frac{r~\Omega_E}{v} \cos(i) \right )^2,
\end{equation}
missä $\Omega_E$ on maapallon kulmanopeus $7.292 \cdot 10^{-5} ~\mathrm{s^{-1}}$, $i$ on satelliitin inklinaatio ja $r$ on etäisyys maapallon keskustasta. Approksimaation virhe on termosfäärin empiirisillä tuulimalleilla laskettuun yhtälöön (\ref{F_eq}) nähden alle 3\%:a ja virhe on vielä pienempi kun yhtälöä (\ref{meanmotion_eq}) integroidaan useiden päivien yli. 

Yhtälön (\ref{meanmotion_eq}) integrointi on mahdollista kahden eri kaksirivisen elementin välillä (lähde Picone):
\begin{equation} \label{int_meanmotion_eq}
\Delta_{ik}n_M \cong \frac{3}{2} \mu^{-2/3} \oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt,
\end{equation}
missä $\Delta_{ik} n_M$ kuvaa keskiliikkeen diskreettiä muutosta kahden elementin välillä ja viivaintegraali tarkoittaa integrointia useiden ratakierrosten yli ajanhetkien $t_i$ ja $t_k$ välillä. Keskiliikkeen muutos selviää suoraan kaksirivisten elementtien keskiarvoistetussa keskiliikkeessä havaitusta muutoksesta. Sen sijaan integrointiin tarvitaan välttämättä samaa SGP4-mallia, jota kaksirivisen elementtidatan keskiarvoistuksessa on käytetty, koska vain sen avulla keskiarvoistettu kiertorata on mahdollista muuttaa tutkien havaitsemaksi, koko ajan ajassa muuttuvaksi kiertoradaksi (lähde). Jos integroinnissa käytettäisiin jotain muuta mallia, eivät kaksisiriviset elementtidatat enää antaisi lähellä tutkahavaintoja olevaa kuvausta kappaleen kiertoradasta. Valitettavasti SGP4-mallin nykyinen lähdekoodi ei kuitenkaan ole julkinen. Viimeisin julkaisu on 1980-luvulta (lähde Hoots, 1980), mutta vähäisiä myöhemmin julkaistuja korjauksia ja takaisinmallinnusta käyttäen siviilitutkijat (lähde Vallado AIAA 2006-6753-Rev2) ovat laatineet mallista version, joka heidän mukaansa vastaa tarkasti nykyistä kaksirivisten elementtien määrityksessä käytettyä mallia. Tästä eteenpäin SGP4-mallilla tarkoitetaan aina (lähde Vallado 2006) versiota.

Koska SGP4 antaa ainoastaan satelliitin inertiaalikoordinaatiston nopeuden ja paikan, ei yhtälön (\ref{int_meanmotion_eq}) integrointia voi sellaisenaan suorittaa. Kuitenkin yhtälöstä (\ref{int_meanmotion_eq}) nähdään, että on olemassa jokin koko integroinnin yli vakiona pysyvä tiheys, joka toteuttaa yhtälön tarkasti:
\begin{equation} \label{density_raw_eq}
\rho^H(t_{ik}) \equiv \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3}}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt} = \frac{\oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt},
\end{equation}
missä yläindeksi H tarkoittaa havaittua ja $t_{ik} \equiv (t_i + t_k) / 2$ on ajanhetki, jota tiheyden katsotaan data-assimilaatiossa kuvaavan. Kyseessä on kuitenkin satelliittin kokema "keskimääräinen" tiheys, joka ei kuvaa mitään tiettyä pistettä tai ajanhetkeä, vaan tiheyden vaikutusta useiden ratakierrosten yli. Integrointiin vaikuttaa lisäksi jonkin verran SGP4-mallin sisältämä analyyttinen ilmakehä. Tämän vaikutus on kuitenkin (lähde Picone) mukaan muutaman päivän integroinnin aikana hyvin pieni, koska havaittu tiheys riippuu voimakkaasti kappaleen perigeumin korkeudesta, jonka muutokset ovat ilmakehän skaalauskorkeuteen nähden merkityksettömiä. Käytännössä voidaan siis sanoa, että yhtälön (\ref{density_raw_eq}) arvio on täysin riippumaton mistään yläilmakehämallista, mikä mahdollistaa kaksirivisten elementtien käytön termosfäärimallien tiheyskorjauksissa käyettävänä, mallista riippumattomana havaintoaineistona.

Olettamalla ilmanvastuskerroin vakioksi ja arvioimalla keskiliikkeen suuruutta kahden kaksirivisen elementin keskiliikkeiden keskiarvolla $n_M(t_{ik})$ päädytään yhtälöön, jonka integraalitermi voidaan SGP4:n avulla laskea:
\begin{equation} \label{density_12_eq}
\rho^H(t_{ik}) \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{B^T \oint_{(t_i,t_k)}  v^3 F dt}  \cong \frac{\oint_{(t_i,t_k)} \rho^T v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt} \equiv \rho^T(t_{ik}),
\end{equation}
missä yläindeksi T viittaa "todelliseen" (todellisen ballistisen kertoimen määritys käsitellään seuraavassa osiossa). Vastaavasti löydetään ekvivalentti mallitiheys, johon kaksirivisen elementtidatan avulla laskettua tiheyttä voidaan vertailla:
\begin{equation} \label{density_13_eq}
\rho^M(t_{ik}) \equiv \frac{\oint_{(t_i,t_k)} \rho^M v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt},
\end{equation}
missä yläindeksi M viittaa yläilmakehän tiheysmalliin (IL).

Käytännössä yläilmakehän tiheyden määritys kaksirivisen elementtidatan avulla pitää sisällään seuraavat vaiheet:
\begin{enumerate}
\item Valitaan kappale, jonka kiertoradalla ilmanvastusvoima on suuri muihin kiertorataa muuttaviin voimiin verrattuna.
\item Ladataan internetistä (lähde Spacetrack) kappaleen kaksiriviset elementit riittävän pitkältä ajanjaksolta.
\item Arvioidaan kappaleen todellinen ballistinen kerroin $B^T$, mikäli sitä ei ole aiemmin tehty.
\item Valitaan kaksi kaksirivistä elementtiä, joiden epookkien $t_i$ ja $t_k$ välillä massatiheys määritetään. 
\item Lasketaan satelliitin paikka ja nopeus SGP4-mallin avulla hyvin tiheästi (tässä työssä kerran puolessa minuutissa) kahden epookin välillä.
\item Lasketaan tuuliparametri F yhtälöstä (\ref{F_eq}) tai (\ref{F_approx_eq}) ja integroidaan yhtälön (\ref{density_12_eq}) viivaintegraali numeerisesti (tässä työssä puolisuunnikassäännöllä (lähde)).
\item Määritetään keskiliikkeen muutokset kahden kaksirivisen elementin avulla ja arvioidaan ilmakehän keskimääräinen tiheys yhtälöstä (\ref{density_12_eq}).
\end{enumerate}

\subsection{Kappaleiden valinta ja ballistisen kertoimen määritys}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.25]{Explorer_8}
\caption{Explorer 8 -satelliitti (NORAD ID 60), jota käytetään yläilmakehän tiheyden määrityksessä. Muodoltaan satelliitti muistuttaa kaksoiskartiota; kappaleen nopeusvektori avaruudessa osoittaisi kuvan tapauksessa lähes suoraan ylöspäin. (lähde Wikimedia)}
\label{fig:explorer8}
\end{figure}

Kuten aiemmassa osiossa todetiin, termosfäärin massatiheys voi aiheuttaa aiheuttaa havaittavia poikkeamia matalalla kiertävien kappaleiden kiertoratoihin. Koska työn tavoitteena on tuottaa kolmiulotteinen korjaus IL-mallin termosfäärin tiheysennusteeseen, tässä tutkielmassa käytetään useita kymmeniä eri korkeuksilla, aurinkoajoilla ja leveyspiireillä kiertäviä satelliitteja. Käytännössä on kuitenkin hyvin vaikeaa valita useiden tuhansien satelliittien joukosta ne, joita termosfääritutkimuksissa voidaan käyttää; satelliitti ei saisi olla toimintakuntoinen, sen olisi oltava säännöllisen muotoinen (katso esimerkiksi Kuva \ref{fig:explorer8}) eikä se saisi pyöriä, jotta sen ballistista kerrointa voidaan arvioida vakiona. Tämän työn data-assimilaatiojärjestelmässä käytetyt 45 satelliittia ja kolme riippumatonta arviointisatelliittia on valittu aiempien tutkimusten (lähde saunders, emmert) perusteella. Erityisen tärkeä tietolähde on ollut luettelo Yhdysvaltain ilmavoimien Avaruustaistelulaboratorion (\textit{US Air Force Space Battlelab}) High Accuracy Satellite Drag Model (HASDM)-mallissa käytetyistä 80:sta kappaleesta (lähde Doornbos). 

Vaikka aiemmissa tutkimuksissa tiheysanalyysiin sopivia kappaleita on löydetty kymmenittäin, on niiden todellisen ballistisen kertoimen määrittäminen hankalaa (lähde). Tämä aiheutuu pääasiassa siitä, että ballistinen kerroin riippu ilmanvastuksesta ja ilmakehän tiheydestä itsestään yhtälön (\ref{density_12_eq}) mukaan:
\begin{equation} \label{Bi_eq}
B_i \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)} \rho^T v^3 F dt},
\end{equation}
missä $B_i$ on keskimääräinen ballistinen kerroin epookkien välillä. Käytännössä siis jokaisten kaksirivisten elementtien epookkien välillä ballistinen kerroin on eri. Määritystä vaikeuttaa vielä se, ettei yhtälössä (\ref{Bi_eq}) tarvittavaa ilmakehän todellista tiheyttä $\rho^T$ tunneta. Tästä syystä usein käytetään todellisen tiheyden tilalla empiirisen termosfäärimallin tiheyttä $\rho^M$(lähde esim. Doornbos) ja todellisen ballistisen kertoimen arvossa käytetään $B_i$-arvojen keskiarvoa useiden vuosien yli. 

\begin{figure}[t]
\includegraphics[scale = 0.5]{gradu_Bi}
\caption{Ballistisen kertoimen ja tiheyskorkeuden aikasarja Explorer 8 -satelliitille. Kuvassa punaisten viivojen sisäpuolelle jäävää vuotta 2003 ei ole huomioitu ballistisen kertoimen laskennassa.}
\label{fig:Btrue}
\end{figure}

Tätä menetelmää käytetään myös tässä tutkielmassa. Kuva \ref{fig:Btrue} esittää Explorer 8 -satelliitin $B_i$-kertoimien aikasarjaa ja sitä korkeutta, jota satelliitin radasta määritetyn massatiheyden voidaan parhaiten katsoa kuvaavan (tekijällä $\rho^M v^3 F$ painotettu keskiarvo geometrisestä kiertoratakorkeudesta). Data-assimilaatiojärjestelmän toimivuutta testataan vuoden 2003 datalla, joten todellinen ballistinen kerroin määritellään vuosien 2002 ja 2004 kertoimien $B_i$ keskiarvona. Jotta epookkien välinen ballistisen kertoimen satunnaisvaihtelu olisi mahdollisimman pientä, käytetään yhtälön (\ref{Bi_eq}) integroinnissa vähintään kymmenen päivän integrointipituutta, minkä johdosta havaitut keskiliikkeen muutokset ovat suurempia ja merkitsevämpiä. Käytännössä ballististen kertoimien keskiarvoistus tekee kappaleiden avulla tehtävän tiheysmäärityksen IL-mallin suhteen harhattomaksi (pitkien ajanjaksojen yli).

Explorer 8 -satelliitin ballistisen kertoimen aikasarjalla on selvästi vahva puolivuosittainen komponentti, jossa $B_i$:n paikalliset maksimit osuvat mielenkiintoisesti samoihin aikoihin kuin termosfäärin globaalin massatiheyden maksimit \citep{emmert_2015}. Tämä todennäköisesti kertoo mallin ajallisesti vaihtelevasta virheestä kappaleen kiertoradalla, sillä yhtälöiden (\ref{density_12_eq}) ja (\ref{density_13_eq}) perusteella:
\begin{equation} \label{obsToModel_eq}
\frac{\rho^H}{\rho^M} \cong \frac{B_i}{B^T}.
\end{equation}
Näin ollen IL-malli aliarvioisi yläilmakehän puolivuosittaista massatiheysvaihtelua tässä yksittäistapauksessa. Muiden satelliittien ballistinen kerroin käyttäytyy hyvin usein samanlaisella tavalla, mutta värähtelyn taajuus vaihtelee neljännesvuosittaisesta vuosittaiseen (ei näytetä). 

Tämä peräkkäisten $B_i$ -havaintojen suuri kovarianssi vaikeuttaa $B^T$:n virhearvion tekemistä. Tässä tutkielmassa todellisen ballistisen kertoimen virhearviona käytetään satunnaisjakautuneen keskiarvon keskivirhettä (esim. lähde):
\begin{equation} \label{Bi_err_eq}
\sigma_{B^T} = \frac{s_{B_i}}{\sqrt{N_{B_i}}},
\end{equation}
jossa $\sigma_{B^T}$ on kertoimen virhe, $s_{B_i}$ on vuosien 2002 ja 2004 $B_i$ -havaintojen keskihajonta ja $N_{B_i}$ havaintojen lukumäärä. Vaikka kyseessä on havaintojen suuresta autokorrelaatiosta johtuen selkeä aliarvio, vaihtelee virhearvio 3\%:n ja 10\%:n välillä. Tämä kvalitatiivisesti vastaa aiempia arvioita kaksirivisillä elementeillä saavutettavasta tarkkuudesta (esim. lähde Doornbos). Lisäksi havainnot ballistisesta kertoimesta eivät ole aivan normaalijakautuneita (ei näytetä), jolloin $\sigma_{B^T}$ ei välttämättä kunnolla kuvasta ballistisen kertoimen vaihtelua. 

Aiemmissa tutkimuksissa käytetyistä kappaleista valittiin ne 48 kappaletta, joiden (1) kaksirivisiä elementtejä oli saatavilla vuosina 2002 -- 2004 vähintään kahden päivän välein, (2) keskimääräinen tiheyskorkeus oli alle 550 km, (3) keskiliikkeen trendi selvästi kasvava ja (3) yksittäiset $B_i$ -arvot poikkesivat keskiarvostaan enintään tekijällä 4. Kaksirivisten elementtien perusteella laskettujen $B_i$ -arvojen hajonta kasvoi ja keskiliikken kasvuvauhti hidastui merkittävästi yli 550 km:n tiheyskorkeudella, joten tässä työssä oletetaan, että hyödyllisiä tiheyshavaintoja on saatavilla vain tämän korkeuden alapuolelta. Kappaleista kolme, keirtoradalle jääneet raketin osat 1616 (tiheyskorkeus 437 km), 2017 (538 km), ja 23198 (397 km) toimivat riippumattomina kappaleina, joiden avulla data-assimilaation laatua voidaan arvioida. Kyseiset kolme ki

%\pgfplotstabletypeset[]{Bfactors.csv}

\section{Ensemble Kalman -suodin}

\subsection{Taustaa}

Data-assimilaation tavoitteena on korjata mallin ennustetta havaintojen avulla siten, että mallin tila vastaa mahdollisimman tarkasti tutkittavan järjestelmän todellista tilaa. Data-assimilaatio on tärkeä osa operatiivisia säänennustusjärjestelmiä, sillä sen avulla voidaan mallille asettaa mahdollisimman todenmukainen alkutila, jota mallin yhtälöt kehittävät ajassa eteenpäin. 

Koska sekä havainnot että malli sisältävät virhettä, saadaan paras kuva järjestelmän todennäköisimmästä tilasta yhdistämällä mallin ja havaintojen tiedot keskenään. Olettamalla virheiden olevan normaalijakautuneiden, voidaan mallin tilan $\mathbf{x}$ todennäköisyysjakauma lausua ainoastaan mallin taustan (eli korjaamattoman ennusteen) $\mathbf{x_b}$ avulla (lähde):
\begin{equation} \label{model_prob_eq}
P(\mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b})\right ],
\end{equation}
missä $\mathbf{B}$ on mallin taustan kovarianssimatriisi. Koska malli ja havainnot kuvaavat samaa järjestelmää, on mielekästä määritellä havaintojen $\mathbf{y}$ todennäköisyys, kun mallin tila $\mathbf{x}$ on tunnettu:
\begin{equation} \label{data_prob_eq}
P(\mathbf{y} | \mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ],
\end{equation}
jossa $\mathbf{R}$ ilmaisee havaintojen kovarianssin ja $H$ on niin sanottu havainto-operaattori, joka on kuvaus malliavaruudesta havaintoavaruuteen. Se siis ilmaisee, mitä arvoja tulisi havaita, mikäli mallitila on annetun ja havainnot virheettömiä.

Näiden kahden todennäköisyyden ja Bayesin lauseen avulla saadaan määritettyä todennäköisyys mallin tilalle, kun havainnot ovat annetujen:
\begin{align} \label{final_prob_eq}
P(\mathbf{x} | \mathbf{y}) \propto P(\mathbf{y} | \mathbf{x}) P(\mathbf{x}) \propto 
\exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ].
\end{align}
Eksponenttifunktion monotonisuuden johdosta suurin todennäköisyys löydetään minimoimalla lauseketta (n.k. sakkofunktio):
\begin{align} \label{J_eq}
 J~=~\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) + \frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x})).
\end{align}
Tämän funktion minimikohta antaa järjestelmän todennäköisimmän tilan eli niin sanotun analyysin $\mathbf{x}=\mathbf{x_a}$.

Data-assimilaatio-järjestelmät jaetaan kahteen pääluokkaan sen mukaan, minimoivatko ne funktiota (\ref{J_eq}) suoraan jollakin iteratiivisella minimointialgoritmilla (variaatiomenetelmät), vai ratkaisevatko ne joukon lineaarisia yhtälöitä järjestelmän todennäköisimmän tilan löytämiseksi (peräkkäiset menetelmät) (lähde). Eräs käytetyimmistä peräkkäisistä data-assimilaatio-menetelmistä on Kalman-suodin (lähde), joka tuottaa lineaariselle järjestelmälle harhattoman analyysin ja eksaktit virhekovarianssit. Kalman-suotimen toiminta perustuu sakkofunktion minimointiin analyyttisen ratkaisun avulla, joka löytyy sakkofunktion derivaatan ($\partial J / \partial \mathbf{x}$) nollakohdasta. Tämän nollakohdan laskennassa oletetetaan, että havainto-operaattori $H$ on linearisoitavissa siten, että:
\begin{align} \label{tanglin_eq}
H(\mathbf{x})-H(\mathbf{x_b}) \cong \mathbf{H}(\mathbf{x-x_b}),
\end{align}
missä $\mathbf{H}$ on tangentti-lineaarinen havainto-operaattori eli havaintojen Jacobin matriisi mallitilan suhteen $\mathbf{H_{ij}} = \partial y_i / \partial x_j$. Tämän (approksimaation) avulla analyysiksi löydetään:
\begin{align} \label{xa_eq}
\mathbf{x_a} = \mathbf{x_b} + \mathbf{K}(\mathbf{y} - H(\mathbf{x_b})),
\end{align}
jossa 
\begin{align} \label{K_eq}
\mathbf{K} = \mathbf{B H^T}(\mathbf{HBH^T} + \mathbf{R})^{-1}
\end{align}
on Kalmanin optimaalinen painomatriisi, $\mathbf{HBH^T}$ ilmaisee mallin ennustaman havaintojen virhekovarianssin, ja $\mathbf{BH^T}$ kovarianssin havaintojen ja mallitilan välillä. Mitä tarkempia havainnot ovat suhteessa taustaan, sitä enemmän painoa niille annetaan ja sitä lähemmäs havaintoja mallitila pyrkii; päinvastaisessa tilanteessa analyysi ei juurikaan poikkea taustasta.

Lisäksi Kalman-suotimessa mallitilan aikakehityksessä tarvittavan ennustusmallin lisäksi on oltava malli, joka kehittää analyysin kovarianssia 
\begin{equation} \label{analysis_cov_eq}
\mathbf{A}^n\mathbf{ = (I-KH)B}^{n}
\end{equation}
ajassa eteenpäin (lähde):
\begin{align} \label{time_evol_eq}
\mathbf{B}^{n+1} = \mathbf{MA}^n\mathbf{M^T},
\end{align}
missä yläindeksi n viittaa aikaan ja $\mathbf{M} = \partial M / \partial \mathbf{x_a}$ on (epälineaarisen) mallin $M$ linearisoitu eli tangentti-lineaarinen malli. 

Kalman-suodin ei kuitenkaan sovellu sellaisenaan käytettäväksi nykyaikaisissa säämalleissa, sillä taustan ja analyysin kovarianssimatriisit muodostuisivat niin suuriksi, ettei niitä nykyisillä tietokoneilla voisi käsitellä (lähde). Lisäksi tangentti-lineaaristen havainto-operaattorien ja mallin kehitystyö vaatii paljon aikaa, ennen kuin data-assimilaatio-järjestelmää voidaan hyödyntää (lähde). Yksinkertaisemmalle ja tehokkaammalle järjestelmälle on siis tarvetta; (lähde Evensen 1994) esitteli suotimesta Monte Carlo -version, ensemble Kalman-suotimen (EnKF, englanniksi \textit{Ensemble Kalman Filter}). EnKF käyttää taustan kovarianssin arviointiin mallirypästä, joka on äärellinen otos mallitilojen todennäköisyysjakaumasta. Tämän otoskovarianssin avulla Kalmanin optimaalinen painomatriisi voidaan määrittää ja näin päivittää malliryppään tilat.

Ryväs on kokoelma malleja, joiden tilat poikkeavat hieman toisistaan. Se voidaan esittää matriisina, jonka jokainen sarake (pituus m) edustaa yhtä mallitilaa ja jokainen rivi (pituus N) yhden mallin muuttujan tilan todennäköisyysjakaumaa (lähde):
\begin{equation} \label{ens_eq}
\mathbf{X} = \mathbf{[x_1,x_2,...,x_N] = [x_i]}.
\end{equation}
Ryppään mallitilojen oletetaan olevan todennäköisyysjakauman satunnaisotos, mutta tarkalleen ottaen peräkkäinen data-assimilaatio EnKF:lla tekee niiden tilat riippuviksi toisistaan. Tällöin mallin kovarianssi voidaan arvioida suoraan ryppään avulla:
\begin{equation} \label{enscov_eq}
\mathbf{C} = \frac{\mathbf{AA^T}}{N-1},
\end{equation}
missä $m \times N$ -matriisi 
\begin{equation} \label{A_eq}
[\mathbf{A}]_i = \mathbf{x}_i - E(\mathbf{X})
\end{equation}
ja rypäskeskiarvo
\begin{equation} \label{E_eq}
E(\mathbf{X}) = \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k}.
\end{equation}

Koska mallitilan lisäksi havainnot sisältävät epävarmuutta, kuvataan havaintovektoria $\mathbf{y}$ myös joukkona satunnaisotoksia:
\begin{equation} \label{data_eq}
\mathbf{Y} = \mathbf{[y_1,y_2,...,y_N] = [y_i]},~\mathbf{y_i = y + \epsilon_i},
\end{equation}
jossa Y on oxN -matriisi, jonka sarakeisiin on lisätty $N(0,\mathbf{R})$ -jakautuneita o-pituisia satunnaislukuvaktoreita $\mathbf{\epsilon_i}$. 

Näiden avulla Kalman-suotimen analyysiyhtälö saa muodon:
\begin{equation} \label{enkf_anal_eq}
\mathbf{X_a = X_b + CH^T (HCH^T+R)^{-1} (Y-HX)}.
\end{equation}
Koska taustan kovarianssi arvioidaan jokaisella assimilaatiokierroksella yhtälöstä (\ref{enscov_eq}), ei yhtälön (\ref{time_evol_eq}) kaltaista kovarianssimatriisin kehitysyhtälöä enää tarvita. Kehittämällä jokaista ryppään mallia seuraavalle assimilaatiohetkelle, mahdollisesti hyvin epälineaarinen ennustusmalli kehittää samalla myös kovarianssia itseään ajassa eteenpäin. Näin ollen EnKF ei tarvitse tangentti-lineaarista mallia toimiakseen, mikä helpottaa algoritmin implementointia. 

Yhtälössä (\ref{enkf_anal_eq}) on kuitenkin jäljellä tangentti-lineaarinen havainto-operaattori $\mathbf{H}$. Sijoittamalla analyysiyhtälöön kovarianssin lauseke (\ref{enscov_eq}) ja olettamalla taustan ja havaintojen virheet korreloimattomiksi, saadaan yhtälö muotoon (lähde):
\begin{align} \label{ha_analysis_eq}
\mathbf{X_a = X_b} + \frac{1}{N-1} \mathbf{A A^T H^T} (\frac{1}{N-1} \mathbf{H A A^T H^T+R)^{-1} (Y-HX)}\nonumber \\
= \mathbf{X_b} + \frac{1}{N-1} \mathbf{A (HA)^T} (\frac{1}{N-1} \mathbf{HA(HA)^T  + R)^{-1} (Y-HX)}
\end{align}
Tässä matriisi $\mathbf{HA}$ voidaan lausua epälineaarisen havainto-operaattorin $H$ avulla:
\begin{align} \label{HA_eq}
[\mathbf{HA}]_i = \mathbf{H x_i} - \mathbf{H} \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k} \nonumber\\
\cong H(\mathbf{x_i}) - \frac{1}{N} \sum_{k=1}^{N} H(\mathbf{x_k}).
\end{align}
Selvästi myös $\mathbf{[HX]}_i \cong H(\mathbf{x_i})$, joten yhtälö (\ref{HA_eq}) voidaan siis esittää ainoastaan $H$:n avulla. Näin ollen tarvetta tangentti-lineaarisille operaattoreille ei EnKF:ssa lainkaan ole. 

Ensemble Kalman-suotimeen liittyy sen yksinkertaisesta implementaatiosta huolimatta joitain vaikeuksia. Suurimmat ongelmat liittyvät suotimen Monte Carlo -luonteeseen; kuinka voidaan varmistaa, että malliryväs on edustava otos järjestelmän tilan todennäköisyysjakaumasta? Ongelmat ovat suurimmillaan, kun ryppään koko $N$ on pieni. Jos malleja on liian vähän esittämään todennäköisyysjakauman vaihtelua, on järjestelmä alinäytteistetty (lähde). Alinäytteistys on voi johtaa tilanteeseen, jossa analyysin kovarianssia järjestelmällisesti aliarvioidaan (lähde Lorenc, 2003). Virhe analyysin kovarianssissa ilmenee virheenä seuraavan assimilaatiosyklin taustan kovarianssissa, jolloin havaintojen ja taustan kovarianssien suhde ei ole oikein ja näiden avulla tuotettu analyysi on virheellinen. 

Yhtälön (\ref{analysis_cov_eq}) mukaisesti analyysin kovarianssi on taustan kovarianssia pienempi. Yhdessä alinäytteistyksen aiheuttaman järjestelmällisen aliarvion kanssa (lähde Hamill, 2001) tämä voi aiheuttaa suotimen konvergenssia, jossa malliryppään jäsenet lähestyvät ajan kuluessa toisiaan. Tällöin havaintojen kovariannsi suhteessa taustan kovarianssiin kasvaa ja havaintojen merkitys malliryppään päivityksessä käy lopulta hyvin pieneksi. Suodinkonvergenssia vastaan on EnKF-järjestelmissä usein menettely, joka keinotekoisesti kasvattaa analyysin tai taustan kovarianssia (lähde Anderson ja Anderson). Tässä työssä käytettyä kovarianssin kasvatusmenetelmää käsitellään tarkemmin seuraavassa osiossa.

Kovarianssin pienenemisen lisäksi alinäytteistys aiheuttaa mallitilan kovarianssiin epäfysikaalista kohinaa eli niin sanottuja harhaanjohtavia korrelaatioita (lähde Hamill). Fysikaalisessa hilapisteavaruudessa toimivien mallien hilapisteiden arvot voivat näennäisesti korreloida keskenään, vaikka niiden välinen etäisyys olisi suuri. Koska kausaalinen yhteys hilapisteiden arvojen välillä pienenee pisteiden välisen etäisyyden funktiona, voi luonteeltaan globaalissa (kaikki havainnot vaikuttavat kaikkiin mallin muuttujiin) EnKF:ssa kehittyä tilanne, jossa kaukana hilapisteestä oleva havainto vaikuttaa epäfysikaalisen paljon hilapisteen analyysiin. Diskreeteissä hilamalleissa, jotka laskevat malliryppään avulla eksplisiittisen taustan kovarianssin, voidaan harhaanjohtavia korrelaatioita torjua pienentämällä hilapisteiden välistä kovarianssia jonkin funktion mukaisesti (lähde). Samanlainen menettely on mahdollista myös palloharmonisissa malleissa tekemällä oletuksia virheen isotrooppisuudesta (lähde) tai käyttäen pseudo-spketraalimenetelmää (lähde). Tässä työssä taustakovarianssin harhaanjohtavia korrelaatioita ei kuitenkaan yritetä korjeta.

\subsection{Ensemble Kalman -suodin Iipponen-Laitinen -mallissa}

Ensemble Kalman -suodinta on aiemmin hyödynnetty yläilmakehämallien data-assimilaatiossa (lähteitä). Tällöin kyseessä ovat kuitenkin olleet fysikaaliset mallit, jotka integroivat yläilmakehää kuvaavia primitiiviyhtälöitä ajassa eteenpäin. Puoli-empiirisiä malleja on sen sijaan korjattu sovittamalla havaintoihin funktiosovitus(esim. lähteet Doornbos ja HASDM), joka on kokonaan jättänyt huomiotta mallin taustan. Lisäksi aiemmat empiiristen mallien data-assimilaatiot ovat olleet täysin deterministisiä, kun taas EnKF antaa kuvauksen ilmakehän tilan todennäköisyysjakaumasta.

Tässä työssä ilmakehämallin massatiheyttä korjataan (lähde Doornbos) esittämällä tavalla, jossa korjataan mallin ala- (130 km:ssa) ja ylärajan (eksosfääri) lämpötiloja. Tämä lämpötilaprofiilin muutos vaikuttaa kaikkien ilmakehän kaasulajien skaalauskorkeuksiin ja siten massatiheyteen vakiokorkeuspinnoilla. Mallin alarajalla absoluuttista lämpötilaa $\mathrm{T_0}$ ja sen pystysuuntaista gradienttia T' korjataan skalaarien $\mathrm{\Delta T_0}$ ja $\mathrm{\Delta T'}$ avulla:
\begin{align} \label{lb_ass_eq}
\mathrm{T_{0,a}} = \mathrm{T_{0,IL}} + \mathrm{\Delta T_0} \\
\mathrm{T'}_= \mathrm{T'}_{IL} + \mathrm{\Delta T'}
\end{align}
Korjaukset ovat siis aina lisäyksiä korjaamattoman IL-mallin lämpötilakenttiin. 

Koska lähes isotermisen keski- ja ylätermosfäärin lämpötilavaihtelut ovat suurempia kuin alatermosfäärissä \citep{emmert_2015}, on eksosfäärin lämpötilalla (malli ylärajalla) alareunan lämpötiloja suurempi vaikutus termosfäärin tiheyteen. Näin ollen eksosfäärin lämpötilakuvauksen on syytä olla alareunan korjauksia realistisempi. Eksosfäärin lämpötilaa korjataan käyttäen palloharmonista sarjaa:
\begin{equation} \label{deltaTex_eq}
\mathrm{\Delta T_{ex}} = a_0 + \sum_{n=1}^{N}\left [ \sum_{m=0}^{n} a_{nm} P_{nm}(sin(\phi)) cos(m \lambda ) + \sum_{m=0}^{n} b_{nm} P_{nm}(sin(\phi)) sin(m \lambda ) \right ],
\end{equation}
jossa $a_{nm}, b_{nm}$ ovat reaaliarvoisten palloharmonisten funktioiden kertoimia, $n$ on asteluku, $m$ on kertaluku (zonaalinen aaltoluku), $N$ on suurin aste- ja kertaluku (kolmiomainen katkaisu TN (lähde)), $\phi$ on leveyspiiri, $\lambda$ on aurinkoaika ja 
\begin{equation} \label{legendre_eq}
P_{nm}(x) = \frac{(-1)^m}{2^n n!} (1-x^2)^{m/2} \frac{d^{n+m}}{d x^{n+m}} (x^2 - 1)^n
\end{equation}
ovat normalisoimattomat Legendren liittofunktiot. Tässä työssä rajoitutaan palloharmoniseen korjaukseen T2, jonka avulla suuriamplitudinen päivä- ja puolipäivävaihtelu voidaan hyvin karakterisoida. Näin ollen mallitila koostuu yhteensä 11:a korjausparametristä (kaksi alarajalla ja yhdeksän ylärajalla).

Jotta mallitilan ja havaintojen kovarianssien suhde voitaisiin määrittää, on havaintoaineistolle oltava selkeä virhearvio. Tämän työn data-assimilaatio-järjestelmässä havaintoina käytetään ainoastaan kaksirivisiä elementtejä. Ongelma kuitenkin on, ettei kaksirivinen elementtiaineisto pidä sisällään mitään tietoa havaintoepävarmuudesta, eikä käyttäjän ole mitenkään mahdollista selvittää alkuperäisten tutkahavaintojen tai ratasovituksen tarkkuutta (lähde). Siksi tässä työssä oletetankin kaksirivisten elementtien itsessään olevan hyvin tarkkoja, suurimman epävarmuuden muodostuessa satelliitin todellisen ballistisen kertoimen $B^T$ määrityksestä. Näin ollen virheen kasautumislaista (lähde-esimerkki) ja yhtälöstä (\ref{density_12_eq})
\begin{equation} \label{densErr_eq}
\sigma_{\rho^H} \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)}  v^3 F dt} \frac{\sigma_{B^T}}{(B^T)^2}.
\end{equation}
Kirjoittajan tietojen mukaan tämä on ensimmäinen kerta, kun kaksirivisten elementtien assimilaatiossa otetaan huomioon tiheyden epävarmuus. 

Koska yhtälöiden (\ref{density_12_eq}) antama tiheys vaihtelee useita kertaluokkia läpi termosfäärin ja koska tiheys on pieni suhteessa mallitilan parametreihin, assimiloidaan tässä työssä data malliin logaritmisessa koordinaatistossa. Tällöin tiheyden epävarmuus (yhtälö (\ref{densErr_eq})) saa virheen kasautumislaista muodon:
\begin{equation} \label{densErrLog_eq}
\sigma_{\ln(\rho^H)} = \sigma_{\rho^H} \frac{\partial}{\partial \rho^H} \ln(\rho^H) = \sigma_{\rho^H} / \rho^H.
\end{equation}
Logaritmisen koordinaatiston oletetaan parantavan numeerista vakautta ja siten suotimen tarkkuutta. 

Jokaisella assimilaatiosyklillä havainnoiksi valitaan ne kappaleet, joiden kaksirivisten elementtien epookkien keskiarvo $t_{ik}$ osuu assimilaatioikkunaan (aikaväli, jolta havaintoja assimilaatiota varten kerätään). Koska kaksirivisen elementtidatan aikaresoluutio on noin kolme päivää, vaaditaan tiheyden määrityksessä käytettyjen elementtien epookkien eroksi vähintään kolme päivää. Jotta yhteen assimilaatioon olisi käytettävissä mahdollisimman paljon dataa, ja jotta aikaresoluutio olisi hyvä, myös assimilaatioikkunan pituudeksi valittiin kolme päivää. Aina ennen seuraavaa assimilaatiosykliä asetetaan $t_i = t_k$ eli saman kappaleen tiheyden integrointia jatketaan siitä, mihin edellisen syklin aikana on jääty. Kappaleista kuitenkin hylätään ne, joiden keskiliike on pienentynyt. Lähemmissä tarkasteluissa todettiin, että muihin muuttujiin, kuten $B_i$:hin liittyvää eliminointia ei tarvinnut tehdä, koska kaikki 45 kappaletta oli valittu siten, että ne antavat realistiselta vaikuttavaa tiheysinformaatiota (kun keskiliike kasvaa). 

Malliryppään kooksi valittiin N = 100 mallia, koska merkittävää parannusta assimilaatiojärjestelmän suorituskyvyssä ei suuremmilla ryppäillä havaittu (ei näytetä). Ryppään kovarianssin kuitenkin todettiin pienenevän ja pienenevän kun havaintojen assimilaatiota malliin suoritettiin useita kertoja. Tämä on merkki suotimen konvergenssista (katso edellinen osio) ja järjestelmässämme sitä korjataan pitämällä taustan eksosfäärin lämpötilakorjauksen varianssi vakiona (lähde: ketä mukaillen):
\begin{equation} \label{inflation_eq}
\mathbf{\Delta T_{ex}}_{, korj.} = \sqrt{\frac{s}{\sigma^2_{\mathbf{\Delta T_{ex}}}}} (\mathbf{\Delta T_{ex}} - E(\mathbf{\Delta T_{ex}})) + E(\mathbf{\Delta T_{ex}}),
\end{equation}
missä $\mathbf{\Delta T_{ex}}$ on vektori kaikkien ryppään mallien arvoista, $E(\mathbf{\Delta T_{ex}})$ on vektorin keskimääräinen arvo ja s on haluttu (vakiona pysyvä) varianssi (niin sanottu inflaatioparametri). Paras arvo varianssille löydetään tarkastelemalla havaittujen arvojen sijaintia suhteessa malliryppään vertailuarvoihin. Mikäli kunkin havainnon kohdalla havainto ja malliryppään N vastinetta asetetaan kasvavaan järjestykseen, havainnon sijaintia suhteessa ryppääseen kuvaa havaintoarvon järjestysluku $k$ (lähde: heikin dyn IV). Mikäli $k = 1$, havainto on pienempi kuin yksikään ryppään arvioista ja jos $k = N + 1$, kaikki ryppään vastineet ovat havaintoa pienempiä. Sitävastoin välillä $1 < k < N+1$ havainto osuu ryppään sisään. Laadukkaassa (ja harhattomassa) ennustusjärjestelmässä järjestysluku $k$ onkin tasaisesti jakautunut satunnaismuuttuja, sillä äärellisen otoksen luonteen johdosta havainto voi sijaita myös ryppään ulkopuolella. Assimiloimalla malliin vuosien 2002 ja 2004 havaintoja ja piirtämällä mallin taustaryppään avulla laskettujen järjestyslukujen histogrammeja, valittiin inflaatioparametrin sopivaksi arvoksi $s= 25~\mathrm{K}^2$. Lopullinen järjestyslukujen histogrammin on esitetty Kuvassa \ref{fig:rank}; rypäs on hieman yli-dispersiivinen (havainto osuu useammin lähelle ryppään keskusta kuin sen ulkopuolelle), mutta tämän tutkielman tarkoituksiin riittävän hyvin kalibroitu. 

\begin{figure}[t]
\centering
\includegraphics[scale = 0.6]{gradu_jarjestys}
\caption{Mallin taustasta laskettujen havaintojen järjestyslukujen jakauma vuosina 2002 ja 2004 yhtälön (\ref{inflation_eq}) inflaatioparametrin arvolla $s = 25~\mathrm{K}^2$.}
\label{fig:rank}
\end{figure}

%%% Oma teksti ennen tätä.

%\bibliography{gradu}
%\bibliographystyle{unsrtnat}
%\nocite{*}
\printbibliography


%\bibliography{gradu}  % viittaa tiedostoon gradu.bib

\end{document}
