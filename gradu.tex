\nonstopmode
% \batchmode jos et halua nähdä
\documentclass[12pt,a4paper,finnish,margin=2in]{article}
\usepackage[margin = 1.75in,bottom=1in,top=1.25in]{geometry}
\linespread{1.2}

\usepackage{fixltx2e}
\usepackage{amsmath}
\usepackage{url}
\usepackage{graphicx}
\usepackage{pgfplotstable}
%\usepackage{lineno}
%\linenumbers

%%% Tämä on tämän tiedoston versio ajanhetkenä 2008-02-13.
%%% Säätäjä-ässän on hyvä muistaa päivittää myös päiväys.

\usepackage[round,authoryear]{natbib}
%\usepackage[
%backend=biber,
%style=authoryear,
%citestyle=apa,
%sorting=nyt,
%natbib=true
%]{biblatex}
%\addbibresource{gradu.bib}
%\bibpunct{(}{)}{;}{a}{,}{,}

\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[finnish]{babel}

% \usepackage{graphicx}
% tai \usepackage{graphics}
% kuvatiedostojen liittämiseksi
\begin{document}

\parskip 2mm
\parindent 0mm

\tableofcontents

\pagebreak

%%% Oma teksti tämän jälkeen.
%%% Tyhjä rivi kappalten väliin.
%%% LaTeX varaa mm. merkit & $ & % \ { } [ ] omiin tarkoituksiinsa.

\section{Johdanto}

Termosfääri on planeettamme ilmakehän ainoa lähiavaruuteen saakka ulottuva kerros [\textit{yksinkertaisuuden vuoksi tässä työssä termosfääri sisältää käsitteenä myös eksosfäärin}]. Tieteellisen mielenkiinnon lisäksi termosfäärin käyttäytymisen parempi ymmärtäminen on tärkeää suunniteltaessa ja toteutettaessa lähiavaruuden satelliittitoimintaa, sillä termosfääristä aiheutuva ilmanvastusvoima on suurin virhelähde ennustettaessa matalla kiertävien satelliittien sijaintia \citep{Doornbos_2007}. 

Termosfäärin ymmärtämiseksi on laadittu useita virtaus- ja elektrodynamiikan yhtälöt ratkaisevia fysikaalisia malleja \citep[esim.][]{richmond_1992, ridley_2006}. Rakenteeltaan mallit muistuttavat alailmakehässä käytettäviä sää- ja ilmastomalleja, mutta vaikka ne ovat merkittävästi lisänneet tietoa yläilmakehän fysiikasta, eivät niillä laskettavat ennusteet kovinkaan hyvin vastaa termosfääristä tehtäviä havaintoja \citep{Shim_2014}. Tämän vuoksi satelliittien ratalaskelmissa ei fysikaalisia malleja juurikaan käytetä, vaan niiden tilalla hyödynnetään puoli-empiirisiä menetelmiä, jotka kuvaavat termosfäärin keskimääräistä lämpötila- ja tiheysjakaumaa.

Vaikka puoli-empiiriset mallit tuottavat fysikaalisia malleja tarkemman arvion yläilmakehän satelliitteihin kohdistamasta ilmanvastuksesta, liittyy niidenkin käyttöön suuria virheitä. Termosfäärin todellinen tila ja empiirisen mallin tuottama keskimääräinen tila poikkevat käytännässä aina toisistaan. Niin fysikaalisten kuin empiiristen mallien virheitä on yritetty pienentää korjaamalla mallin (alku)tilaa sellaiseksi, että se vastaa paremmin havaintoja \citep[esim.][]{matsuo_2012,doornbos_2008,storz_2005,chartier_2016}. Tämän niin kutsutun data-assimilaation avulla mallien ja havaintojen välistä virhettä on etenkin lyhyillä ennustusajoilla saatu merkittävästi pienennettyä. On kuitenkin epäselvää, kuinka paljon ennusteita voidaan parantaa alkutilan paremmalla määrityksellä. 

Toisin kuin alailmakehässä, termosfääristä tehtävien ennusteiden epävarmuus liittyy hyvin paljon epävarmuuteen termosfäärin tilaa muuttavissa pakotteissa \citep{mannucci_2016}. Yläilmakehän tärkein energianlähde on auringosta tuleva lyhytaaltoinen E- ja FUV-säteily, jonka säteilyteho voi vaihdella sadoilla prosenteilla minuuttien ja tuntien aikaskaalassa \citep[esim.][]{Tsurutani_2005}. Lisäksi tämä voimakas säteily ionisoi osan termosfäärin kaasusta muodostaen alueelle niin kutsutun ionosfäärin, jonka liike sähkö- ja magneettikenttien mukaan vaikuttaa myös neutraalin kaasun virtaukseen. Tästä aiheutuvan ionosfääri-termosfääri -kytkennän ja auringon lyhytaaltoisen säteilyn muutokset ovat vaikeasti ennustettavissa, ja voivat vaikuttaa termosfäärin massatiheyteen kymmenillä tai jopa sadoilla prosenteilla \citep[esim.][]{emmert_2015}. Etenkin suurimmat pakotteiden muutokset ajavat termosfääriä niin voimakkaasti, ettei alkutilalla ole juurikaan merkitystä sen kannalta, mihin tilaan järjestelmä lopulta päätyy \citep{mannucci_2016}. Näin ollen tilanteissa, joissa pakotteen aikakehitykseen liittyy hyvin suuri epävarmuus, ei alkutilan tarkkakaan määritys auta tuottamaan laadukkaita ennusteita yläilmakehän tilasta \citep{chen_2016}.

Tästä syystä tutkielmassa keskitytään tarkastelemaan data-assimilaation suorituskykyä aikana, jolloin termosfääriin kohdistuu voimakkaita ajan suhteen muuttuvia pakotteita (geomagneettinen ja auringon aktiivisuus ovat suuria). Tällöin data-assimilaation tuoman parannuksen oletetaan olevan pienimmillään, sillä pakotteet muuttavat ilmakehän tilaa nopeasti. Data-assimilaation ennustusmallina käytetään Ilmatieteen laitoksella kehitettyä uutta puoli-empiiristä Iipponen-Laitinen -mallia (IL). Malliin assimiloitavana havaintoaineistona hyädynnetään Pohjois-Amerikan ilmapuolustuskomentokeskuksen (NORAD) niin sanottuja kaksirivisiä elementtejä, jotka kuvaavat ilmanvastuksen vaikutuksia maata kiertävien kappaleiden kiertoratoihin \citep[esim.][]{picone_2005}. 

Vaikka kaksirivisiä elementtejä on aiemminkin käytetty puoli-empiiristen yläilmakehämallien korjaukseen\citep[esim.][]{Doornbos_2007, doornbos_2008}, aiemmista tutkimuksista poiketen tässä työssä data-assimilaatio suoritetaan ensemble Kalman -suotimen (englanniksi \textit{Ensemble Kalman Filter}, EnKF) \citep{evensen_1994, evensen_2003} avulla. Menettely poikkeaa Doornbosin (2007) menetelmästä siinä, miten se käsittelee mallin ennustetta muodostaessaan analyysiä yläilmakehän todennäkäisimmästä tilasta. Aiemmin todennäköisimmän tilan arvio on määritetty ainoastaan interpoloimalla havaintoaineistoa, mutta yhdistämällä mallin ennusteen ja havainnot EnKF kykenee tuottamaan arvion yläilmakehän tilasta, joka todennäköisimmin vastaa järjestelmän todellista tilaa. Lisäksi ensemble Kalman -suotimella on kyky tuottaa arvio termosfäärin tilan todennäköisyysjakaumasta.

Data-assimilaatiojärjestelmän avulla tutkitaan kahta keskeistä tutkimuskysymystä:
\begin{enumerate}
\item Tarkentaako EnKF:n avulla tuotettu ilmakehän analyysi IL-mallin kuvausta keski- ja ylätermosfäärin massatiheydestä?
\item Tarkentaako analyysi kolmen päivän ennusteita yläilmakehän tilasta, mikäli pakotetekijäiden aikakehitys tunnetaan tarkkaan?
\end{enumerate}

Keskeisin yksittäinen parametri arvioitaessa yläilmakehämallien suorituskykyä on tiheysennusteiden ja -havaintojen välinen neliöllinen keskivirhe \citep[k.s. esim.][s. 359]{wilks_2011}, sillä se kuvaa hyvin satelliitin kiertoradan ennustuksessa tehtävää etäisyysvirhettä \citep{bruinsma_2012}. Tässä työssä sitä käytetään arvioimaan, tarkentaako data-assimilaatio yläilmakehän tiheydestä tehtäviä arvioita verrattuna IL-malliin, jota ajetaan havaituilla pakotteilla ja johon dataa ei ole koskaan assimiloitu. Tutkimusajankohtana käytetään vuotta 2003, sillä tällöin yläilmakehään vaikuttavat pakotetekijät olivat suuria ja nopeasti vaihtelevia. Järjestelmän suorituskyvyn arvioinnissa hyädynnetään aina havaintoja, joita analyysin tuottamiseen ei ole käytetty.

Työn kolmessa ensimmäisessä luvussa annetaan tulosten ja johtopäätösten ymmärtämiseksi tarvittavat tiedot IL-mallista, NORAD:n kaksirivielementeistä, sekä ensemble Kalman -suotimesta. Luku 5 esittää data-assimilaation tulokset. Luku 6 esittää tulosten perusteella johtopäätäksiä ja käsittelee työn rajoitteita. Lopuksi Luku 7 tiivistää keskeiset tulokset ja johtopäätökset.

\section{Iipponen-Laitinen -malli}

Jo satelliittiajan alussa, 1960- ja 1970-luvuilla oli tarve kyetä määrittämään ja ennustamaan satelliittien ratoja merkittävällä tarkkuudella. Matalla maan kiertoradalla kiertävät kappaleet, joiden perigeum (kiertoradan maata lähin piste) on alle 500 - 700 km:n korkeudella kokevat termosfäärin kokonaismassatiheydestä aiheutuvan merkittävän ilmanvastusvoiman \citep{king_hele_1987}. Tämän voiman mallintamiseksi alettiin 1960-luvulla kehittämään empiirisiä malleja, jotka havaintojen pohjalta kuvasivat termosfäärin keskimääräistä kolmiulotteista lämpötila- ja massatiheysjakaumaa \citep{jacchia_1965,hedin_1974}. Näiden mallien kehittäminen oli laskennallisesti yksinkertaisempaa ja nopeampaa kuin sähkö- ja virtausdynamiikan yhtälät ratkaisevien mallien kehitys, joten niistä tuli nopeasti kiertoratamallinnuksen standardityökaluja.

Pääasiallinen fysikaalisten mallien hyödyllisyyttä rajoittava tekijä on tarve läytää malleille kolmiulotteinen alkutila, jota ilman mallit eivät voi antaa luotettavia ennusteita (heikosti pakotettuina aikoina). Tällaisen alkutilan löytämistä rajoittaa merkittävästi se, että neutraalista yläilmakehästä on saatavilla hyvin vähän reaaliaikaista (korkearesoluutioista) havaintoaineistoa \citep{emmert_2015}. Empiirisissä malleissa tämä ongelma kierretään etsimällä analyyttinen, epälineaarinen funktiosovitus, joka parhaiten kuvaa kymmenien vuosien historiallista havaintoaineistoa. 

Ilmatieteen laitoksella on aiemman tutkimuksen \citep{iipponen_2015} pohjalta kehitetty uudistettua empiiristä yläilmakehämallia, jonka tarkoituksena on keskittyä geomagneettisten myrskyjen ilmakehävaikutusten parempaan arviointiin. Kuten aiemmat yläilmakehämallit (esimerkiksi MSIS \citep{picone_2002} ja DTM \citep{bruinsma_2015}), IL-malli kuvaa hydrostaattisessa tasapainossa olevaa ilmakehää:
\begin{equation} \label{hydrostatic_eq}
dp = -\rho g_0 dZ,
\end{equation}
missä \textit{p} on ilmanpaine, $\rho$ on tiheys, \textit{Z} on geopotentiaalikorkeus ja \textit{g}\textsubscript{0} on putoamiskiihtyvyys mallin alarajalla 130 km:n korkeudella. Alailmakehästä poiketen turbulenttinen sekoittuminen on pienen tiheyden takia termosfäärissä hyvin pientä suhteessa molekulaariseen diffuusioon \citep{emmert_2015}. Tällöin raskaat kaasulajit (N\textsubscript{2} ja O\textsubscript{2}) kerääntyvät alatermosfääriin (alle 200 km korkeudelle) ja kevyemmät (He ja O) termosfäärin ylempiin osiin (ks. Kuva \ref{fig:emmert_tiheys}). 
\begin{figure}[t]
\centering
\includegraphics[scale = 0.4]{emmert_tiheys}
\caption{Termosfäärin tärkeimpien kaasulajien lukumäärätiheyksien globaalit keskiarvot korkeuden funktiona auringon maksimin aikaan. \citet{emmert_2015} Kuva 2(a).}
\label{fig:emmert_tiheys}
\end{figure}
Näin ollen keskimääräisen molekyylimassan muutokset on yhtälöä (\ref{hydrostatic_eq}) integroitaessa otettava huomioon. Kun siihen sijoitetaan ideaalikaasun tilanyhtälö
\begin{equation} \label{ideal_eq}
p = \rho \frac{R}{m} T,
\end{equation}
(missä $m$ on kaasun keskimääräinen molaarimassa, $T$ on absoluuttinen lämpötila ja $R$ = 8.314 J / K / mol on kaasuvakio), saadaan hydrostaattinen yhtälö muotoon:
\begin{align} \label{hydrostatic_log_eq}
\frac{-R}{\rho}~d \left ( \rho \frac{T}{m} \right ) = -R~\frac{T}{m} d(\ln \rho) - R~d \left ( \frac{T}{m} \right ) = g_0 dZ \nonumber \\
\Rightarrow  d(\ln \rho) = - d \left ( \ln \frac{T}{m} \right ) - \frac{g_0 m}{R T} dZ
\end{align}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.6]{gradu_lampotila}
\caption{IL-mallin kuvaus termosfäärin lämpötilaprofiilista Helsingin yläpuolella kesäpäivänseisauksena matalan auringon- ja geomagneettisen aktiivisuuden aikaan kello 12. Kuvassa havainnollistettuna myös mallin alareunaehdot, 130 km:n lämpötila $T_0$ ja sen gradientti $T'$, sekä yläreunaehto, eksosfäärin lämpötila $T_{ex}$.}
\label{fig:lampotila}
\end{figure}

Yhtälön \ref{ideal_log_eq} integroiminen vaatii oletuksen yläilmakehän lämpötilaprofiilista. IL-mallissa hyödynnetään Walkerin (1965) esittämää empiiristä funktiota:
\begin{equation} \label{bates_eq}
T(Z) = T_{ex} - (T_{ex} - T_0) e^{- \frac{T'}{T_{ex} - T_0} (Z-Z_0)},
\end{equation}
missä $T_ex$ kuvaa lämpötilaa äärettömän korkealla (eksosfäärissä); $T_0$ on lämpötila ja $T' = dT/dZ$ on lämpötilan pystysuuntainen gradientti mallin alarajalla 130 km:n korkeudella (ks. Kuva \ref{fig:lampotila}). Lisäksi hydrostaattisen yhtälön integroinnissa oletetaan, että yläilmakehä on diffusiivisessa tasapainossa; termosfäärin voidaan ajatella koostuvan useasta yksikaasuisesta osailmakehästä, joiden massatiheyksien summa antaa ilmakehän kokonaismassatiheyden missä tahansa termosfäärin pisteessä. Tällöin yhtälö \ref{hydrostatic_log_eq} voidaan integroida jokaiselle kaasulajille erikseen, jolloin lajille $i$ saadaan massatiheyttä kuvaava yhtälö:
\begin{equation} \label{species_dens_eq}
\rho_i (Z) = \rho_i (Z_0)~(T_0 / T(Z))^{1+\gamma_i+\alpha}~e^{-\sigma \gamma_i (Z-Z_0)},
\end{equation}
missä:

$Z$: geopotentiaalikorkeus $Z = (R_E + z_0)(z-z_0)/(R_E + z)$,

$z$: geometrinen (todellinen) korkeus,

$z_0$: alareunan korkeus $z_0 = 130$ km,

$R_E$: maan napasäde $R_E = 6356.77$ km,

$\gamma_i = m_i g_0/(\sigma~R~T_{ex})$,

$\sigma = T' / (T_{ex} - T_0)$

$\alpha$: lämpötiladiffuusiokorjauskerroin (Heliumille -0.38, muille mallin kaasuille 0). Heliumin tiheys pienenee korkeuden funktiona hieman hitaammin kuin hydrostaattinen tasapaino edellyttää.

Yhtälön (\ref{species_dens_eq}) mukaan mallin alarajalla on siis lämpätilojen lisäksi määritettävä kunkin kaasulajin massatiheys. Puoli-empiirisissä termosfäärimalleissa tämä tehdään geofysikaalisen funktion $G_i(L)$ avulla, joka esittää muutoksen alarajan massatiheydessä geofysikaalisen tilan $L$ funktiona:
\begin{equation} \label{lb_eq}
\rho_i(Z_0) = \overline{\rho_i(Z_0)}~\exp(G_i(L)).
\end{equation}

Geofysikaalinen tila $L$ kuvaa IL-mallissa havaintopisteen sijaintia (leveys- ja pituuspiiri, aurinkoaika), havaintoaikaa (vuodenpäivä), sekä auringon- ja geomagneettista aktiivisuutta. Auringon aktiivisuus on parametrisoitu auringon 30 cm radiovuon (F30) edellisen päivän ja 81:n päivän keskiarvojen avulla, sillä yksittäisistä auringon aktiivisuusindekseistä tämä parhaiten kuvaa auringon UV-säteilyä niillä aallonpituusalueilla, jotka termosfääriä lämmittävät \citep{bruinsma_2017}. Geomageettisesti aktiivisina aikoina yläilmakehän varattujen ja neutraalien hiukkasten törmäykset lämmittävät ja sekoittavat termosfääriä, mikä muuttaa ilmakehän tiheysrakennetta \citep[esim.][]{prolss_2011}. IL-mallissa vaikutuksen parametrisoinnissa käytetään pohjoisen revontuliovaalin alueen magnetometrimittauksista johdettavaa AE-indeksiä, jonka oletetaan olevan verrannollinen termosfääriä lämmittävän sähkävirran ja hiukkaspresipitaation suuruuteen \citep{iipponen_2015}.

Lopulta skalaariarvoinen funktio $G$ kuvaa parametrivektorin $L$ suhteellisiksi tiheysmuutoksiksi logaritmisessa avaruudessa. $G$ on määritelty pallon pinnalla, joten sen lausekkeessa on käytetty apuna palloharmonisia funktiota astelukuun ($\sim$meridionaalinen aaltoluku) 6 ja kertalukuun (zonaalinen aaltoluku) 4 saakka. $G_i$ on ominainen kullekin kaasulajille, mutta funktionaalinen muoto on täysin sama; $G$ sisältää 142 vapaata parametriä, jotka saavat eri arvoja riippuen siitä, mikä kaasu on kyseessä. Vastaavalla tavalla määritellään myös lämpötilojen muutos geofysikaalisen tilan L funktiona:
\begin{equation} \label{lb_eq}
T_j = \overline{T_j} (1 + G_j(L)).
\end{equation}

Yhteensä noin kuudensadan malliparametrin sovittamiseksi tarvitaan historiallisia havaintoja termosfäärin tiheyksistä ja lämpötiloista. IL-mallin tärkein tietolähde ovat 2000-luvulla tehdyt kokonaismassatiheysmittaukset, jotka on laskettu GRACE-, CHAMP- \citep[esim.][]{bruinsma_2006} ja GOCE- \citep{bruinsma_2014} painovoimasatelliittien tarkkojen kiihtyvyysanturien avulla. Kaasulajien lukumäärätiheydet perustuvat myös 1970- ja 1980- lukujen satelliittipohjaisiin massaspektrometrimittauksiin \citep[esim.][]{hedin_1974}, mutta suoria satelliittimittauksia on käytetty myös eksosfäärin lämpötilan laskennassa. Alareunan lämpötila on laskettu kolmen epäkoherentin sirontatutkan (Arecibo, Millstone Hill, EISCAT) lämpötilamittauksista. Lisäksi IL-malli on ensimmäinen puoli-empiirinen yläilmakehämalli, joka hyödyntää NASA:n Thermosphere Ionosphere Mesosphere Energetics and Dynamics (TIMED) -satelliitin havaintoja alareunan lämpötilagradientista \citep{zhang_2006} ja UV-kanavalla tehtyjä luotauksia hapen ja typen korkeusprofiileista \citep{meier_2015}. 

Paramterien optimaaliset arvot määritetään epälineaariseen optimointiin suunnatulla Levenberg-Marquardt -algoritmilla \citep[esim.][]{more_1978}, joka etsii parametreille pienimmän neliäsumman mielessä parhaat arvot. Algoritmin tuottaman virhekovarianssimatriisin avulla hylätään sellaiset parametrit, joiden absoluuttinen virhe on yli kolmasosa parametrin suuruudesta. Tämän jälkeen sovitus lasketaan uudelleen ainoastaan tilastollisesti merkitseville parametreille. 

\begin{figure}[t]
\includegraphics[scale = 0.65]{gradu_tiheys}
\caption{IL-mallin ennuste yläilmakehän kokonaismassatiheydestä (yksikössä $\mathrm{kg/m^3}$) leveyspiirin ja aurinkoajan funktiona kesäkuussa 400 km:n korkeudella. Keskiarvo pituuspiirien yli.}
\label{fig:tiheys}
\end{figure}

Kuva \ref{fig:tiheys} esittää IL-mallin kuvausta termosfäärin massatiheydestä kesäkuussa 400 km:n korkeudella. Suurimmat massatiheydet läytyvät pohjoiselta pallonpuoliskolta (koska säteilylämmitys ja keskimääräinen molekyylimassa ovat siellä suuria) ja hieman keskipäivän jälkeen auringon lämmitettyö ilmakehää. Pienin massatiheys saavutetaan aamuyöllä noin kello neljä. Yksinkertaisuudestaan huolimatta IL-mallin tiheysennusteet vastaavat GOCE, CHAMP ja GRACE -satelliittien kiertoratakeskiarvoistettuja massatiheyshavaintoja noin 24\%:n neliöllisen keskiarvon virheellä (ei näytetä). 

\section{Kaksiriviset elementit -- termosfäärin massatiheyshavainnot}
\subsection{Tiheyden määrittäminen}

Pohjois-Amerikan ilmapuolustuskeskuksen (NORAD) tehtävänä on kerätä tietoa maata kiertävistä keinotekoisista satelliiteista. Merkittävä osa NORAD:n havaintoaineistosta on julkisesti saatavilla ja nykyään (toukokuu 2017) aineisto kattaa tiedot yli 40000:n satelliitin kiertoratojen muutoksista \citep{spacetrack}. Poikkeamia maata kiertävien satelliittien ratoihin aiheuttavat; (1) maan painovoimakenttä ja sen epähomogeenisuus, (2) ilmakehän ilmanvastusvoima, (3) kolmannen kappaleen, kuten Kuun tai Auringon painovoima, sekä (4) säteilypaine sähkömagneettisesta säteilystä \citep[ks. esim.][s. 326]{roy_2004}. Kappaleen kiertoradan aikakehitys kuvaa kaikkien näiden poikkeuttavien voimien satelliittiin kohdistamaa yhteisvaikutusta, mutta tietyissä erikoistilanteissa näiden voimien vaikutukset on mahdollista erotella toisistaan. 

Tässä työssä keskitytään tarkastelemaan kappaleita, joiden kiertoradan maata lähin piste (perigeum) on alle 550 km:n korkeudella ja joiden kiertoaika on alle 225 minuuttia. Tarkasteluvuonna 2003 auringon korkea aktiivisuus (voimakas UV-säteily) oli kasvattanut ilmakehän skaalauskorkeutta siten, että tällaisilla kiertoradoilla olevien kappaleiden ilmanvastusvoima on todennäkäisesti suurempi kuin säteilypaineen vaikutus \citep{picone_2005}. Lisäksi näin lyhyen jakson kiertorataan Kuun ja Auringon painovoimakenttien aiheuttamat poikkemat ovat pieniä ja voidaan jättää huomiotta \citep{hoots_1980}. 

Näin ollen riittää tarkastella ainoastaan maapallon epähomogeenisen painovoimakentän ja ilmanvastuksen aiheuttamia muutoksia. Termosfäärin massatiheydestä, satelliitin muodosta ja nopeudesta riippuva ilmanvastusvoima voidaan lausua \citep[esim.][luku 8.6.2]{vallado_2001}:
\begin{equation} \label{airdrag_eq}
\mathbf{\dot{v}_D} = - \frac{1}{2} \rho B \left | \mathbf{v} - \mathbf{V} \right |^2 \mathbf{e_{v-V}},
\end{equation}
jossa $\mathbf{\dot{v}_D}$ on ilmanvastuksen aiheuttama kiihtyvyys, \textbf{v} on kappaleen ja \textbf{V} tuulen nopeus maakeskisessä inertiaalikoordinaatistossa, $\mathbf{e_{v-V}}$ on ilmakehän suhteen olevan nopeuden suuntainen yksikkövektori, $\rho$ on ilmakehän massatiheys ja ballistinen kerroin:
\begin{equation} \label{ballistic_eq}
B = \frac{C_D A}{m},
\end{equation}
missä $C_D$ on kappaleen ilmanvastuskerroin, $A$ on nopeutta vastaan kohtisuora pinta-ala ja $m$ on massa. Edellä esitellyistä ilmanvastukseen vaikuttavista tekijäistä ainoastaan massa säilyy vakiona yhden (tai useamman) kiertoratakierroksen ajan, mikäli satelliitti ei menetä polttoainetta tai rakenneosasiaan (esimerkiksi kiertoratakorjauksen tai tärmäyksen seurauksena). Nopeus ja ilmakehän tiheys vaihtelevat eniten, mutta myös kerroin $C_D$ riippuu heikosti ilmakehän kaasukoostumuksesta \citep{moe_2006}. Nopeutta vastaan kohtisuora ala A taas riippuu tuulennopeudesta ja satelliitin mahdollisesta pyärimisestä. 

\begin{figure}[t]
\ttfamily
\scriptsize
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17124.83855883 +.00002555 +00000-0 +46104-4 0  9999

2 25544 051.6415 254.3711 0005715 124.5522 336.3551 \underline{15.53964796055018}
\noindent\rule[0.5ex]{\linewidth}{1pt}
1 25544U 98067A   17125.21849080 +.00002605 +00000-0 +46858-4 0  9996

2 25544 051.6415 252.4770 0005705 125.9198 301.8433 \underline{15.53967431055076}
\noindent\rule[0.5ex]{\linewidth}{1pt}

1 25544U 98067A   17125.47998944 +.00002778 +00000-0 +49476-4 0  9998

2 25544 051.6417 251.1751 0005804 127.0105 324.6272 \underline{15.53970335055110}
\noindent\rule[0.5ex]{\linewidth}{1pt}
\rmfamily
\caption{Kolme esimerkkiä kansainvälisen avaruusaseman (ISS) kaksirivisestä elementtidatasta vuonna  2017. Vanhin havainto ylimpänä. Keskiliike (kierrosta päivässä) on alleviivattu.}
\label{fig:tle}
\end{figure}

Kuva \ref{fig:tle} esittää kolme esimerkkiä NORAD:n tutkadatasta vuoden 2017 toukokuulta, joiden avulla kiertoradan aikakehitys voidaan määrittää. Kaksirivisen jakeluformaattinsa vuoksi havaintoaineistoa kutsutaan kaksiriviseksi elementtidataksi. Ensimmäinen rivi antaa kappaleen tunnisteen (NORAD ID, esimerkiksi 25544 kansainväliselle avaruusasemalle), havaintoajan (esimerkiksi 17124 vuoden 2017 päivälle 124), sekä tietoja kiertoradan muutoksista \citep{spacetrack}. Toinen rivi antaa kuusi rataparametriä, jotka määräävät tarkalleen kappaleen keskimääräisen kiertoradan tietyn ajanjakson yli. Järjestyksessä vasemmalta oikealle: (1) inklinaatio (esimerkiksi 051.6415) ja (2) nousevan noodin rektaskensio (254.3711) asteina, (3) Eksentrisyyden desimaaliosa (0005715), (4) perigeumin argumentti (124.5522) ja (5) keskianomalia (336.3551) asteina, sekä (6) keskiliike kierroksina päivässä (15.53964). Kyseessä ei kuitenkaan ole yksittäinen havainto kappaleen kiertoradasta, vaan kaikki toisen rivin rataparametrit ovat keskiarvoja useiden havaintojen ja päivien yli. Keskiarvostuksen tarkka aikaikkuna ei ole julkista tietoa, mutta \citet{picone_2005} esittää sen olevan nykyään noin kolme päivää matalan maan kiertoradan satelliiteille. 

NORAD:n käyttämässä sovitus- ja keskiarvoistusmenetelmässä kappaleen paikasta (ja joskus myös nopeudesta) tehtäviin tutkahavaintoihin sovitetaan tietty analyyttinen kiertoratamalli vaihtelemalla kaksirivisten elementtien arvoja siten, että mallin tulos vastaa mahdollisimman hyvin kappaleen havaittua kiertorataa \citep{hoots_1980}. Tämä analyyttinen malli, Simplified General Perturbation-4 (SGP4) \citep{lane_1979} sisältää yksinkertaisen kuvauksen mapallon painovoimakentästä ja sen epähomogeenisuudesta, minkä ansiosta keskiarvoistus poistaa epähomogeenisuuden aiheuttamat lyhytjaksoiset vaihtelut satelliitin kiertoradassa \citep{picone_2005}. 

Termosfäärin aiheuttaman ilmanvastusvoiman johdosta satelliitti menettää kiertoratakorkeuttaan, sen radan eksentrisyys pienentyy ja  kiertonopeus kasvaa \citep{king_hele_1987}. Ilmanvastuksen määrittämiseksi on siis käytännällistä hyödyntää kaksirivisen elementtidatan ilmoittamaa kiertoradan kulmanopeutta (keskiliike), josta maan painovoiman vaikutus on jo valmiiksi poistettu. Tällöin siinä tapahtuvat muutokset aiheutuvat pääasiassa ilmakehän vaikutuksesta. Kuva \ref{fig:tle} antaa tästä esimerkin; kansainvälisen avaruusaseman kiertonopeus (alleviivattu) näyttää selvästi kasvavan ajan funktiona. Tässä tutkielmassa hyödynnetään Piconen (2005) menetelmää, joka kytkee kvantitatiivisesti yhteen muutokset kiertonopeudessa ja ilmakehän tiheydessä. Piconen (2005) mukaan yhtälö \ref{airdrag_eq} voidaan esittää hetkellisen keskiliikkeen $n_M$ avulla muodossa:
\begin{equation} \label{meanmotion_eq}
\frac{d}{dt} n_M \cong \frac{3}{2} n_M^{1/3} \mu^{-2/3} \rho B v^3 F,
\end{equation}
missä $\mu$ on maapallon gravitaatioparametri (gravitaatiovakion ja Maan massan tulo) 3,986 $\cdot 10^{14}~ \mathrm{m^3 s^{-2}}$ ja $\rho$, $B$, sekä $v$ ovat hetkellisiä arvoja tietyssä kiertoradan pisteessä. Tuulenvoimakkuusparametri F on dimensioton parametri, joka kuvaa tuulennopeuden vaikutusta kappaleen kokemaan ilmanvastusvoimaan:
\begin{equation} \label{F_eq}
F = \frac{\left | \mathbf{v} - \mathbf{V} \right |^2}{v^2} \mathbf{e_{v-V}} \cdot \mathbf{e_{v}}.
\end{equation}
Mikäli oletetaan maapallon mukana pyärivä virtaukseton ilmakehä, hyvä approksimaatio on \citep{king_hele_1987}:
\begin{equation} \label{F_approx_eq}
F \cong \left ( 1 - \frac{r~\Omega_E}{v} \cos(i) \right )^2,
\end{equation}
missä $\Omega_E$ on maapallon pyärimisen kulmanopeus $7.292 \cdot 10^{-5} ~\mathrm{s^{-1}}$, $i$ on satelliitin inklinaatio ja $r$ on etäisyys maapallon keskustasta. Approksimaation virhe on termosfäärin empiirisillä tuulimalleilla laskettuun yhtälöön (\ref{F_eq}) nähden alle 3\%:a ja virhe on vielä pienempi kun yhtälöä (\ref{meanmotion_eq}) integroidaan useiden päivien yli. 

Yhtälön (\ref{meanmotion_eq}) integrointi on mahdollista kahden eri kaksirivisen elementin välillä \citep{picone_2005}:
\begin{equation} \label{int_meanmotion_eq}
\Delta_{ik}n_M \cong \frac{3}{2} \mu^{-2/3} \oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt,
\end{equation}
missä $\Delta_{ik} n_M$ kuvaa keskiliikkeen diskreettiä muutosta kahden elementin välillä ja viivaintegraali tarkoittaa integrointia useiden ratakierrosten yli ajanhetkien $t_i$ ja $t_k$ välillä. Keskiliikkeen muutos selviää suoraan kaksirivisten elementtien keskiarvoistetussa keskiliikkeessä havaitusta muutoksesta. Sen sijaan integrointiin tarvitaan välttämättä samaa SGP4-mallia, jota kaksirivisen elementtidatan keskiarvoistuksessa on käytetty, koska vain sen avulla keskiarvoistettu kiertorata on mahdollista muuttaa tutkien havaitsemaksi, ajassa muuttuvaksi kiertoradaksi \citep{hoots_1980}. Jos integroinnissa käytettäisiin jotain muuta mallia, eivät kaksisiriviset elementtidatat enää antaisi lähellä tutkahavaintoja olevaa kuvausta kappaleen kiertoradasta. Valitettavasti SGP4-mallin nykyinen lähdekoodi ei kuitenkaan ole julkinen. Viimeisin virallinen julkaisu on 1980-luvulta \citep{hoots_1980}, mutta vähäisiä myöhemmin julkaistuja korjauksia ja takaisinmallinnusta käyttäen siviilitutkijat \citet{vallado_2006} ovat laatineet mallista version, joka heidän mukaansa vastaa tarkasti nykyistä kaksirivisten elementtien määrityksessä käytettyä mallia. Tästä eteenpäin SGP4-mallilla tarkoitetaan aina tätä julkista versiota.

Koska SGP4 antaa ainoastaan satelliitin inertiaalikoordinaatiston nopeuden ja paikan, ei yhtälön (\ref{int_meanmotion_eq}) integrointia voi sellaisenaan suorittaa. Kuitenkin yhtälöstä (\ref{int_meanmotion_eq}) nähdään, että on olemassa jokin koko integroinnin yli vakiona pysyvä tiheys, joka toteuttaa yhtälön tarkasti:
\begin{equation} \label{density_raw_eq}
\rho^H(t_{ik}) \equiv \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3}}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt} = \frac{\oint_{(t_i,t_k)} n_M^{1/3}\rho B v^3 F dt}{\oint_{(t_i,t_k)} n_M^{1/3} B v^3 F dt},
\end{equation}
missä yläindeksi H tarkoittaa havaittua ja $t_{ik} \equiv (t_i + t_k) / 2$ on ajanhetki, jota tiheyden katsotaan data-assimilaatiossa kuvaavan. Kyseessä on kuitenkin satelliittin kokema "keskimääräinen" tiheys, joka ei kuvaa mitään tiettyä pistettä tai ajanhetkeä, vaan tiheyden vaikutusta useiden ratakierrosten yli. Integrointiin vaikuttaa lisäksi jonkin verran SGP4-mallin sisältämä analyyttinen ilmakehä. Tämän vaikutus on kuitenkin Piconen (2005) mukaan muutaman päivän integroinnin aikana hyvin pieni, koska havaittu tiheys riippuu voimakkaasti kappaleen perigeumin korkeudesta, jonka muutokset ovat ilmakehän skaalauskorkeuteen nähden merkityksettämiä. Käytännössä voidaan siis sanoa, että yhtälön (\ref{density_raw_eq}) arvio on täysin riippumaton mistään yläilmakehämallista, mikä mahdollistaa kaksirivisten elementtien käytön mallista riippumattomana, todellista ilmakehän tilaa kuvaavana havaintoaineistona.

Olettamalla ballistinen kerroin vakioksi ja arvioimalla keskiliikkeen suuruutta kahden kaksirivisen elementin keskiliikkeiden keskiarvolla $n_M(t_{ik})$ päädytään yhtälöön, jonka integraalitermi voidaan SGP4:n avulla laskea:
\begin{equation} \label{density_12_eq}
\rho^H(t_{ik}) \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{B^T \oint_{(t_i,t_k)}  v^3 F dt}  \cong \frac{\oint_{(t_i,t_k)} \rho^T v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt} \equiv \rho^T(t_{ik}),
\end{equation}
missä yläindeksi T viittaa "todelliseen" (ballistisen kertoimen määritys käsitellään seuraavassa osiossa). Vastaavasti läydetään ekvivalentti mallitiheys, johon kaksirivisen elementtidatan avulla laskettua tiheyttä voidaan verrata:
\begin{equation} \label{density_13_eq}
\rho^M(t_{ik}) \equiv \frac{\oint_{(t_i,t_k)} \rho^M v^3 F dt}{\oint_{(t_i,t_k)}  v^3 F dt},
\end{equation}
missä yläindeksi M viittaa yläilmakehän tiheysmalliin (tässä työssä IL).

Käytännässä yläilmakehän tiheyden määritys kaksirivisen elementtidatan avulla pitää sisällään seuraavat vaiheet:
\begin{enumerate}
\item Valitaan kappale, jonka kiertoradalla ilmanvastusvoima on suuri säteilypaineeseen ja kolmannen kappaleen voimiin verrattuna.
\item Ladataan internetistä \citep{spacetrack} kappaleen kaksiriviset elementit riittävän pitkältä ajanjaksolta.
\item Arvioidaan kappaleen todellinen ballistinen kerroin $B^T$ (katso seuraava osio), mikäli sitä ei ole aiemmin tehty.
\item Valitaan kaksi kaksirivistä elementtiä, joiden epookkien $t_i$ ja $t_k$ välillä massatiheys määritetään. 
\item Lasketaan satelliitin paikka ja nopeus SGP4-mallin avulla hyvin tiheästi (tässä työssä kerran puolessa minuutissa) kahden epookin välillä.
\item Lasketaan tuuliparametri F yhtälöstä (\ref{F_eq}) tai (\ref{F_approx_eq}) ja integroidaan yhtälön (\ref{density_12_eq}) viivaintegraali numeerisesti (tässä työssä puolisuunnikassäännöllä \citep[ks. esim.][s. 158]{press_2007}).
\item Määritetään keskiliikkeen muutokset kahden kaksirivisen elementin avulla ja arvioidaan ilmakehän keskimääräinen tiheys yhtälöstä (\ref{density_12_eq}).
\end{enumerate}

\subsection{Kappaleiden valinta ja ballistisen kertoimen määritys}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.25]{Explorer_8}
\caption{Explorer 8 -satelliitti (NORAD ID 60), jota käytetään yläilmakehän tiheyden määrityksessä \citep{wikimedia}. Muodoltaan satelliitti muistuttaa kaksoiskartiota; kappaleen nopeusvektori avaruudessa osoittaisi kuvan tapauksessa lähes suoraan yläspäin.}
\label{fig:explorer8}
\end{figure}

Kuten aiemmassa osiossa todetiin, termosfäärin massatiheys voi aiheuttaa aiheuttaa havaittavia poikkeamia matalalla kiertoradalla olevien kappaleiden ratoihin. Koska työn tavoitteena on tuottaa kolmiulotteinen korjaus IL-mallin termosfäärin tiheysennusteeseen, tarvitaan data-assimilaatioon kymmeniä eri kappaleita, jotka kiertävätt eri korkeuksilla, aurinkoajoilla ja leveyspiireillä. Käytännässä on kuitenkin hyvin vaikeaa valita useiden tuhansien satelliittien joukosta ne, joita termosfääritutkimuksissa voidaan käyttää; satelliitti ei saisi olla toimintakuntoinen, sen olisi oltava säännöllisen muotoinen (katso esimerkiksi Kuva \ref{fig:explorer8}) eikä se saisi pyäriä, jotta sen ballistista kerrointa voidaan arvioida vakiona. Tämän työn data-assimilaatiojärjestelmässä käytetyt 45 satelliittia ja kolme riippumatonta arviointisatelliittia on valittu aiempien tutkimusten \citep[esim.][]{emmert_2004,saunders_2011} perusteella. Erityisen tärkeä tietolähde on ollut luettelo Yhdysvaltain ilmavoimien Avaruustaistelulaboratorion (\textit{US Air Force Space Battlelab}) High Accuracy Satellite Drag Model (HASDM)-mallissa käytetyistä 80:sta kappaleesta \citep{doornbos_2004}. 

Vaikka aiemmissa tutkimuksissa tiheysanalyysiin sopivia kappaleita on läydetty kymmenittäin, on niiden todellisen ballistisen kertoimen määrittäminen hankalaa \citep{bowman_2002}. Tämä aiheutuu pääasiassa siitä, että ballistinen kerroin riippuu ilmanvastuksesta ja ilmakehän tiheydestä itsestään yhtälön (\ref{density_12_eq}) mukaan:
\begin{equation} \label{Bi_eq}
B_i \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)} \rho^T v^3 F dt},
\end{equation}
missä $B_i$ on keskimääräinen ballistinen kerroin epookkien välillä. Käytännässä tämä tarkoittaa sitä, että kappaleen kiertoratahavainnoista johdettu ballistinen kerroin vaihtelee kaiken aikaa. Kertoimen todellisen arvon määritystä vaikeuttaa vielä se, ettei yhtälössä (\ref{Bi_eq}) tarvittavaa ilmakehän todellista tiheyttä $\rho^T$ tunneta. Tästä syystä usein käytetään todellisen tiheyden tilalla empiirisen termosfäärimallin tiheyttä $\rho^M$ ja todellisen ballistisen kertoimen arvossa käytetään epookkien $B_i$-arvojen keskiarvoa useiden vuosien yli \citep{doornbos_2008}. 

\begin{figure}[t]
\includegraphics[scale = 0.5]{gradu_Bi}
\caption{Ballistisen kertoimen ja tiheyskorkeuden aikasarja Explorer 8 -satelliitille. Kuvassa punaisten viivojen sisäpuolelle jäävää vuotta 2003 ei ole huomioitu ballistisen kertoimen laskennassa, koska sitä käytetään data-assimilaatio-järjestelmän suorituskyvyn arviointiin.}
\label{fig:Btrue}
\end{figure}

Tätä menetelmää käytetään myös tässä tutkielmassa. Kuva \ref{fig:Btrue} esittää Explorer 8 -satelliitin $B_i$-kertoimien aikasarjaa ja sitä korkeutta, jota satelliitin radasta määritetyn massatiheyden voidaan parhaiten katsoa kuvaavan (niin sanottu tiheyskorkeus eli tekijällä $\rho^M v^3 F$ painotettu keskiarvo geometrisestä kiertoratakorkeudesta). Data-assimilaatiojärjestelmän toimivuutta testataan vuoden 2003 datalla, joten todellinen ballistinen kerroin määritellään vuosien 2002 ja 2004 kertoimien $B_i$ keskiarvona. Jotta epookkien välinen ballistisen kertoimen satunnaisvaihtelu olisi mahdollisimman pientä, käytetään yhtälön (\ref{Bi_eq}) integroinnissa vähintään kymmenen päivän integrointipituutta, minkä johdosta havaitut keskiliikkeen muutokset ovat suurempia ja merkitsevämpiä. Käytännössä ballististen kertoimien keskiarvoistus tekee kappaleiden avulla tehtävän tiheysmäärityksen IL-mallin suhteen harhattomaksi (pitkien ajanjaksojen yli).

Explorer 8 -satelliitin ballistisen kertoimen aikasarjalla on selvästi vahva puolivuosittainen komponentti, jossa $B_i$:n paikalliset maksimit osuvat mielenkiintoisesti samoihin aikoihin kuin termosfäärin globaalin massatiheyden maksimit \citep{emmert_2015}. Tämä todennäkäisesti kertoo mallin ajallisesti vaihtelevasta virheestä kappaleen kiertoradalla, sillä yhtälöiden (\ref{density_12_eq}) ja (\ref{density_13_eq}) perusteella:
\begin{equation} \label{obsToModel_eq}
\frac{\rho^H}{\rho^M} \cong \frac{B_i}{B^T}.
\end{equation}
Näin ollen IL-malli aliarvioisi yläilmakehän puolivuosittaista massatiheysvaihtelua tässä yksittäistapauksessa. Muiden satelliittien ballistinen kerroin käyttäytyy hyvin usein samanlaisella tavalla, mutta värähtelyn taajuus vaihtelee neljännesvuosittaisesta vuosittaiseen (ei näytetä). 

Tämä peräkkäisten $B_i$ -havaintojen suuri kovarianssi vaikeuttaa $B^T$:n virhearvion tekemistä. Tässä tutkielmassa todellisen ballistisen kertoimen virhearviona käytetään satunnaisjakautuneen muuttujan keskiarvon keskivirhettä \citep[esim.][]{altman_2005}:
\begin{equation} \label{Bi_err_eq}
\sigma_{B^T} = \frac{s_{B_i}}{\sqrt{N_{B_i}}},
\end{equation}
jossa $\sigma_{B^T}$ on kertoimen virhe, $s_{B_i}$ on vuosien 2002 ja 2004 $B_i$ -havaintojen keskihajonta ja $N_{B_i}$ havaintojen lukumäärä. Vaikka kyseessä on havaintojen suuresta autokorrelaatiosta johtuen selkeä aliarvio, vaihtelee virhearvio 3\%:n ja 10\%:n välillä. Tämä kvalitatiivisesti vastaa aiempia arvioita kaksirivisillä elementeillä saavutettavasta tarkkuudesta \citep[esim.][]{Doornbos_2007}. Lisäksi havainnot ballistisesta kertoimesta eivät ole aivan normaalijakautuneita, jolloin $\sigma_{B^T}$ ei välttämättä kunnolla kuvasta ballistisen kertoimen vaihtelua. 

\begin{table}[t]
\centering
\scriptsize
\caption{Työssä käytetyt satelliitit. Jokaiselle kappaleelle esitetään niiden NORAD:n kataloginumero (ID), ballistinen kerroin B, sen virhearvio $\sigma_B$, sekä tiheyskorkeus (z) kilometreinä. Laadunarvioinnissa käytetyt kolme kappaletta on alleviivattu.}
\label{tab:kappaleet}
\begin{tabular}{llll|llll}
ID & B         & $\sigma_B$       & z & ID & B         & $\sigma_B$      & z \\ \hline
22      & 0.023184  & 0.0012249   & 555.65        & 8744    & 0.010849  & 0.00048108  & 426.76        \\
60      & 0.021972  & 0.00076404  & 409.1         & 10517   & 0.019971  & 0.0012696   & 515.02        \\
63      & 0.013851  & 0.00041278  & 506.95        & 12138   & 0.011016  & 0.00049237  & 441.4         \\
107     & 0.021338  & 0.0012558   & 508.82        & 12388   & 0.011179  & 0.00048428  & 430.31        \\
165     & 0.047423  & 0.0013521   & 578.77        & 12445   & 0.018817  & 0.00064185  & 378.67        \\
614     & 0.013741  & 0.00049288  & 359.31        & 12849   & 0.0059853 & 0.00023662  & 446.35        \\
1685    & 0.031811  & 0.00091108  & 554.35        & 14483   & 0.010538  & 0.00041707  & 435.81        \\
1805    & 0.030132  & 0.0021946   & 557.83        & 14694   & 0.0017451 & 0.000050424 & 310.65        \\
1981    & 0.026446  & 0.00075328  & 541.48        & 19822   & 0.020854  & 0.00075956  & 303.12        \\
2016    & 0.029307  & 0.0021836   & 538.5         & 19824   & 0.032866  & 0.00067006  & 281.29        \\
2150    & 0.02124   & 0.00072539  & 380.76        & 20453   & 0.020478  & 0.00096756  & 470.26        \\
2153    & 0.030417  & 0.0018991   & 554.28        & 20571   & 0.02059   & 0.0012788   & 525.79        \\
2389    & 0.015301  & 0.0004788   & 388.74        & 20763   & 0.019772  & 0.0011542   & 501.5         \\
2622    & 0.021468  & 0.0012024   & 523.75        & 20774   & 0.011148  & 0.00053066  & 437.92        \\
3608    & 0.07031   & 0.0035767   & 492.66        & 21393   & 0.019677  & 0.00093649  & 426.61        \\
3827    & 0.021178  & 0.0010976   & 536.22        & 21835   & 0.018279  & 0.0010572   & 484.09        \\
4053    & 0.0051384 & 0.00013888  & 277.75        & 22196   & 0.01575   & 0.00048007  & 318.33        \\
4119    & 0.017226  & 0.0011507   & 369.1         & 22781   & 0.019672  & 0.00045456  & 237.23        \\
4221    & 0.021408  & 0.00078236  & 410.65        & 23278   & 0.010807  & 0.00046326  & 443.95        \\
4330    & 0.02353   & 0.00087718  & 323.43        & 23853   & 0.0079354 & 0.00018031  & 299.97        \\
4849    & 0.014115  & 0.00047304  & 433.6         & 24285   & 0.014225  & 0.00046896  & 391.93        \\
6073    & 0.0030028 & 0.000061025 & 238.86        & \underline{1616}    & 0.019397  & 0.00098471  & 436.65        \\
7337    & 0.010988  & 0.00048337  & 426.06        & \underline{2017}    & 0.039339  & 0.002724    & 538           \\
8063    & 0.01905   & 0.00061113  & 350.48        & \underline{23198}   & 0.019535  & 0.00083839  & 396.82       
\end{tabular}
\end{table}

Kaikki tutkimuksessa käytetyt kappaleet on esitetty Taulukossa \ref{tab:kappaleet}. Satelliitit ovat jakautuneet lähes tasaisesti aurinkoajan ja leveyspiirin suhteen, mutta jokaisen kappaleen perigeum kiertyy tarkastelujakson aikana niin paljon, ettei keskimääräistä maantieteellistä sijaintia ole mielekästä esittää (ei näytetä). Aiemmissa tutkimuksissa käytetyistä kappaleista valittiin ne 48, joiden (1) kaksirivisiä elementtejä oli saatavilla vuosina 2002 -- 2004 vähintään kymmenen päivän välein, (2) keskimääräinen tiheyskorkeus oli alle 550 km, (3) keskiliikkeen trendi oli selvästi kasvava ja (3) yksittäiset $B_i$ -arvot poikkesivat keskiarvostaan enintään tekijällä 5. Kaksirivisten elementtien perusteella laskettujen $B_i$ -arvojen hajonta kasvoi ja keskiliikken kasvuvauhti hidastui merkittävästi yli 550 km:n tiheyskorkeudella, joten tässä työssä oletetaan, että hyödyllisiä tiheyshavaintoja on saatavilla vain tämän korkeuden alapuolelta. Kappaleista kolme, keirtoradalle jääneet raketin osat 1616 (tiheyskorkeus 437 km), 2017 (538 km), ja 23198 (397 km) toimivat riippumattomina kappaleina, joiden avulla data-assimilaation laatua voidaan arvioida. 

%\pgfplotstabletypeset[]{Bfactors.csv}

\section{Ensemble Kalman -suodin}

\subsection{Taustaa}

Data-assimilaation tavoitteena on korjata mallin ennustetta havaintojen avulla siten, että mallin tila vastaa mahdollisimman tarkasti tutkittavan järjestelmän todellista tilaa. Data-assimilaatio on tärkeä osa operatiivisia säänennustusjärjestelmiä, sillä sen avulla voidaan mallille asettaa mahdollisimman todenmukainen alkutila, jota mallin yhtälöt kehittävät ajassa eteenpäin. 

Koska sekä havainnot että malli sisältävät virhettä, saadaan paras kuva järjestelmän todennäkäisimmästä tilasta yhdistämällä mallin ja havaintojen tiedot keskenään. Olettamalla virheiden olevan normaalijakautuneiden, voidaan mallin tilan $\mathbf{x}$ todennäkäisyysjakauma lausua ainoastaan mallin taustan (eli korjaamattoman ennusteen) $\mathbf{x_b}$ avulla \citep{nichols_2010}:
\begin{equation} \label{model_prob_eq}
P(\mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b})\right ],
\end{equation}
missä $\mathbf{B}$ on mallin taustan kovarianssimatriisi. Koska malli ja havainnot kuvaavat samaa järjestelmää, on mielekästä määritellä havaintojen $\mathbf{y}$ ehdollinen todennäkäisyys, kun mallin tila $\mathbf{x}$ on tunnettu:
\begin{equation} \label{data_prob_eq}
P(\mathbf{y} | \mathbf{x}) \propto \exp\left [ -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ],
\end{equation}
jossa $\mathbf{R}$ ilmaisee havaintojen kovarianssin ja $H$ on niin sanottu havainto-operaattori, joka on kuvaus malliavaruudesta havaintoavaruuteen. Havainto-operaattori ilmaisee, mitä arvoja tulisi havaita, mikäli mallitila on annetun ja havainnot virheetömiä.

Näiden kahden todennäkäisyyden ja Bayesin lauseen avulla saadaan määritettyä todennäkäisyys mallin tilalle, kun havainnot ovat annetujen \citep{nichols_2010}:
\begin{align} \label{final_prob_eq}
P(\mathbf{x} | \mathbf{y}) \propto P(\mathbf{y} | \mathbf{x}) P(\mathbf{x}) \propto 
\exp\left [ -\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) -\frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x}))\right ].
\end{align}
Eksponenttifunktion monotonisuuden johdosta suurin todennäköisyys löydetään minimoimalla lauseketta (niin sanottua sakkofunktiota):
\begin{align} \label{J_eq}
 J~=~\frac{1}{2}(\mathbf{x}-\mathbf{x_b})^T \mathbf{B}^{-1} (\mathbf{x}-\mathbf{x_b}) + \frac{1}{2}(\mathbf{y}-H(\mathbf{x}))^T \mathbf{R}^{-1} (\mathbf{y}-H(\mathbf{x})).
\end{align}
Tämän funktion minimikohta antaa järjestelmän todennäkäisimmän tilan eli niin sanotun analyysin $\mathbf{x}=\mathbf{x_a}$.

Data-assimilaatio-järjestelmät jaetaan kahteen pääluokkaan sen mukaan, minimoivatko ne funktiota (\ref{J_eq}) suoraan jollakin iteratiivisella minimointialgoritmilla (variaatiomenetelmät) \citep[esim.][]{talagrand_2010}, vai ratkaisevatko ne joukon lineaarisia yhtälöitä järjestelmän todennäkäisimmän tilan läytämiseksi (peräkkäiset menetelmät) \citep[esim.][]{bertino_2003}. Eräs käytetyimmistä peräkkäisistä data-assimilaatio-menetelmistä on Kalman-suodin \citep{kalman_1960}, joka tuottaa lineaariselle järjestelmälle harhattoman analyysin ja eksaktit virhekovarianssit. Kalman-suotimen toiminta perustuu sakkofunktion minimointiin analyyttisen ratkaisun avulla, joka läytyy sakkofunktion derivaatan ($\partial J / \partial \mathbf{x}$) nollakohdasta. Tämän nollakohdan laskennassa oletetetaan, että havainto-operaattori $H$ on linearisoitavissa siten, että:
\begin{align} \label{tanglin_eq}
H(\mathbf{x})-H(\mathbf{x_b}) \cong \mathbf{H}(\mathbf{x-x_b}),
\end{align}
missä $\mathbf{H}$ on tangentti-lineaarinen havainto-operaattori eli havaintojen Jacobin matriisi mallitilan suhteen $\mathbf{H_{ij}} = \partial y_i / \partial x_j$. Tämän (approksimaation) avulla analyysiksi löydetään:
\begin{align} \label{xa_eq}
\mathbf{x_a} = \mathbf{x_b} + \mathbf{K}(\mathbf{y} - H(\mathbf{x_b})),
\end{align}
jossa 
\begin{align} \label{K_eq}
\mathbf{K} = \mathbf{B H^T}(\mathbf{HBH^T} + \mathbf{R})^{-1}
\end{align}
on Kalmanin optimaalinen painomatriisi, $\mathbf{HBH^T}$ ilmaisee mallin ennustaman havaintojen virhekovarianssin, ja $\mathbf{BH^T}$ kovarianssin havaintojen ja mallitilan välillä. Mitä tarkempia havainnot ovat suhteessa taustaan, sitä enemmän painoa niille annetaan ja sitä lähemmäs havaintoja mallitila pyrkii; päinvastaisessa tilanteessa analyysi ei juurikaan poikkea taustasta.

Kalman-suotimessa mallitilan aikakehityksessä tarvittavan ennustusmallin lisäksi on kuitenkin oltava malli, joka kehittää analyysin kovarianssia 
\begin{equation} \label{analysis_cov_eq}
\mathbf{A}^n\mathbf{ = (I-KH)B}^{n}
\end{equation}
ajassa eteenpäin \citep[esim.][]{kalnay_2010}:
\begin{align} \label{time_evol_eq}
\mathbf{B}^{n+1} = \mathbf{MA}^n\mathbf{M^T},
\end{align}
missä yläindeksi n viittaa aikaan ja $\mathbf{M} = \partial M / \partial \mathbf{x_a}$ on (epälineaarisen) mallin $M$ linearisoitu eli tangentti-lineaarinen malli. 

Kalman-suodin ei kuitenkaan sovellu sellaisenaan käytettäväksi nykyaikaisissa säämalleissa, sillä taustan ja analyysin kovarianssimatriisit muodostuisivat niin suuriksi, ettei niitä nykyisillä tietokoneilla voisi käsitellä \citep[esim.][]{mackenzie_2003}. Lisäksi tangentti-lineaaristen havainto-operaattorien ja mallin kehitystyö vaatii paljon aikaa, ennen kuin data-assimilaatiojärjestelmää voidaan hyädyntää. Yksinkertaisemmalle ja tehokkaammalle järjestelmälle on siis tarvetta; \citet{evensen_1994} esitteli suotimesta Monte Carlo -version, niin sanotun ensemble Kalman-suotimen (EnKF, englanniksi \textit{Ensemble Kalman Filter}). EnKF käyttää taustan kovarianssin arviointiin mallirypästä, joka on äärellinen otos mallitilojen todennäkäisyysjakaumasta. Tämän otoskovarianssin avulla Kalmanin optimaalinen painomatriisi voidaan määrittää ja näin päivittää malliryppään tilat.

Rypäs on kokoelma malleja, joiden tilat poikkeavat hieman toisistaan. Se voidaan esittää matriisina, jonka jokainen sarake (pituus m) edustaa yhtä mallitilaa ja jokainen rivi (pituus N) yhden mallin muuttujan tilan todennäkäisyysjakaumaa \citep[esim.][]{evensen_1994}:
\begin{equation} \label{ens_eq}
\mathbf{X} = \mathbf{[x_1,x_2,...,x_N] = [x_i]}.
\end{equation}
Ryppään mallitilojen oletetaan olevan todennäkäisyysjakauman satunnaisotos, mutta tarkalleen ottaen peräkkäinen data-assimilaatio EnKF:lla tekee niiden tilat riippuviksi toisistaan. Mallitaustan kovarianssi voidaan arvioida suoraan ryppään avulla:
\begin{equation} \label{enscov_eq}
\mathbf{C} = \frac{\mathbf{AA^T}}{N-1},
\end{equation}
missä $m \times N$ -matriisi 
\begin{equation} \label{A_eq}
[\mathbf{A}]_i = \mathbf{x}_i - E(\mathbf{X})
\end{equation}
ja rypäskeskiarvo
\begin{equation} \label{E_eq}
E(\mathbf{X}) = \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k}.
\end{equation}

Koska mallitilan lisäksi havainnot sisältävät epävarmuutta, kuvataan havaintovektoria $\mathbf{y}$ samalla tavoin joukkona satunnaisotoksia:
\begin{equation} \label{data_eq}
\mathbf{Y} = \mathbf{[y_1,y_2,...,y_N] = [y_i]},~\mathbf{y_i = y + \epsilon_i},
\end{equation}
jossa Y on $o \times N$ -matriisi, jonka sarakeisiin on lisätty $N(0,\mathbf{R})$ -jakautuneita o-pituisia satunnaislukuvaktoreita $\mathbf{\epsilon_i}$. 

Näiden avulla Kalman-suotimen analyysiyhtälö saa muodon:
\begin{equation} \label{enkf_anal_eq}
\mathbf{X_a = X_b + CH^T (HCH^T+R)^{-1} (Y-HX)}.
\end{equation}
Koska taustan kovarianssi arvioidaan jokaisella assimilaatiokierroksella yhtälöstä (\ref{enscov_eq}), ei yhtälön (\ref{time_evol_eq}) kaltaista kovarianssimatriisin kehitysyhtälöä enää tarvita. Kehittämällä jokaista ryppään mallia seuraavalle assimilaatiohetkelle, mahdollisesti hyvin epälineaarinen ennustusmalli kehittää samalla myös kovarianssia itseään ajassa eteenpäin. Näin ollen EnKF ei tarvitse tangentti-lineaarista mallia toimiakseen, mikä helpottaa algoritmin implementointia. 

Yhtälössä (\ref{enkf_anal_eq}) on kuitenkin jäljellä tangentti-lineaarinen havainto-operaattori $\mathbf{H}$. Sijoittamalla analyysiyhtälöän kovarianssin lauseke (\ref{enscov_eq}) ja olettamalla taustan ja havaintojen virheet korreloimattomiksi, saadaan yhtälö muotoon \citep{mandel_2006}:
\begin{align} \label{ha_analysis_eq}
\mathbf{X_a = X_b} + \frac{1}{N-1} \mathbf{A A^T H^T} (\frac{1}{N-1} \mathbf{H A A^T H^T+R)^{-1} (Y-HX)}\nonumber \\
= \mathbf{X_b} + \frac{1}{N-1} \mathbf{A (HA)^T} (\frac{1}{N-1} \mathbf{HA(HA)^T  + R)^{-1} (Y-HX)}
\end{align}
Tässä matriisi $\mathbf{HA}$ voidaan lausua epälineaarisen havainto-operaattorin $H$ avulla:
\begin{align} \label{HA_eq}
[\mathbf{HA}]_i = \mathbf{H x_i} - \mathbf{H} \frac{1}{N} \sum_{k=1}^{N} \mathbf{x_k} \nonumber\\
\cong H(\mathbf{x_i}) - \frac{1}{N} \sum_{k=1}^{N} H(\mathbf{x_k}).
\end{align}
Selvästi myös $\mathbf{[HX]}_i \cong H(\mathbf{x_i})$, joten yhtälö (\ref{HA_eq}) voidaan esittää ainoastaan epälineaarisen operaattorin $H$ avulla. Näin ollen tarvetta tangentti-lineaarisille operaattoreille ei tässä EnKF-implementaatiossa lainkaan ole. 

Ensemble Kalman -suotimeen liittyy monien etujensa lisäksi myös joitain vaikeuksia. Suurimmat ongelmat liittyvät suotimen Monte Carlo -luonteeseen; kuinka voidaan varmistaa, että malliryväs on edustava otos järjestelmän tilan todennäkäisyysjakaumasta? Ongelmat ovat suurimmillaan, kun ryppään koko $N$ on pieni \citep{houtekamer_1998}. Jos malleja on liian vähän esittämään todennäkäisyysjakauman vaihtelua, on järjestelmä alinäytteistetty. Alinäytteistys on voi johtaa tilanteeseen, jossa analyysin kovarianssia järjestelmällisesti aliarvioidaan \citep{lorenc_2003}. Virhe analyysin kovarianssissa ilmenee virheenä seuraavan assimilaatiosyklin taustan kovarianssissa, jolloin havaintojen ja taustan kovarianssien suhde ei ole oikein ja siten näiden avulla tuotettu analyysi on virheellinen. 

Yhtälön (\ref{analysis_cov_eq}) mukaisesti analyysin kovarianssi on taustan kovarianssia pienempi. Yhdessä alinäytteistyksen aiheuttaman järjestelmällisen aliarvion kanssa tämä aiheuttaa suotimen konvergenssia, jossa malliryppään jäsenet lähestyvät ajan kuluessa toisiaan \citep[esim.][]{hamill_2001}. Tällöin havaintojen kovarianssi suhteessa taustan kovarianssiin kasvaa ja havaintojen merkitys malliryppään päivityksessä käy lopulta hyvin pieneksi. Suodinkonvergenssia vastaan on EnKF:aa hyädyntävissä data-assimilaatiojärjestelmissä usein menettely, joka keinotekoisesti kasvattaa analyysin tai taustan kovarianssia \citep{whitaker_2002}. Tässä työssä käytettyä kovarianssin kasvatusmenetelmää käsitellään tarkemmin seuraavassa osiossa.

Kovarianssin pienenemisen lisäksi alinäytteistys aiheuttaa mallitilan kovarianssiin epäfysikaalista kohinaa eli niin sanottuja harhaanjohtavia korrelaatioita \citep{evensen_2003}. Fysikaalisessa hilapisteavaruudessa toimivien mallien hilapisteiden arvot voivat näennäisesti korreloida keskenään, vaikka niiden välinen etäisyys olisi suuri. Koska kausaalinen yhteys hilapisteiden arvojen välillä pienenee pisteiden välisen etäisyyden funktiona, voi luonteeltaan globaalissa (kaikki havainnot vaikuttavat kaikkiin mallin muuttujiin) EnKF:ssa kehittyö tilanne, jossa kaukana hilapisteestä oleva havainto vaikuttaa epäfysikaalisen paljon hilapisteen analyysiin. Diskreeteissä hilamalleissa, jotka laskevat malliryppään avulla eksplisiittisen taustan kovarianssin, voidaan harhaanjohtavia korrelaatioita torjua pienentämällä hilapisteiden välistä kovarianssia jonkin funktion mukaisesti \citep{houtekamer_2001}. Samanlainen menettely on mahdollista myös palloharmonisissa malleissa tekemällä oletuksia virheen isotrooppisuudesta tai käyttäen pseudo-spektraalimenetelmää \citep{buehner_2012}. Tässä työssä taustakovarianssin harhaanjohtavia korrelaatioita ei kuitenkaan yritetä korjata.

\subsection{Ensemble Kalman -suodin Iipponen-Laitinen -mallissa}

Ensemble Kalman -suodinta on aiemmin hyödynnetty yläilmakehämallien data-assimilaatiossa \citep[esim.][]{chen_2016,chartier_2016}. Tällöin kyseessä ovat kuitenkin olleet fysikaaliset mallit, jotka integroivat yläilmakehää kuvaavia primitiiviyhtälöitä ajassa eteenpäin. Puoli-empiirisiä malleja on sen sijaan korjattu sovittamalla havaintoihin funktiosovitus \citep{doornbos_2005,Doornbos_2007}, joka on kokonaan jättänyt huomiotta mallin taustan. Lisäksi aiemmat empiiristen mallien data-assimilaatiot ovat olleet täysin deterministisiä, kun taas EnKF voi antaa kuvauksen ilmakehän tilan todennäkäisyysjakaumasta.

Tässä työssä ilmakehämallin massatiheyttä korjataan Doornbosin (2008) esittämällä tavalla, jossa korjataan ainoastaan mallin ala- (130 km:ssa) ja ylärajan (eksosfääri) lämpötiloja. Tämä lämpötilaprofiilin muutos vaikuttaa kaikkien ilmakehän kaasulajien skaalauskorkeuksiin ja siten massatiheyteen vakiokorkeuspinnoilla. Mallin alarajalla absoluuttista lämpötilaa $\mathrm{T_0}$ ja sen pystysuuntaista gradienttia $T'$ korjataan skalaarien $\mathrm{\Delta T_0}$ ja $\mathrm{\Delta T'}$ avulla:
\begin{align} \label{lb_ass_eq}
\mathrm{T_{0,a}} = \mathrm{T_{0,IL}} + \mathrm{\Delta T_0} \\
\mathrm{T'}_= \mathrm{T'}_{IL} + \mathrm{\Delta T'}
\end{align}
Korjaukset ovat siis aina lisäyksiä korjaamattoman IL-mallin lämpötilakenttiin, joiden laskennassa on käytetty pakotetekijöiden havaittuja aikasarjoja. 

Koska lähes isotermisen keski- ja ylätermosfäärin lämpötilavaihtelut ovat suurempia kuin alatermosfäärin \citep{emmert_2015}, on eksosfäärin lämpötilalla alareunan arvoja suurempi vaikutus termosfäärin yläosien tiheyteen. Näin ollen eksosfäärin lämpötilakuvauksen on syytä olla alareunan korjauksia realistisempi. Eksosfäärin lämpötilaa korjataan käyttäen palloharmonista sarjaa:
\begin{equation} \label{deltaTex_eq}
\mathrm{\Delta T_{ex}} = a_0 + \sum_{n=1}^{N}\left [ \sum_{m=0}^{n} a_{nm} P_{nm}(sin(\phi)) cos(m \lambda ) + \sum_{m=0}^{n} b_{nm} P_{nm}(sin(\phi)) sin(m \lambda ) \right ],
\end{equation}
jossa $a_{nm}, b_{nm}$ ovat reaaliarvoisten palloharmonisten funktioiden kertoimia, $n$ on asteluku, $m$ on kertaluku (zonaalinen aaltoluku), $N$ on suurin aste- ja kertaluku (kolmiomainen katkaisu TN \citep{ifs_numerics}), $\phi$ on leveyspiiri, $\lambda$ on aurinkoaika ja 
\begin{equation} \label{legendre_eq}
P_{nm}(x) = \frac{(-1)^m}{2^n n!} (1-x^2)^{m/2} \frac{d^{n+m}}{d x^{n+m}} (x^2 - 1)^n
\end{equation}
ovat normalisoimattomat Legendren liittofunktiot. Tässä työssä rajoitutaan palloharmoniseen korjaukseen T2, jonka avulla suuriamplitudinen päivä- ja puolipäivävaihtelu voidaan hyvin karakterisoida. Näin ollen mallitila koostuu yhteensä 11:a korjausparametristä (kaksi alarajalla ja yhdeksän ylärajalla).

Jotta mallitilan ja havaintojen kovarianssien suhde voitaisiin määrittää, on havaintoaineistolle oltava selkeä virhearvio. Tämän työn data-assimilaatiojärjestelmässä havaintoina käytetään ainoastaan kaksirivisiä elementtejä. Ongelma kuitenkin on, ettei kaksirivinen elementtiaineisto pidä sisällään mitään tietoa havaintoepävarmuudesta, eikä käyttäjän ole mitenkään mahdollista selvittää alkuperäisten tutkahavaintojen tai ratasovituksen tarkkuutta \citep{picone_2005}. Siksi tässä työssä oletetaankin kaksirivisten elementtien itsessään olevan hyvin tarkkoja, suurimman epävarmuuden muodostuessa satelliitin todellisen ballistisen kertoimen $B^T$ määrityksestä. Näin ollen virheen kasautumislaista ja yhtälöstä (\ref{density_12_eq}):
\begin{equation} \label{densErr_eq}
\sigma_{\rho^H} \cong  \frac{\frac{2}{3} \Delta_{ik}n_M \mu^{2/3} \left [ n_M(t_{ik}) \right ]^{-1/3}}{\oint_{(t_i,t_k)}  v^3 F dt} \frac{\sigma_{B^T}}{(B^T)^2}.
\end{equation}
Kirjoittajan tietojen mukaan tämä on ensimmäinen kerta, kun kaksirivisten elementtien assimilaatiossa otetaan huomioon tiheyden epävarmuus. 

Koska yhtälöiden (\ref{density_12_eq}) antama tiheys vaihtelee useita kertaluokkia läpi termosfäärin ja koska tiheys on pieni suhteessa mallitilan parametreihin, assimiloidaan tässä työssä havainnot malliin logaritmisessa avaruudessa. Tällöin tiheyden epävarmuus (yhtälö (\ref{densErr_eq})) saa virheen kasautumislaista muodon:
\begin{equation} \label{densErrLog_eq}
\sigma_{\ln(\rho^H)} = \sigma_{\rho^H} \frac{\partial}{\partial \rho^H} \ln(\rho^H) = \sigma_{\rho^H} / \rho^H.
\end{equation}
Logaritmisen koordinaatiston oletetaan parantavan numeerista vakautta ja siten suotimen tarkkuutta. 

Jokaisella assimilaatiosyklillä havainnoiksi valitaan ne kappaleet, joiden kaksirivisten elementtien epookkien keskiarvo $t_{ik}$ osuu assimilaatioikkunaan (aikaväli, jolta havaintoja assimilaatiota varten kerätään). Koska kaksirivisen elementtidatan aikaresoluutio on noin kolme päivää, vaaditaan tiheyden määrityksessä käytettyjen elementtien epookkien eroksi myös vähintään kolme päivää. Jotta yhteen assimilaatioon olisi käytettävissä mahdollisimman paljon dataa, ja jotta aikaresoluutio olisi hyvä, kolme päivää valittiin myös assimilaatioikkunan pituudeksi. Aina ennen seuraavaa assimilaatiosykliä asetetaan $t_i = t_k$ eli saman kappaleen tiheyden integrointia jatketaan siitä, mihin edellisen syklin aikana on jääty. Kappaleista kuitenkin hylätään ne, joiden keskiliike on pienentynyt. Lähemmissä tarkasteluissa todettiin, että muihin muuttujiin, kuten $B_i$:hin liittyvää eliminointia ei tarvinnut tehdä, koska kaikki 45 kappaletta oli valittu siten, että ne antavat realistiselta vaikuttavaa tiheysinformaatiota (kun keskiliike kasvaa). 

Assimiloitavien havaintojen vastineet lasketaan mallitiloista epälineaarisen havainto-operaattorin avulla. Havainto-operaattori lisää IL-mallin ala- ja ylärajan lämpätiloihin korjaukset (\ref{lb_ass_eq}) ja (\ref{deltaTex_eq}), laskee SGP4-kiertoratamallilla satelliitin paikan puolen minuutin välein, muuttaa sen inertiaalikoordinaatistosta maantieteellisiin koordinaatteihin, määrittää ilmakehän tiheyden korjatulla IL-mallilla kiertoradalle lasketuissa pisteissä ja palauttaa yhtälön (\ref{density_13_eq}) mukaisesti painotetun tiheyden logaritmin. $H$ ottaa myös huomioon aikadimension -- IL-mallin laskennassa käytetään assimilaatioikkunaa lyhyemmillä aikaväleillä vaihtelevia F30- ja AE-indeksejä, jotka vaikuttavat IL-mallin globaaliin lämpötila- ja tiheysjakaumaan.

Malliryppään kooksi valittiin N = 100 mallia, koska merkittävää parannusta assimilaatiojärjestelmän suorituskyvyssä ei suuremmilla ryppäillä havaittu (ei näytetä). Malliryväs alustetaan arpomalla jokaiselle korjausparametrille N-kappaletta keskihajonnalla 100 K ($\mathrm{\Delta T'}$:lle 5 K/km) jakautuneita normaalijakauman satunnaislukuja. Ryppään kovarianssin kuitenkin todettiin pienenevän ja pienenevän kun havaintojen assimilaatiota malliin suoritettiin useita kertoja. Tämä on merkki suotimen konvergenssista (katso edellinen osio) ja järjestelmässämme sitä korjataan pitämällä taustan eksosfäärin lämpötilakorjauksen varianssi vakiona \citep{morozov_2013}:
\begin{equation} \label{inflation_eq}
\mathbf{\Delta T_{ex}}_{, korj.} = \sqrt{\frac{s}{\sigma^2_{\mathbf{\Delta T_{ex}}}}} (\mathbf{\Delta T_{ex}} - E(\mathbf{\Delta T_{ex}})) + E(\mathbf{\Delta T_{ex}}),
\end{equation}
missä $\mathbf{\Delta T_{ex}}$ on vektori kaikkien ryppään mallien arvoista, $E(\mathbf{\Delta T_{ex}})$ on vektorin keskimääräinen arvo ja s on haluttu (vakiona pysyvä) varianssi (niin sanottu inflaatioparametri). 

\begin{figure}[t]
\centering
\includegraphics[scale = 0.6]{gradu_rank_hist}
\caption{Mallin taustasta laskettujen havaintojen järjestyslukujen jakauma vuosina 2002 ja 2004 yhtälön (\ref{inflation_eq}) inflaatioparametrin arvolla $s = 25~\mathrm{K}^2$.}
\label{fig:rank}
\end{figure}

Paras arvo varianssille löydetään tarkastelemalla havaittujen arvojen sijaintia suhteessa malliryppään vertailuarvoihin \citep{hamill_2001b, jarvinen_2015}. Mikäli kunkin havainnon kohdalla havainto ja malliryppään N vastinetta asetetaan kasvavaan järjestykseen, havainnon sijaintia suhteessa ryppääseen kuvaa havaintoarvon järjestysluku $k$. Jos $k = 1$, havainto on pienempi kuin yksikään ryppään arvioista ja jos $k = N + 1$, kaikki ryppään vastineet ovat havaintoa pienempiä. Sitävastoin välillä $1 < k < N+1$ havainto osuu ryppään sisään. Laadukkaassa (ja harhattomassa) ennustusjärjestelmässä järjestysluku $k$ onkin tasaisesti jakautunut satunnaismuuttuja, sillä äärellisen otoksen luonteen johdosta havainto voi sijaita myös ryppään ulkopuolella. Assimiloimalla malliin vuosien 2002 ja 2004 havaintoja ja piirtämällä mallin taustaryppään avulla laskettujen järjestyslukujen histogrammeja, valittiin inflaatioparametrin sopivaksi arvoksi $s= 25~\mathrm{K}^2$. Lopullinen järjestyslukujen histogrammin on esitetty Kuvassa \ref{fig:rank}; rypäs on hieman ali-dispersiivinen (havainto osuu useammin lähelle ryppään reunoja ja ulkopuolelle kuin sen keskelle), mutta tämän tutkielman tarkoituksiin riittävän hyvin kalibroitu. Todettiin, että hieman suurempia inflaatioparametrin arvoja käytettäessä suotimen taustan varianssi muodostui niin isoksi, että havainnoilla oli suhteettoman suuri vaikutus analyysin arvoon. Tällöin mallitilan todettiin muuttuvan hyvin nopeasti epäfysikaaliseen tilaan, joka lopulta alkoi poikkeamaan huomattavasti myös havainnoista, joita siihen assimiloitiin. [\textit{Puhekielisesti ilmaistuna suodin "räjähti".}]

\section{Tulokset}

\begin{figure}[t]
\centering
\includegraphics[scale = 0.7]{gradu_sumdiagb}
\caption{Taustan kovarianssimatriisin päädiagonaalielementtien (eli mallitilan muuttujien varianssien) summa. Huomaa logaritminen asteikko.}
\label{fig:sumdiagb}
\end{figure}

Kuva \ref{fig:sumdiagb} esittää mallitaustan kovarianssimatriisin diagonaalielementtien summaa. Taustan varianssi pienenee ajan funktiona kun malliin assimiloidaan havaintoja, mikä on välttämätön (muttei riittävä) ehto sille, että data-assimilaatiojärjestelmä toimii. Alussa pieneneminen on hyvin nopeaa mallitilan ollessa epävarma, mutta pienentymisen nopeus hidastuu varianssin lähestyessä asymptoottisesti jotain arvoa. Tässä työssä ehdoton alaraja mallimuuttujien varianssin summalle on edellisessä luvussa esitelty keinotekoinen varianssi-inflaatio. Vuoden 2003 assimilaatioajanjakson lopussa diagonaalielementtien summa on laskenut noin 40:een yksikköön. [\textit{Tässä lasketaan yhteen "omenia ja banaaneja" -- mallimuuttujilla kun ei kaikilla ole samaa yksikköä.}] Huomaa, että suodinyhtälössä (\ref{ha_analysis_eq}) taustan kovarianssimatriisia ei eksplisiittisesti määritetä; se on laskettu ryppäästä jälkikäteen laadunvalvontaa varten.

\begin{figure}[h]
\centering
\includegraphics[scale = 0.7]{gradu_kovarianssi}
\caption{Taustan kovarianssimatriisin alkioiden itseisarvon kymmenkantainen logaritmi assimilaatiohetkellä 30. joulukuuta 2003. [\textit{Tarkkaavainen lukija huomaa, että tässä näkyy vain kymmenen muuttujaa. En käsitä, miksei Matlab piirrä sitä yhdettätoista.}]}
\label{fig:kovarianssi}
\end{figure}

Yksi esimerkki mallin kovarianssimatriisista on annettu Kuvassa \ref{fig:kovarianssi}. Kuvan väriskaala kuvaa kovarianssin itseisarvon kymmenkantaista logaritmia ja akselit ilmaisevat muuttujan indeksin. Järjestyksessä malliparametrit ovat: 1. $\Delta T_{ex}$:n keskiarvo, 2. $\Delta T_0$, 3.$\Delta T'$ ja 4.-11. eksosfäärin lämpötilakorjauksen palloharmoniset kertoimet. Pienen kokokoluokkansa takia alareunan lämpötilagradientin korjauksen suhteen lasketut kovarianssit ovat myös melko pieniä (matriisin rivi ja sarake 3). Tästä huolimatta parametrin kovarianssit vaikuttavat jopa epärealistisen pieniltä (varianssin suuruus on alle 0.1 K/km). Voi olla, etteivät kokonaismassatiheyshavainnot ole riittävä tietolähde lämpötilagradientin rajoittamiseksi. 

EnKF:n Tiheyksissä havaittu vaihtelu näyttäisi sen sijaan aiheutuvan ala- ja yläreunan lämpötilakorjausten (ko)varianssista. Keskimääräisten korjausten (parametrit 1 ja 2) lisäksi myös palloharmonisten termien kovarianssit ovat suurehkoja. Erityisen suuria arvoja havaitaan palloharmonian $Y_{20}$ kertoimessa (7); aurinkoajasta riippumaton zonaalisymmetrisen paraabelin muotoinen harmonia kuvaa päiväntasaajan massatiheysmaksimin (tai vastaavasti yön minimin) suuruutta ja ilmakehän suuripiirteistä meridionaalista rakenneta (ks. Kuva \ref{fig:tiheys}). Sitävastoin parametrien $Y_{10}$ (4) ja $Y_{21}$ (8) havaittiin korreloivan keskenään vain hyvin vähän. Mikäli kovarianssimatriisi ei sisällä harhaisia korrelaatioita, havaittu palloharmonisten kertoimien suuri kovarianssi kertoo, että yläilmakehässä taustan virheet eivät ole isotrooppisia (kuten useissa alailmakehäsovelluksissa oletetaan) \citep{buehner_2012}. 

\begin{figure}[h]
%\centering
\includegraphics[scale = 0.77]{gradu_analysisSurf}
\caption{Korjaamattoman IL-mallin (ylhäällä) ja analyysin (alhaalla) kuvaus massatiheydestä 400 km:n korkeudella leveyspiirin ja aurinkoajan funktiona 31. tammikuuta 2003 (yksikössä kg / $\mathrm{m^3}$). Paneelien väriskaala on sama.}
\label{fig:analysisSurf}
\end{figure}

Kuva \ref{fig:analysisSurf} antaa esimerkin korjaamattoman IL-mallin ja analyysin tuottamasta termosfäärin massatiheydestä 400 km:n korkeudella maantieteellisen leveyspiirin ja aurinkoajan funktiona. Tässä yksittäistapauksessa analyysin tuottama massatiheys vaikuttaa olevan globaalisti pienempi kuin korjaamattoman IL-mallin ennuste. Ilta- ja keskiyön tiheys pienenee ja massatiheyden maksimi on heikompi. Aiempien tutkimusten nojalla puoliempiirisissä ilmakehämalleissa esiintyy päivän aikaskaalalla jopa kymmenien prosenttien harhoja \citep[esim.][]{picone_2005}, joten tulos on uskottava. Harhan suuruus tosin riippuu merkittävästi maantieteellisestä sijainnista ja korkeudesta. Kuvassa ei ole esitetty mallin taustaa, koska se on melko lähellä analyysiä. 

\begin{figure}[h]
%\centering
\includegraphics[scale = 0.65]{gradu_1616}
\caption{Havaitun ja mallinetun tiheyden suhde testikappaleelle 1616 vuonna 2003. Esitettynä korjaamaton IL-malli (vihreä), EnKF:lla tuotettu analyysi (musta) ja sen 90\%:n luottamusväli (punaiset viivat).}
\label{fig:omTimeseries}
\end{figure}

Kuva \ref{fig:omTimeseries} havainnollistaa korjaamattoman IL-mallin ja EnKF:lla tuotetun analyysin harhaa tarkasteluvuonna 2003. Aikasarja kuvaa kappaleen 1616 kiertorataa, jonka havaintoja ei assimiloitu malliin. Kuvassa näkyy selkeä, noin kolmasosavuoden jaksolla havaittava harha IL-mallissa, jota EnKF ei täysin pysty korjaamaan. Analyysin parannus on kuvan perusteella merkittävä ensimmäisen puolen vuoden aikana. Joulukuussa havaitaan kuitenkin ajanjakso, jolloin korjaamattoman IL-mallin ennuste on harhattomampi kuin analyysin. Lisäksi nähdään, että 90\%:n luottamusväli on hyvin symmetrinen keskiarvon suhteen, mikä johtunee tiheyteen vaikuttavien parametrien gaussisesta jakaumasta ja IL-mallin suhteellisesta yksinkertaisuudesta. Kuten Kuvassa \ref{fig:analysisSurf}, poikkeamat analyysin ja taustan välillä ovat melko pieniä, joten mallitaustaa ei esitetä.

Mallin suorituskykyä kuvataan tässä työssä neliöllisen keskivirheen (englanniksi \textit{Root Mean Square Error}, RMSE) \citep[k.s. esim.][s. 359]{wilks_2011} avulla. Virhe määritellään työssämme suhteellisena:
\begin{equation} \label{rmse_eq}
RMSE = \sqrt{\frac{1}{K} \sum_{i=1}^K \left ( \frac{\rho_i^H}{\rho_i^M} - 1 \right )^2},
\end{equation}
missä $\rho_i^H$ on (kaksirivisten elementtien avulla) havaittu ja $\rho_i^M$  mallinnettu tiheys tietyllä ajanhetkellä, ja $K$ on havaintojen lukumäärä aikasarjassa (vuoden 2003 aikana). Parametri sopii hyvin termosfäärimallien suorituskyvyn arviointiin, koska se kuvaa samanaikaisesti sekä mallin harhaa (keskiarvopoikkemaa) että sen kykyä ennustaa massatiheydessä havaittuja geofysikaalisia vaihteluja \citep{bruinsma_2012}. Tämän vuoksi se vastaa hyvin myös matalan kiertoradan satelliittien kiertoratamallinnuksessa tehtävää paikkavirhettä. Mitä pienempi RMSE on, sitä paremman mallin suorituskyvyn katsotaan olevan. 

RMSE:n muutoksen tilastollinen merkitsevyys arvioidaan paritetun t-testin \citep[esim.][]{press_2007} perusteella. Laskemalla IL-mallin ja taustan tai analyysin  tuottamien $(\rho_i^H / \rho_i^M - 1)^2$ -arvojen erotukset, saadaan aikasarja, jonka keskiarvon poikeamaa nollasta voidaan tilastollisesti arvioida. Tässä työssä p-arvo ilmaisee todennäköisyyden, jolla havaittu RMSE:n \textit{pienentyminen} data-assimilaation seurauksena aiheutuu sattumasta.

\begin{table}[t]
\centering
\caption{Assimilaatiojärjestelmän (tausta ja analyysi), sekä korjaamattoman IL-mallin suorituskyky kolmen testikappaleen kiertoradoilla. Testikappaleiden keskimääräinen tiheyskorkeus on annettu sulkeissa. Virhearvot ovat suhteeellisia RMSE-arvoja (yhtälö(\ref{rmse_eq})). Ilmoitettu p-arvo kuvaa t-testin avulla laskettua todennäköisyyttä sille, että assimilaation seurauksena havaittu RMSE:n pienentyminen aiheutuu sattumasta.}
\label{tab:results}
\begin{tabular}{l|l|l|l}
NORAD ID & IL    & Tausta           & Analyysi         \\ \hline
1616  (437 km)   & 0.42 & 0.40 (p = 0.16)  & 0.36 (p = 0.009) \\
2017  (538 km)   & 0.57 & 0.49 (p = 0.027) & 0.46 (p = 0.001) \\
23198 (397 km)   & 0.34 & 0.42 (-)         & 0.30 (p = 0.014)
\end{tabular}
\end{table}

Taulukossa \ref{tab:results} on vertailtu EnKF:n taustan ja analyysin tarkkuutta korjaamattomaan IL-malliin kolmen testikappaleen radoilla, joita ei ole malliin assimiloitu. Annettujen p-arvojen perusteella voidaan todeta, että data-assimilaatiojärjestelmän analyysi pienentää mallin RMS-virhettä (95\%:n luottamuksella). EnKF:n tausta sen sijaan tarkentaa mallin kuvausta ainoastaan kappaleen 2017 kiertoradalla, joka tosin on kappaleista kaikista korkeimmalla ja jonka radalla IL-mallin tarkkuus on huonoin. Kappaleen 1616 radalla havaitaan myös taustan pienentävän RMSE-arvoa, mutta muutos ei ole merkitsevä 95\%:n luottamuksella. Lisäksi havaittiin, että assimilaatiojärjestelmän tuottama parannus vaihtelee ajassa kaikkien kappaleiden radoilla (ei näytetä). Esimerkki tästä kuitenkin esitettiin Kuvassa \ref{fig:omTimeseries}.

\section{Pohdinta}

Kuvan \ref{fig:omTimeseries} ja Taulukon \ref{tab:results} perusteella Ensemble Kalman -suotimen analyysi kykenee tarkentamaan puoli-empiirisen yläilmakehämallin kuvausta termosfäärin massatiheydestä, vaikka suhteellisesti parannukset eivät ole kovin suuria. Koska IL-malli esittää termosfäärin keskimääräistä tilaa, poikkeaa sen ennuste väistämättä yläilmakehän todellisesta tilasta. EnKF kykenee kuitenkin korjaamaan tätä keskimääräistä tilaa ajan funktiona käyttämällä hyväkseen termosfääristä tehtäviä havaintoja, ja näin mallin kuvaus saadaan paremmin vastaamaan dynaamisesti muuttuvaa ilmakehää. Analyysin tarkkuudesta huolimatta mallin taustalla ei ole ennustusarvoa seuraavan assimilointi-ikkunan aikana.

Tarkasteluvuotena 2003 sekä auringon että geomagneettinen aktiivisuus oli suurta, jolloin termosfäärin tila vaihteli nopeasti tuntien ja päivien aikaskaalalla \citep{emmert_2015}. Suurin virhelähde empiirisissä yläilmakehämalleissa aiheutuu auringon ja geomagneettisen aktiivisuuden ilmakehävaikutustan arviointiin käytetyistä parametrisoinneista (ja etenkin niissä käytetyistä yksinkertaisista indekseistä) \citep{berger_1998}. Mallien suorituskyky on heikoimmillaan näiden kahden aktiivisuuden ollessa korkeita, joten on perusteltua olettaa, että data-assimilaatiolla olisi vuonna 2003 huomattava vaikutus mallin suorituskykyyn. Toisaalta pakotteiden nopeat vaihtelut myös muuttavat mallin virhettä hyvin nopeasti. Tästä johtuen, vaikka pakotteen aikakehitys tunnettaisiin tarkkaan, analyysin korjauskenttä ei paranna mallin ennustetta seuraavan kolmen päivän assimilointi-ikkunan aikana. Koska auringon minimissä termosfäärin pakotteet muuttuvat hitaammin \citep{berger_1998}, voi olla, että taustan ennustuskyky on minimiaikana parempi. Tällöin tosin mallin suorituskyky on myös parhaimmillaan, joten data-assimilaatio ei välttämättä tarkenna analyysiä absoluuttisesti niin paljon kun auringon maksimin aikoihin vuonna 2003.

Kuitenkaan oletus siitä, että pakotteiden aikakehitys tunnettaisiin ei aina ole realistinen. Yhdysvaltain armeijan avaruustaistelulaboratorion HASDM-yläilmakehämalli \citep{storz_2005} kykenee tekemään massatiheysennusteita kolmen vuorokauden päähän käyttämällä hyväkseen ennusteita auringon UV-säteilystä ja (globaalia geomagneettista aktiivisuutta kuvaavasta) $\mathrm{k_p}$-indeksistä. \citet{storz_2005} osoittavat, että  korkean auringon aktiivisuuden aikaan satelliittien kiertoradadan ennusteessa tehtävä paikkavirhe (joka on suoraan verrannollinen tiheysmallin neliöllisen keskiarvon virheeseen) ei merkittävästi kasva ensimmäisen 18:a tunnin aikana ja ennusteen laatu alkaa merkittävästi heiketä vasta 36:n tunnin jälkeen. Kuitenkin vielä kolmen vuorokauden jälkeenkin paikkavirhe on 12\%:a parempi korjaamattomaan tiheysmalliin nähden. HASDM-malli käyttää auringon UV-säteilyvuon ennustamiseen neuroverkkoja, jotka kykenevät tuottamaan luotettavan kolmen vuorokauden ennusteen \citep{tobiska_2000}. Tämän työn tulosten perusteella taustalla ei ole kolmen päivän ennustuskykyä tilanteessa, jossa pakotteiden tuleva aikakehitys on tarkkaan tiedossa. On kuitenkin mahdollista, että EnKF:lla luodulla taustalla on ennustusarvoa lyhyemmällä kuin kolmen päivän aikajänteellä. EnKF:n stokastinen luonne mahdollistaisi myös pakotetekijäiden suoran arvioimisen tiheyshavaintojen perusteella, joten saattaisi olla mahdollista luoda ennusteita, joissa pakotteen aikakehityksen epävarmuus on esitetty lämpötilakorjauksen tavoin mallitilan muuttujana. On kuitenkin huomioitava, että HASDM:n julkaistut tulokset käsittelevät vain geomagneettisesti hiljaisia ajanhetkiä, joten ei tiedetä, kuinka mallin ennustusjärjestelmä toimii geomagneettisten myrskyjen aikaan. Lisäksi on huomattava, että HASDM käyttää suurempaa määrää kappaleita ja hyädyntää suoraan NORAD:n salaisia tutkahavaintoja, mitkä yhdessä mahdollistavat tähän työhön verrattuna tarkemman analyysin tekemisen. 

Nämä tarkemmat havainnot antavat HASDM:lle myös hyvin tarkan kolmen tunnin aikaresoluution \citep{storz_2005}. Tämänkin työn data-assimilaatiojärjestelmää voisi ajaa pienemmällä aikavälillä, esimerkiksi kahden päivän välein. Kaksirivisen elementtiaineiston pienintä integrointiaikaa (kolme päivää) ei kuitenkaan voida enää lyhentää, mikä joka tapauksessa tasoittaisi mallitilojen muutoksia lyhyempää assimilointi-ikkunaa käytettäessä. Koska termosfäärin massatiheys voi muuttua merkittävästi tuntien aikaskaalassa (esimerkiksi geomagneettisten myrskyjen seurauksena), eivät kaksiriviset elementit voi kuvata kaikkia yläilmakehässä tapahtuvia muutoksia. Assimilaatioikkunan lyhentäminen aikaresoluution ei tähän ongelmaan välttämättä auta, sillä se voi vähentää kerralla assimiloitavien havaintojen määrää ja aiheuttaa järjestelmään ylimääräistä kohinaa.

Kaikkia HASDM-mallin satelliitteja ei voinut tässä työssä käyttää, sillä yksinkertaisella analyyttisellä SGP4-mallilla ei niiden rataa kyennyt riittävän tarkkaan määrittämään. Lähes kaikki HASDM:n satelliitit, joiden kiertoaika oli yli 225 minuuttia ilmensivät hyvin suurta ja satunnaista vaihtelua (jopa tekijällä 10) yksittäisissä ballistisissa kertoimissa $B_i$. SGP4-malli olettaa, että kolmannen kappaleen voimat ovat merkittäviä kun kappaleen kiertojakso ylittää 225 minuuttia \citep{hoots_1980}, mutta on mahdollista, että tässä työssä käytetty mallin julkinen versio ei laske näitä voimia aivan samalla tavalla kuin NORAD:n kiertoratasovituksissaan käyttämä malli. Näin ollen SGP4:n antama kappaleen kiertorata poikkeaisi havaitusta ja aiheuttaisi epäjohtonmukaisuuden yhtälön (\ref{Bi_eq}) keskiliikkeen ja viivaintegraalin välille. On myös mahdollista, että tutkahavaintojen avulla määritetyt kaksirivisten elementtien keskiliikkeet itsessään ovat virheelliset. Koska elementit eivät sisällä mitään virheinformaatiota, on lopullista syytä kuitenkin vaikea selvittää. 

SGP4-malliin ja kaksirivisiin elementteihin liittyvistä ongelmista voi osittain päästä eroon vaihtamalla satelliittin paikanmäärityksessä käytetty malli monimutkaiseen numeeriseen (niin sanottuun erityisperturbaatio-) malliin \citep{picone_2005}. Täysin numeeriset mallit usein sisältävät tarkemman kuvauksen säteilypaineesta, maan painovoimakentästä ja kolmannen kappaleen voimista. Tehtäessä näillä malleilla termosfäärin tiheysanalyysiä, ainoastaan alkuehto, satelliitin sijainti ja nopeus saadaan kaksirivisestä elementtidatasta ja SGP4-mallista. Tästä alkuehdosta malli voi tarkkaan simuloida satelliitin rataa ja kappaleen paikan määrityksessä tehtävä virhe usein huomattavasti pienenee SGP4:aan verrattuna \citep{saunders_2011}. Numeeristen mallien avulla termosfäärin massatiheys voidaan määrittää suoraan satelliitin kiertoratakorkeuden (isoakselin puolikkaan) muutoksista, jonka virhe on todennäkäisesti pienempi kuin yhtälöstä (\ref{density_12_eq}) johdetun tiheyden virhe \citep{saunders_2011}. 

Tarkkaan kiertoratamalliin voi empiirisen yläilmakehämallin (kuten IL-mallin) kytkeä suoraan siten, että mallin simuloima ilmakehän massatiheys vaikuttaa kappaleen kiertorataan. Näin ollen kiertoratamalli voisi olla osa havainto-operaattoria ja EnKF:lla voisi assimiloida suoraan muutoksia kappaleen ratakorkeudessa (verraten niitä kaksirivisten elementtien havaintoihin). Kytketyn mallin avulla on myös mahdollista luoda tarkka iteratiivinen algoritmi, joka korjaa satelliitin ballistista kerrointa siten, että termosfäärimallin kuvaama massatiheys aiheuttaa satelliitin kiertoradassa havaitun muutoksen \citep{saunders_2011}. Kappaleiden todellinen ballistinen kerroin onkin suurin virhelähde kaksirivisten elementtien avulla tehtävissä yläilmakehätutkimuksissa \citep{bowman_2002}. Tässä työssä oletettiin, että IL-malli antaa harhattoman kuvauksen termosfäärin massatiheydestä, jolloin ballistinen kerroin voitiin määrittää yksittäisten $B_i$-arvojen pitkän ajan keskiarvona. Koska IL-malli tuskin on harhaton, tässä tutkimuksessa käytetyt todelliset ballistisen kertoimen arvot ovat välttämättä harhaisia. Kaksirivisten elementtien avulla on siis hyvin vaikeaa saada selville termosfäärin massatiheyden absoluuttisia arvoja. Käytännässä harhattomin arvio saadaan määrittämällä jonkin pallomaisen satelliitin (alaindeksi $P$) ballistinen kerroin teoreettisesti (yläindeksi $Te$) ja määräämällä kaikkien epäsäännöllisten (alaindeksi $E$) kappaleiden kertoimet tämän suhteen \citep{picone_2005}: 
\begin{equation} \label{Bspherical_eq}
B^T_E = \left \langle B_E^M \right \rangle \frac{B_P^{Te}}{\left \langle B_P^M \right \rangle},
\end{equation}
missä kulmasulkeet ilmaisevat pitkän ajan $B_i$ keskiarvoa (kuitenkin saman ajan yli sekä säännölliselle että pallomaiselle kappaleelle). Pallomaisia satelliitteja, joiden teoreettinen $B^T$ vastannee hyvin totuutta on tunnistettu useita \citep{bowman_2002,doornbos_2004}. Huolellisesta tarkastelusta huolimatta järjestelmällisiä eroja tässä ja aiemmissa töissä vaihtelevin tavoin määritettyjen $B^T$-arvojen välillä ei kuitenkaan läydetty. 

Todellisen ballistisen kertoimen arvon lisäksi on tässä työssä käytettyä kertoimen virhearviota myös mahdollista parantaa. Nyt virheenä käytetään keskiarvon keskivirhettä, mutta tarkalleen ottaen kaava (\ref{Bi_err_eq}) pätee vain sellaiselle satunnaismuuttujalle, joka ei korreloi edellisten arvojensa kanssa. Peräkkäisten $B_i$-arvojen selvän korrelaation (katso esim. Kuva \ref{fig:Btrue}) johdosta kyseessä on aliarvio ballistisen kertoimen todellisesta virheestä. Käytännössä tämän virheen suuruus vaikuttaa mallin taustan kovarisnssin inflaatioparametrin arvoon, koska EnKF:ssa ryppään päivitys riippu mallin ja havaintojen kovarianssin suhtesta. 

Ballistisen kertoimen ja siten tiheyden virheen absoluuttisesta suuruudesta huolimatta havaintojen määrän lisääminen saattaa tarkentaa data-assimilaatiojärjestelmän analyysiä. Tässä työssä käytetyt 48 maan matalan kiertoradan kappaletta ovat osajoukko HASDM-mallissa käytetyistä kalibrointikappaleista \citep{doornbos_2004} ja niiden ballististen kertoimien on todettu pysyvän käytännössä vakiona. \citet{emmert_2008} on kuitenkin analysoinut lähes kaikki NORAD:n katalogissa olevat kappaleet, joiden ratoihin termosfäärillä ajatellaan olevan vaikutusta. Tutkimuksessaan hän esitti johtopäätäksen, jonka mukaan mallien tiheyskalibrointiin olisi käytettävissä jopa 5000 kappaletta. 

Näiden kaksirivisten elementtien lisäksi tiheysassimilaatioon voisi käyttää myös GOCE, CHAMP, GRACE ja SWARM -painovoimasatelliittien kiihtyvyysmittarien avulla johdettuja kokonaismassatiheyksiä. Painovoimasatelliittien ja elementtihavaintojen assimilaatiossa joudutaan kuitenkin tekemään päätäksiä siitä, mitä mallin kenttiä havaintojen avulla korjataan; tässä työssä korjattiin lämpötilaprofiilia, sillä se vaikuttaa kaikkien kaasulajien massatiheyksiin. Kokonaismassatiheys on kuitenkin vain mallin "diagnostinen" suure, joka lasketaan yksittäisten kaasulajien massatiheyksien summana -- havaittua kokonaistiheysjakaumaa vastaa ääretän määrä erilaisia lämpötila- ja tiheysjakaumia, eikä massatiheysmittausten avulla voida täysin rajoittaa assimilaatiojärjestelmää, jossa näitä molempia varioidaan yhtä aikaa. Termosfääristä tehdään kuitenkin suoria tiheys- ja lämpötilamittauksia esimerkiksi satelliitien mittaaman ilmahehkun \citep[esim.][]{slanger_2017} ja epäkoherenttien sirontatutkien avulla. Näitä havaintoja olisi mahdollista assimiloida malliin yhdessä kokonaismassatiheysmittausten kanssa, jolloin lämpötila- ja tiheyskenttiä voitaisiin korjata samanaikaisesti, mahdollisesti parantaen analyysin tarkkuutta. 

Assimilaatiomenetelmänä olisi ollut mahdollista käyttää tavallista Kalman-suodinta, sillä mallitilassa oli ainoastaan 11 muuttujaa ja kerralla assimiloitavien havaintojen lukumääräkin oli pieni (40:sta 45:een). Vaihtoehtona olisi ollut myös Doornbosin (2008) käyttämä epälineaariseen optimointiin usein sovellettu Levenberg-Marquardt -algoritmi. työssä päädyttiin kuitenkin käyttämään ensemble Kalman -suodinta, koska (1) siinä ei ole tarvetta tangentti-lineaarisille operaattoreille, (2) se kehittää mallitilaa ja sen kovarianssia samanaikaisesti, (3) se kykenee antamaan todennäkäisyysennusteita, (4) se toimii hyvin myös alimääritellyissä ongelmissa, (5) se ottaa huomioon mallin ennusteen informaatiosisällön määrittäessään analyysiä ja (6) se on laskennallisesti hyvin tehokas. 

Laskennallisen nopeuden saavuttaminen vaatii kuitenkin pääakselihajotelmalla toteutettua versiota \citep{mandel_2006}. Siten voidaan teoreettisesti saavuttaa asymptoottinen kompleksisuus:
\begin{equation} \label{svdCompl_eq}
O(oN^2 + mN^2 + N^3).
\end{equation}
Tämän työn yksinkertainen implementaatio käyttää analyysiyhtälön (\ref{enkf_anal_eq}) matriisi-inversion laskemiseen Choleskyn algoritmia, jonka takia suotimen kokonaiskomplekisuus on \citep{mandel_2006}:
\begin{equation} \label{naiveCompl_eq}
O(o^3 + o^2N + oN^2 + mN^2).
\end{equation}
Suotimen tehokkaampi muoto on huomattavasti nopeampi kuin Levenberg-Marquardt -algoritmi \citep{more_1978}
\begin{equation} \label{lm_eq}
O(om^2 + m^3).
\end{equation}
EnKF:n kompleksisuus voi siis parhaimmillaan olla lineaarinen sekä havaintojen että mallitilan koon suhteen. Sen sijaan Levenberg-Marquardt'n laskenta-aika kasvaa hyvin nopeasti mallitilan muuttujien lukumäärän lisääntyessä, mikä tarkoittaa, ettei se sovellu suurten mallien assimilaatio-ongelmiin. Se ei myöskään ota huomioon mallin taustaa muodostaessaan analyysiä, vaan korjaus perustuu aina pelkästään havaintoihin [\textit{Periaatteessa olisi varmaan mahdollista käyttää L-M:aa sakkofunktion (\ref{J_eq}) minimointiin yhdessä adjoint-mallin gradientti-informaation kanssa. Tiedä sitten, miten nopeaa se olisi}]. 

Tässä työssä mallitila ($m$) on pienempi kuin yhdessä assimilaatiossa käytettyjen havaintojen määrä keskimäärin (eli ongelma on ylimääritelty), mikä selvästi poikkeaa EnKF:n tyypillisestä sovelluksesta isoissa numeerisissa malleissa. Matemaattisesti tämä ei kuitenkaan ole ongelma ja suotimen osoitettiin toimivan varsin hyvin myös tässä sovelluksessa. Ylimääritelty assimilaatio-ongelma voi myös vähentää pienestä ryppään koosta aiheutuvia ongelmia, vaikka toisaalta ryppään mallien havaittiin (alinäytteistetyn mallin tapaan) pyrkivän konvergoitumaan ilman kovarianssin inflaatiota. Osittain ongelman luonteen johdosta mallitaustan kovarianssista ei yritetty poistaa siellä mahdollisesti esiintyneitä harhaanjohtavia korrelaatioita. Tyypillisesti lokalisaatio implementoidaan operoimalla kovarianssimatriisia korrelaatiofunktion $\rho$ ja Schur- (eli alkio)tulon ($\circ$) avulla \citep{houtekamer_2001}:
\begin{equation} \label{lm_eq}
\mathbf{K} = (\rho \circ \mathbf{C)H^T}(\mathbf{H}(\rho \circ \mathbf{C)H^T + R})^{-1}.
\end{equation}
Käytännössä kovarianssia keinotekoisesti pienennetään jonkin (usein polynomimuotoisen \citep{gaspari_1999}) funktion $\rho$ avulla hilapisteiden välisen etäisyyden funktiona. Ongelmana kuitenkin on, ettei kovarianssia lasketa tässä työssä suoraan. Lisäksi ei ole selvää, millainen eri mallitilan parametrien (kuten alareunan lämpötilagradientin ja eksosfäärin keskimääräisen lämpötilakorjauksen) kovarianssin kuuluu fysikaalisten argumenttien nojalla olla. Ilman tällaista informaatiota ei voida tietää, mikä korrelaatio on kausaalista (fysikaalista) ja mikä pelkkää satunnaisuudesta aiheutuvaa kohinaa. Palloharmonisille malleille on mahdollista tehdä vastaavanlainen korjaus pallofunktioiden kertoimien kovarianssille, mutta käytännössä tämä vaatii aina pseudo-spektraali-menetelmän käyttämistä, jossa mallitilaa muunnetaan vuoroin fysikaalisen- ja spektraaliavaruuden välillä \citep{buehner_2012}. Koska IL-mallissa ei hilapisteikköä lainkaan ole, ei myöskään näitä menetelmiä voi käyttää. Niinpä ainoa vaihtoehto on olettaa, että mallitilaan nähden suuri rypäs ja havaintojen määrä riittää esittämään malliparametrien kovarianssin luotettavasti. 

Harhaisten korrelaatioiden lisäksi on syytä kiinnittää parempaa huomiota mallitaustan kovarianssin inflaatioon. Koska EnKF:n malliryppään havaittiin konvergoituvan kohti yhteistä tilaa, oli implementoitava mekanismi, joka keinotekoisesti piti varianssin tarpeeksi korkeana. Tämän työn ratkaisu, jossa eksosfäärin keskimääräisen lämpötilakorjauksen varianssia pidettiin vakiona osoittautui toimivaksi, mutta kehittyneempiä menetelmiä on harkittava. Kuten Kuvassa \ref{fig:rank} osoitettiin, suodin on nykyisellään hieman alidispersiivinen, sillä suuremmilla inflaatioparametrin arvoilla osa ryppään malleista päätyi hyvin herkästi epäfysikaalisiin tiloihin, jotka estivät suotimen käytön. Todennäköisesti optimaalinen inflaatioparametri ei kuitenkaan ole vakion, vaan vaihtelee ajassa ja avaruudessa. Onkin mahdollista hyödyntää algoritmeja, jotka inflatoivat jokaista mallin muuttujaa eri tavalla eri ajanhetkinä \citep{anderson_2009}. 

Ryppään rajallisen koon lisäksi myös EnKF:ssa käytetty havaintojen satunnaistus (yhtälön (\ref{data_eq}) mukaisesti) aiheuttaa kohinaa \citep{whitaker_2002}. Äärellinen määrä satunnaislukuja ei aina täysin edusta alkuperäisen satunnaisjakauman vaihtelua. Siksi onkin kehitetty deterministisiä suotimia, kuten ensemble-muunnos Kalman -suodin (englanniksi \textit{Ensemble Transform Kalman Filter}, ETKF) \citep{bishop_2001}, jotka tuottavat samalla havaintoaineistolla ja ryppäällä järjestelmällisesti saman ennusteen. Kaikki Kalman-suotimet kuitenkin olettavat, että todennäkäisyysjakaumat ovat normaalijakaumien. Esimerkiksi ballistisen kertoimen jakauma ei kuitenkaan aivan tarkalleen ole gaussinen (ei näytetä), mikä antaa syyn olettaa, että sen avulla johdetut havainnotkaan eivät ole. Tulosten perusteella normaalijakauman oletus kuitenkin näyttää toimivan; mikäli näin ei olisi, voitaisiin siirtyä yleisiin hiukkassuotimiin, jotka tukevat mitä tahansa todennäkäisyysjakaumaa \citep{moradkhani_2005}.

\section{Johtopäätökset}

Tässä tutkielmassa luotiin ensemble Kalman -suotimeen perustuva data-assimilaatiojärjestelmä puoli-empiiriseen yläilmakehämalliin (Iipponen-Laitinen -malli). Järjestelmän suorituskykyä arvioitiin vuonna 2003, jolloin ilmakehään vaikuttavat pakotteet, Auringon UV-säteily ja geomagneettinen aktiivisuus olivat suuria ja vaihtelevia. Havaintoaineistona käytettiin matalan maan kiertoradan satelliittien ratamuutoksista laskettuja ilmakehän keskimääräisiä tiheyksiä.

Työn tavoitteena oli tutkia, tarkentaako data-assimilaatio puoli-empiirisen termosfäärimallin kuvausta keski- ja ylätermosfäärin kokonaismassatiheydestä. Näihin tarkasteluihin vedoten päädyin seuraaviin tuloksiin ja johtopäätöksiin:
\begin{enumerate}
\item Ensemble Kalman -suotimen tuottama analyysi tarkentaa IL-mallia (pienentää RMSE-virhettä yli 95\%:n todennäköisyydellä). 
\item Mallin taustalla (ennakkokentällä) ei yleisesti ole ennustusarvoa assimilaatiohetkeä seuraavan kolmen päivän massatiheyksistä, vaikka pakotteiden tuleva kehitys olisi tarkkaan tiedossa.
\item Data-assimilaation tuoma tarkennus vaihtelee huomattavasti ajan ja paikan (tarkasteltavan kappaleen) suhteen. Tämä voi aiheutua pakotteiden aikakehitykseen liittyvästä epävarmuudesta, joka muuttaa yläilmakehän tilaa nopeammin kuin käytetty kolmen päivän välein tehtävä data-assimilaatio ehtii sitä korjata.  
\end{enumerate}

Vaikka EnKF:aa voi käyttää termosfäärin data-assimilaatiossa, algoritmia on mahdollista kehittää vielä monella tapaa. Todennäköisesti merkittävimmät parannukset seuraavat käyttämällä parempia menetelmiä taustan harhaanjohtavien korrelaatioiden poistamiseen, sekä kovarianssin inflaatioon. Assimilaation tarkkuutta voisi parantaa myös havaintojen määrää kasvattamalla ja assimiloimalla malliin kokonaismassatiheyden lisäksi mittauksia termosfäärin koostumuksesta ja lämpötilasta. Lisäksi olisi mahdollista arvioida mallin tilavektorissa pakotteita itseään, mikä luultavasti vähentää niihin liittyvää epävarmuutta.

Lukuisista parannuskohteista huolimatta työssä onnistuttiin luomaan data-assimilaatiojärjestelmä, jollaista ei empiirisessä yläilmakehämallinnuksessa aiemmin ole käytetty. Tulevissa tutkimuksissa voidaan keskittyä järjestelmän kehittämiseen kohti tilaa, jossa termosfääristä voidaan laatia yhtä tarkkoja ennusteita kuin troposfääristä nykyään.

\newpage
\section*{Kiitokset}

Suurimmat kiitoksen ohjaajalleni Tiera Laitiselle, sekä ryhmäpäällikkö Ari Viljaselle siitä, että otitte minut aikoinaan kesätöihin Ilmatieteen laitokselle. Yläilmakehätutkimus on ollut valtavan mielenkiintoista ja tärkeä ponnahduslauta tieteelliselle uralle. On sääli, että joudun jättämään kiehtovan tutkimusalan taakseni, mutta kohtalo johdatti minut uusiin haasteisiin. 

Kiitos myös Heikki Järviselle mielenkiintoisista numeriikan kursseista, sekä lukemattomista suosituskirjeistä. Anteeksi, että työn arvioinnin kanssa tuli niin kiire. 

Viimeisenä, muttei vähäisimpänä haluaisin kiittää vanhempiani ja ystäviäni siitä, että olitte aina tukenani. Toivon, ettette unohda minua, vaikka Atlantti olisi välillämme.

%%% Oma teksti ennen tätä.
\newpage
\bibliography{gradu}
\bibliographystyle{unsrtnat}
%\nocite{*}
%\printbibliography


%\bibliography{gradu}  % viittaa tiedostoon gradu.bib

\end{document}

